(function(){var t={}.hasOwnProperty,e=function(e,n){function o(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e};define(["jquery","Backbone","compiled/models/AssignmentGroup","underscore","i18n!assignments","compiled/collections/SubmissionCollection","compiled/collections/ModuleCollection"],function(t,n,o,r,s,i,u){var a,c,l;return c=50,a=function(t){function n(){return l=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.model=o,n.optionProperty("course"),n.optionProperty("courseSubmissionsURL"),n.prototype.defaults={params:{include:["assignments"]}},n.prototype.loadModuleNames=function(){var t,e=this;return t=new u([],{course_id:this.course.id}),t.loadAll=!0,t.fetch(),t.on("fetched:last",function(){var n,o,s,i,u,a,c,l,p,d,m;for(i={},p=t.toJSON(),u=0,c=p.length;c>u;u++)s=p[u],i[s.id]=s.name;for(d=e.assignments(),m=[],a=0,l=d.length;l>a;a++)n=d[a],o=r(n.get("module_ids")).map(function(t){return i[t]}),m.push(n.set("modules",o));return m})},n.prototype.assignments=function(){return this.chain().map(function(t){return t.get("assignments").toArray()}).flatten().value()},n.prototype.comparator="position",n.prototype.userIsStudent=function(){return r.include(ENV.current_user_roles,"student")},n.prototype.getGrades=function(){var t,e=this;return this.userIsStudent()?(t=new i,t.url=function(){return""+e.courseSubmissionsURL+"?per_page="+c},t.loadAll=!0,t.on("fetched:last",function(){return e.loadGradesFromSubmissions(t.toArray())}),t.fetch()):this.trigger("change:submissions")},n.prototype.loadGradesFromSubmissions=function(t){var e,n,o,r,s,i,u,a,c;for(r={},s=0,u=t.length;u>s;s++)o=t[s],r[o.get("assignment_id")]=o;for(c=this.assignments(),i=0,a=c.length;a>i;i++)e=c[i],o=r[e.get("id")],o?(null!=o.get("grade")?(n=parseFloat(o.get("grade")),isNaN(n)||o.set("grade",n)):o.set("notYetGraded",!0),e.set("submission",o)):(e.set("submission",null),e.trigger("change:submission"));return this.trigger("change:submissions")},n}(n.Collection)})}).call(this);