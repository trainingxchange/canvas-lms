(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty;define(["jquery","i18n!calendar","jst/calendar/TimeBlockRow"],function(i,n,s){var o;return o=function(){function o(e,n){var o,r=this;this.TimeBlockList=e,null==n&&(n={}),this.focus=t(this.focus,this),this.remove=t(this.remove,this),this.locked=n.locked,o=null,this.$row=i(s(n)).bind({focusin:function(){return clearTimeout(o),r.focus()},focusout:function(){return o=setTimeout(function(){return r.$row.removeClass("focused")},50)}}),this.inputs={},this.locked||(this.$row.find(".date_field").date_field(),this.$row.find(".time_field").time_field()),i.each(this.inputNames,function(t,e){return r.inputs[e]={},r.inputs[e].$el=r.$row.find("input[name='"+e+"']").change(function(){return r.handleInputChange(e)}),r.updateModel(e),r.locked?r.inputs[e].valid=!0:void 0}),this.$row.find(".delete-block-link").click(this.remove)}return o.prototype.inputNames=["date","start_time","end_time"],o.prototype.updateModel=function(t){return this.inputs[t].val=i.trim(this.inputs[t].$el.val())},o.prototype.handleInputChange=function(t){this.updateModel(t),this.validateField(t),this.validate()},o.prototype.updateDom=function(t,e){return this.inputs[t].val=e,this.inputs[t].$el.val(e)},o.prototype.remove=function(t){return null!=t&&t.preventDefault(),this.$row.remove(),this.TimeBlockList.rowRemoved(this),i("input.date_field:visible").focus()},o.prototype.focus=function(){return this.$row.addClass("focused"),this.$row.is(":last-child")?this.$row.parents(".time-block-list-body-wrapper").scrollTop(9999):void 0},o.prototype.validateField=function(t){var e,i;return e=this.inputs[t].$el.closest("td").find(".datetime_suggest"),i=e.hasClass("invalid_datetime"),i||this.updateDom(t,e.text()),this.inputs[t].$el.toggleClass("error",i),this.inputs[t].valid=!i},o.prototype.validate=function(){var t,i,s,o,r,a;if(this.locked)return!0;o=!0,r=this.inputs;for(i in r)e.call(r,i)&&(t=r[i],null!=(a=t.$el.data("associated_error_box"))&&a.remove(),this.validateField(i)||(o=!1));return o&&!this.blank()&&(this.validDate()&&this.inputs.end_time.val&&this.endAt()<new Date&&(o=!1,this.inputs.end_time.$el.addClass("error").errorBox(n.t("ends_in_past_error","You cannot create an appointment slot that ends in the past"))),this.inputs.start_time.val&&this.inputs.end_time.val&&(s=this.validDate()||"Today",this.timeToDate(s,this.inputs.end_time.val)<=this.timeToDate(s,this.inputs.start_time.val)&&(o=!1,this.inputs.start_time.$el.addClass("error").errorBox(n.t("end_before_start_error","Start time must be before end time"))))),this.blank()||o},o.prototype.timeToDate=function(t,e){return Date.parse(t+" "+e)},o.prototype.endAt=function(){return this.validDate()?this.timeToDate(this.inputs.date.val,this.inputs.end_time.val):void 0},o.prototype.startAt=function(){return this.validDate()?this.timeToDate(this.inputs.date.val,this.inputs.start_time.val):void 0},o.prototype.validDate=function(){return this.inputs.date.val&&this.inputs.date.valid?this.inputs.date.val:void 0},o.prototype.getData=function(){return[this.startAt(),this.endAt(),!!this.locked]},o.prototype.blank=function(){return""===this.inputs.date.val&&""===this.inputs.start_time.val&&""===this.inputs.end_time.val},o}()})}).call(this);