(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};define(["jquery","underscore","compiled/userSettings","jst/calendar/contextList","jst/calendar/undatedEvents","compiled/calendar/commonEventFactory","compiled/calendar/EditEventDetailsDialog","compiled/calendar/EventDataSource","compiled/jquery.kylemenu","jquery.instructure_misc_helpers","vendor/jquery.ba-tinypubsub"],function(n,s,i,o){var r,c;return r=function(){function o(e,o,r){var c,a,h,l;this.$holder=r,this.restoreList=t(this.restoreList,this),this.saveAndClear=t(this.saveAndClear,this),l=function(){try{return n.parseJSON(n.decodeFromHex(location.hash.substring(1)))||{}}catch(t){return h=t,{}}}(),c=function(){var t,n,s;for(s=[],t=0,n=e.length;n>t;t++)a=e[t],s.push(a.asset_string);return s}(),l.show&&(this.contexts=l.show.split(",")),this.contexts||(this.contexts=o),this.contexts||(this.contexts=i.get("checked_calendar_codes")),this.contexts||(this.contexts=c),this.contexts=s.intersection(this.contexts,c),this.contexts=this.contexts.slice(0,10),this.notify(),n.subscribe("Calendar/saveVisibleContextListAndClear",this.saveAndClear),n.subscribe("Calendar/restoreVisibleContextList",this.restoreList)}return o.prototype.saveAndClear=function(){return this.savedContexts?void 0:(this.savedContexts=this.contexts,this.contexts=[],this.notify())},o.prototype.restoreList=function(){return this.savedContexts?(this.contexts=this.savedContexts,this.savedContexts=null,this.notify()):void 0},o.prototype.toggle=function(t){var e;return e=n.inArray(t,this.contexts),e>=0?this.contexts.splice(e,1):(this.contexts.push(t),this.contexts.length>10&&this.contexts.shift()),this.notify()},o.prototype.notify=function(){var t=this;return n.publish("Calendar/visibleContextListChanged",[this.contexts]),this.$holder.find(".context_list_context").each(function(s,i){var o,r,c;return o=n(i),c=o.data("context"),r=e.call(t.contexts,c)>=0,o.toggleClass("checked",r).toggleClass("not-checked",!r).find(".context-list-toggle-box").attr("aria-checked",r)})},o}(),c=function(t,e){var c,a,h;return c=n("#context-list-holder"),a=n(".skip-to-calendar"),c.html(o({contexts:t})),h=new r(t,e,c),c.on("click keyclick",".context_list_context",function(){return h.toggle(n(this).data("context")),i.set("checked_calendar_codes",s.map(n(this).parent().children(".checked"),function(t){return n(t).data("context")}))}),a.on("click",function(t){return t.preventDefault(),n("#content").attr("tabindex",-1).focus()})}})}).call(this);