(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define(["jquery","i18n!calendar","underscore","compiled/calendar/CalendarDefaults","vendor/jquery.ba-tinypubsub"],function(e,n,i,a){var r;return r=function(){function r(n,r){this.mainCalendar=r,this.drop=t(this.drop,this),this.refetchEvents=t(this.refetchEvents,this),this.eventSaved=t(this.eventSaved,this),this.visibleContextListChanged=t(this.visibleContextListChanged,this),this.eventRender=t(this.eventRender,this),this.gotoDate=t(this.gotoDate,this),this.dayClick=t(this.dayClick,this),this.getEvents=t(this.getEvents,this),this.calendar=e(n),this.calendar.fullCalendar(i.defaults({height:240,header:{left:"prev",center:"title",right:"next"},dayClick:this.dayClick,events:this.getEvents,eventRender:this.eventRender,droppable:!0,dropAccept:".fc-event,.undated_event",drop:this.drop},a),e.subscribe({"Calendar/visibleContextListChanged":this.visibleContextListChanged,"Calendar/refetchEvents":this.refetchEvents,"Calendar/currentDate":this.gotoDate,"CommonEvent/eventDeleted":this.eventSaved,"CommonEvent/eventSaved":this.eventSaved}))}return r.prototype.getEvents=function(t,e,n){return this.calendar.find(".fc-content td").removeClass("event slot-available").removeAttr("title"),this.mainCalendar.getEvents(t,e,n)},r.prototype.dayClick=function(t){return this.mainCalendar.gotoDate(t)},r.prototype.gotoDate=function(t){return this.calendar.fullCalendar("gotoDate",t)},r.prototype.eventRender=function(t,e,i){var a,r,s,o,d,h;return r=i.dateToCell(t.start),s=i.element.find("tr:nth-child("+(r.row+1)+") td:nth-child("+(r.col+1)+")"),s.addClass("event"),o=n.t("event_on_this_day","There is an event on this day"),a=null!=(d=this.mainCalendar.displayAppointmentEvents)?d.id:void 0,a&&a===(null!=(h=t.calendarEvent)?h.appointment_group_id:void 0)&&t.object.available_slots&&(s.addClass("slot-available"),o=n.t("open_appointment_on_this_day","There is an open appointment on this day")),s.attr("title",o),!1},r.prototype.visibleContextListChanged=function(){return this.refetchEvents()},r.prototype.eventSaved=function(){return this.refetchEvents()},r.prototype.refetchEvents=function(){return this.calendar.is(":visible")?this.calendar.fullCalendar("refetchEvents"):void 0},r.prototype.drop=function(t,e,n,i){return i.helper.is(".undated_event")?this.mainCalendar.drop(t,e,n,i):i.helper.is(".fc-event")?this.mainCalendar.dropOnMiniCalendar(t,e,n,i):void 0},r}()})}).call(this);