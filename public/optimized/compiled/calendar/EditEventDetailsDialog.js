(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define(["jquery","i18n!calendar","underscore","compiled/calendar/CommonEvent","compiled/calendar/EditCalendarEventDetails","compiled/calendar/EditAssignmentDetails","compiled/calendar/EditApptCalendarEventDialog","compiled/calendar/EditAppointmentGroupDetails","jst/calendar/editEvent","jqueryui/dialog","jqueryui/tabs"],function(e,n,s,i,o,a,r,l,d){var c;return c=e('<div id="edit_event"><div /></div>').appendTo("body").dialog({autoOpen:!1,width:"auto",resizable:!1,title:n.t("titles.edit_event","Edit Event")}),function(){function n(e){this.event=e,this.show=t(this.show,this),this.dialogClose=t(this.dialogClose,this),this.closeCB=t(this.closeCB,this),this.contextChange=t(this.contextChange,this),this.setupTabs=t(this.setupTabs,this),this.currentContextInfo=null,c.on("dialogclose",this.dialogClose)}return n.prototype.contextInfoForCode=function(t){var e,n,s,i;for(i=this.event.possibleContexts(),n=0,s=i.length;s>n;n++)if(e=i[n],e.asset_string===t)return e;return null},n.prototype.setupTabs=function(){var t,n;return n=c.find("#edit_event_tabs"),n.tabs().bind("tabsselect",function(t,n){return e(n.panel).closest(".tab_holder").data("form-widget").activate()}),"calendar_event"===this.event.eventType?(n.tabs("select",0),n.tabs("remove",1),this.calendarEventForm.activate()):this.event.eventType.match(/assignment/)?(n.tabs("select",1),n.tabs("remove",0),this.assignmentDetailsForm.activate()):(t=s.any(this.event.allPossibleContexts,function(t){return t.can_create_assignments}),t||n.tabs("remove",1),this.calendarEventForm.activate())},n.prototype.contextChange=function(t){return c.removeClass(c.data("group_class")),c.addClass("group_"+t).data("group_class","group_"+t),this.calendarEventForm&&this.calendarEventForm.setContext(t),this.assignmentDetailsForm?this.assignmentDetailsForm.setContext(t):void 0},n.prototype.closeCB=function(){return c.dialog("close")},n.prototype.dialogClose=function(){return null!=this.oldFocus?(this.oldFocus.focus(),this.oldFocus=null):void 0},n.prototype.show=function(){var t,n;return this.event.isAppointmentGroupEvent()?new r(this.event).show():(n=d(),c.children().replaceWith(n),(this.event.isNewEvent()||"calendar_event"===this.event.eventType)&&(t=c.find("#edit_calendar_event_form_holder"),this.calendarEventForm=new o(t,this.event,this.contextChange,this.closeCB),t.data("form-widget",this.calendarEventForm)),(this.event.isNewEvent()||this.event.eventType.match(/assignment/))&&(this.assignmentDetailsForm=new a(e("#edit_assignment_form_holder"),this.event,this.contextChange,this.closeCB),c.find("#edit_assignment_form_holder").data("form-widget",this.assignmentDetailsForm)),this.setupTabs(),this.oldFocus=document.activeElement,c.dialog("open"))},n}()})}).call(this);