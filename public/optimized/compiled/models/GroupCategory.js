(function(){var s=function(s,e){return function(){return s.apply(e,arguments)}},e={}.hasOwnProperty,t=function(s,t){function r(){this.constructor=s}for(var o in t)e.call(t,o)&&(s[o]=t[o]);return r.prototype=t.prototype,s.prototype=new r,s.__super__=t.prototype,s};define(["jquery","underscore","Backbone","compiled/collections/GroupCollection","compiled/collections/GroupUserCollection","compiled/collections/UnassignedGroupUserCollection","compiled/models/progressable","compiled/backbone-ext/DefaultUrlMixin"],function(e,r,o,n,u,i,p,l){var g,c;return g=function(u){function g(){return this.setUpProgress=s(this.setUpProgress,this),this.groupRemoved=s(this.groupRemoved,this),c=g.__super__.constructor.apply(this,arguments)}return t(g,u),g.prototype.resourceName="group_categories",g.mixin(p),g.prototype.initialize=function(){var s;return g.__super__.initialize.apply(this,arguments),(s=this.get("groups"))&&this.groups(s),this.on("change:group_limit",this.updateGroups)},g.prototype.updateGroups=function(){return this._groups?this._groups.fetch():void 0},g.prototype.groups=function(s){var e=this;return null==s&&(s=null),this._groups=new n(s,{category:this,loadAll:!0}),0===this.get("groups_count")||(null!=s?s.length:void 0)?this._groups.loadedAll=!0:this._groups.fetch(),this._groups.on("fetched:last",function(){return e.set("groups_count",e._groups.length)}),this._groups.on("remove",this.groupRemoved),this.groups=function(){return this._groups},this._groups},g.prototype.groupRemoved=function(s){var e,t,r,o,n;if(this._unassignedUsers||s.usersCount()){if(r=s.users(),r.loadedAll)for(e=r.models.slice(),o=0,n=e.length;n>o;o++)t=e[o],t.set("group",null);else this.get("allows_multiple_memberships")||this._unassignedUsers.increment(s.usersCount());return this.get("allows_multiple_memberships")||r.loadedAll&&this._unassignedUsers.loadedAll?void 0:this._unassignedUsers.fetch()}},g.prototype.reassignUser=function(s,e){var t,r=this;return t=s.get("group"),t!==e?(null==t&&this.get("allows_multiple_memberships")&&(s=s.clone(),s.once("change:group",function(){return r.groupUsersFor(e).addUser(s)})),s.save({group:e})):void 0},g.prototype.groupsCount=function(){var s;return(null!=(s=this._groups)?s.loadedAll:void 0)?this._groups.length:this.get("groups_count")},g.prototype.groupUsersFor=function(s){return null!=s?s._users:this._unassignedUsers},g.prototype.unassignedUsers=function(){var s=this;return this._unassignedUsers=new i(null,{category:this}),this._unassignedUsers.on("fetched:last",function(){return s.set("unassigned_users_count",s._unassignedUsers.length)}),this.unassignedUsers=function(){return this._unassignedUsers},this._unassignedUsers},g.prototype.unassignedUsersCount=function(){return this.get("unassigned_users_count")},g.prototype.canAssignUnassignedMembers=function(){return this.groupsCount()>0&&!this.get("allows_multiple_memberships")&&"restricted"!==this.get("self_signup")&&this.unassignedUsersCount()>0},g.prototype.canMessageUnassignedMembers=function(){return this.unassignedUsersCount()>0&&!ENV.IS_LARGE_ROSTER},g.prototype.isLocked=function(){return"uncategorized"===this.get("role")},g.prototype.assignUnassignedMembers=function(){return e.ajaxJSON("/api/v1/group_categories/"+this.id+"/assign_unassigned_members","POST",{},this.setUpProgress)},g.prototype.setUpProgress=function(s){return this.set({progress_url:s.url})},g.prototype.present=function(){var s;return s=o.Model.prototype.toJSON.call(this),s.progress=this.progressModel.toJSON(),s.randomlyAssignStudentsInProgress="queued"===s.progress.workflow_state||"running"===s.progress.workflow_state,s},g.prototype.toJSON=function(){return r.omit(g.__super__.toJSON.apply(this,arguments),"self_signup")},g.mixin(l),g.prototype.sync=function(s,e,t){var r,n,u=this;return null==t&&(t={}),t.url=this.urlFor(s),"create"===s&&"1"===e.get("split_groups")?(r=null!=(n=t.success)?n:function(){},t.success=function(s){return u.progressStarting=!0,r(s),u.assignUnassignedMembers()}):"delete"===s&&e.progressModel&&(e.progressModel.onPoll=function(){}),o.sync(s,e,t)},g.prototype.urlFor=function(s){return"create"===s?this._defaultUrl():"/api/v1/group_categories/"+this.id+"?includes[]=unassigned_users_count&includes[]=groups_count"},g}(o.Model)})}).call(this);