(function(){var t=function(t,r){return function(){return t.apply(r,arguments)}},r={}.hasOwnProperty,e=function(t,e){function n(){this.constructor=t}for(var o in e)r.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},n=[].slice;define(["jquery","underscore","Backbone","jquery.ajaxJSON"],function(r,o,i){var u,a,s;return a=i.Model,u=function(i){function u(){return this.saveFrd=t(this.saveFrd,this),s=u.__super__.constructor.apply(this,arguments)}return e(u,i),u.prototype.initialize=function(t,r){return this.preflightUrl=r.preflightUrl,u.__super__.initialize.apply(this,arguments)},u.prototype.save=function(t,e){var n,o,i,u=this;return null==t&&(t={}),null==e&&(e={}),this.set(t),n=r.Deferred(),o=this.get("file"),i=(o.value||o.name).split(/[\/\\]/).pop(),r.ajaxJSON(this.preflightUrl,"POST",{name:i,on_duplicate:"rename"},function(t){return u.saveFrd(t,n,o,e)},function(t){return n.reject(t),"function"==typeof e.error?e.error(t):void 0}),n},u.prototype.saveFrd=function(t,r,e,n){return t.attachments&&t.attachments[0]&&(t=t.attachments[0]),this.uploadParams=t.upload_params,this.set(this.uploadParams),e.name=t.file_param,this.url=function(){return t.upload_url},a.prototype.save.call(this,null,{multipart:!0,success:function(t){return r.resolve(t),"function"==typeof n.success?n.success(t):void 0},error:function(t){return r.reject(t),"function"==typeof n.error?n.error(t):void 0}})},u.prototype.toJSON=function(){var t;return o.pick.apply(o,[this.attributes,"file"].concat(n.call(o.keys(null!=(t=this.uploadParams)?t:{}))))},u.prototype.present=function(){return o.clone(this.attributes)},u}(a)})}).call(this);