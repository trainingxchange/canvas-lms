(function(){var t={}.hasOwnProperty,r=function(r,e){function i(){this.constructor=r}for(var o in e)t.call(e,o)&&(r[o]=e[o]);return i.prototype=e.prototype,r.prototype=new i,r.__super__=e.prototype,r};define(["jquery","underscore","Backbone","i18n!pages","compiled/backbone-ext/DefaultUrlMixin","compiled/str/splitAssetString","compiled/jquery.rails_flash_notifications"],function(t,e,i,o,n){var s,l,u;return l=["contextAssetString","page","pageUrl","latest","summary"],s=function(i){function s(){return u=s.__super__.constructor.apply(this,arguments)}return r(s,i),s.mixin(n),s.prototype.initialize=function(t,r){return s.__super__.initialize.apply(this,arguments),e.extend(this,e.pick(r||{},l)),e.has(this,"url")?delete this.url:void 0},s.prototype.urlRoot=function(){return"/api/v1/"+this._contextPath()+"/pages/"+this.pageUrl+"/revisions"},s.prototype.url=function(){var t;return t=this.urlRoot(),this.latest?""+t+"/latest":this.get("revision_id")?""+t+"/"+this.get("revision_id"):t},s.prototype.fetch=function(t){var r,e,i;return null==t&&(t={}),this.summary&&(null==(e=t.data)&&(t.data={}),null==(i=(r=t.data).summary)&&(r.summary=!0)),s.__super__.fetch.call(this,t)},s.prototype.pollForChanges=function(t){var r,i=this;return null==t&&(t=3e4),this.polling=!0,this._poller||(r=function(){return i.polling?i.fetch().done(function(t,e,i){return e=i.status.toString(),"4"!==e[0]&&"5"!==e[0]?r():void 0}):void 0},this._poller=r=e.throttle(r,t,{leading:!1})),this._poller()},s.prototype.stopPolling=function(){return this.polling=!1},s.prototype.parse=function(t){return t.url&&(t.id=t.url),t},s.prototype.toJSON=function(){return e.omit(s.__super__.toJSON.apply(this,arguments),"id")},s.prototype.restore=function(){var r;return r=t.ajaxJSON(this.url(),"POST").fail(function(){return t.flashError(o.t("restore_failed","Failed to restore page revision"))}),t("#wiki_page_revisions").disableWhileLoading(t.Deferred()),r},s}(i.Model)})}).call(this);