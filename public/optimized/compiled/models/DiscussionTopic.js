(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["i18n!discussion_topics","Backbone","jquery","underscore","compiled/collections/ParticipantCollection","compiled/collections/DiscussionEntriesCollection","compiled/models/Assignment","compiled/models/DateGroup"],function(e,i,r,s,o,u,p,a){var l,c;return l=function(l){function d(){return this.groupCategoryId=t(this.groupCategoryId,this),this.present=t(this.present,this),c=d.__super__.constructor.apply(this,arguments)}return n(d,l),d.prototype.resourceName="discussion_topics",d.prototype.defaults={discussion_type:"side_comment",podcast_enabled:!1,podcast_has_student_posts:!1,require_initial_post:!1,is_announcement:!1,subscribed:!1,user_can_see_posts:!0,subscription_hold:null,publishable:!0,unpublishable:!0},d.prototype.dateAttributes=["last_reply_at","posted_at","delayed_post_at"],d.prototype.initialize=function(){var t=this;return this.participants=new o,this.entries=new u,this.entries.url=function(){return""+s.result(t,"url")+"/entries"},this.entries.participants=this.participants},d.prototype.parse=function(t){var e;return t.set_assignment=null!=t.assignment,e=t.assignment||{},e.assignment_overrides||(e.assignment_overrides=[]),e.turnitin_settings||(e.turnitin_settings={}),t.assignment=this.createAssignment(e),t.publishable=t.can_publish,t.unpublishable=t.can_unpublish,t},d.prototype.createAssignment=function(t){var e;return e=new p(t),e.alreadyScoped=!0,e},d.prototype.present=function(){return i.Model.prototype.toJSON.call(this)},d.prototype.publish=function(){return this.updateOneAttribute("published",!0)},d.prototype.unpublish=function(){return this.updateOneAttribute("published",!1)},d.prototype.disabledMessage=function(){return e.t("cannot_unpublish_with_replies","Can't unpublish if there are replies")},d.prototype.topicSubscribe=function(){var t;return t=s.result(this,"url"),this.set("subscribed",!0),r.ajaxJSON(""+t+"/subscribed","PUT")},d.prototype.topicUnsubscribe=function(){var t;return t=s.result(this,"url"),this.set("subscribed",!1),r.ajaxJSON(""+t+"/subscribed","DELETE")},d.prototype.toJSON=function(){var t,e;return t=d.__super__.toJSON.apply(this,arguments),t.set_assignment||delete t.assignment,s.extend(t,{summary:this.summary(),unread_count_tooltip:this.unreadTooltip(),reply_count_tooltip:this.replyTooltip(),assignment:null!=(e=t.assignment)?e.toJSON():void 0,defaultDates:this.defaultDates().toJSON()})},d.prototype.toView=function(){return s.extend(this.toJSON(),{name:this.get("title")})},d.prototype.unreadTooltip=function(){return e.t("unread_count_tooltip",{zero:"No unread replies.",one:"1 unread reply.",other:"%{count} unread replies."},{count:this.get("unread_count")})},d.prototype.replyTooltip=function(){return e.t("reply_count_tooltip",{zero:"No replies.",one:"1 reply.",other:"%{count} replies."},{count:this.get("discussion_subentry_count")})},d.prototype.fetchEntries=function(){var t,e=this;return t=s.result(this,"url"),r.get(""+t+"/view",function(t){var n,i,r,s;return s=t.unread_entries,i=t.forced_entries,r=t.participants,n=t.view,e.unreadEntries=s,e.forcedEntries=i,e.participants.reset(r),e.entries.reset(n)})},d.prototype.summary=function(){return r("<div/>").html(this.get("message")).text()||""},d.prototype.updateOneAttribute=function(t,e,n){var i;return null==n&&(n={}),i={},i[t]=e,this.updatePartial(i,n)},d.prototype.updatePartial=function(t,e){return null==e&&(e={}),e.wait||this.set(t),e=s.defaults(e,{data:JSON.stringify(t),contentType:"application/json"}),this.save({},e)},d.prototype.positionAfter=function(t){var e,n;return this.updateOneAttribute("position_after",t,{wait:!0}),e=this.collection,n=e.indexOf(e.get(t)),e.remove(this,{silent:!0}),e.models.splice(n,0,this),e.reset(e.models)},d.prototype.defaultDates=function(){var t;return t=new a({due_at:this.dueAt(),unlock_at:this.unlockAt(),lock_at:this.lockAt()})},d.prototype.dueAt=function(){var t;return null!=(t=this.get("assignment"))?t.get("due_at"):void 0},d.prototype.unlockAt=function(){var t,e;return(t=null!=(e=this.get("assignment"))?e.get("unlock_at"):void 0)?t:this.get("delayed_post_at")},d.prototype.lockAt=function(){var t,e;return(t=null!=(e=this.get("assignment"))?e.get("lock_at"):void 0)?t:this.get("lock_at")},d.prototype.updateBucket=function(t){return s.defaults(t,{pinned:this.get("pinned"),locked:this.get("locked")}),this.set("position",null),this.updatePartial(t)},d.prototype.groupCategoryId=function(t){return arguments.length>0?this.set("group_category_id",t):this.get("group_category_id")},d.prototype.canGroup=function(){return this.get("can_group")},d}(i.Model)})}).call(this);