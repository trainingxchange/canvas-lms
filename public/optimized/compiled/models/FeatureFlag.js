(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t};define(["jquery","underscore","Backbone"],function(e,o,r){var s,i;return s=function(r){function s(){return this.updateTransitions=t(this.updateTransitions,this),i=s.__super__.constructor.apply(this,arguments)}return n(s,r),s.prototype.LABEL={beta:{cssClass:"info",name:"beta"},hidden:{cssClass:"default",name:"hidden"},development:{cssClass:"important",name:"development"}},s.prototype.resourceName="features",s.prototype.urlRoot=function(){return"/api/v1/"+this.contextType()+"s/"+this.contextId()+"/features/flags"},s.prototype.flagContext=function(){var t;return t=this.get("flag"),(""+t.context_type+"_"+t.context_id).toLowerCase()},s.prototype.hasContext=function(){var t;return t=this.get("flag"),t.context_type&&t.context_id},s.prototype.isAllowed=function(){return"allowed"===this.get("state")},s.prototype.isOn=function(){return"on"===this.get("state")},s.prototype.isOff=function(t){var e,n;return null==t&&(t=!1),e=o.include(["off","hidden"],this.get("state")),n=!this.currentContextIsAccount()&&this.isAllowed(),t?e||n:e},s.prototype.isHidden=function(){return this.get("hidden")},s.prototype.isSiteAdmin=function(){var t;return!!(null!=(t=ENV.ACCOUNT)?t.site_admin:void 0)},s.prototype.contextType=function(){return ENV.context_asset_string.split("_")[0]},s.prototype.contextId=function(){return ENV.context_asset_string.split("_")[1]},s.prototype.isContext=function(t){return this.contextType()===t.toLowerCase()},s.prototype.currentContextIsAccount=function(){return"account"===ENV.context_asset_string.split("_")[0]},s.prototype.warningFor=function(t){var e;return e=this.transitions()[t],(null!=e?e.message:void 0)?e:!1},s.prototype.updateTransitions=function(){var t=this;return e.getJSON(this.url()).then(function(e){var n;return n=e.transitions,t.get("feature_flag").transitions=n})},s.prototype.transitions=function(){return this.get("feature_flag").transitions},s.prototype.transitionLocked=function(t){var e;return e=this.transitions()[t],(null!=e?e.locked:void 0)&&!e.message},s.prototype.toJSON=function(){return o.extend(s.__super__.toJSON.apply(this,arguments),{isAllowed:this.isAllowed(),isHidden:this.isHidden()},{isOff:this.isOff(!0),isOn:this.isOn(),isSiteAdmin:this.isSiteAdmin(),currentContextIsAccount:this.isContext("account"),disableOn:this.transitionLocked("on"),disableAllow:this.transitionLocked("allowed"),disableOff:this.transitionLocked("off")})},s.prototype.parse=function(t){var e,n;return o.extend(t,this.attributes),e={appliesTo:t.applies_to.toLowerCase(),id:t.feature,title:t.display_name,isLocked:t.feature_flag.locked,flag:t.feature_flag,releaseOn:t.enable_at?new Date(t.enable_at):null,releaseNotesUrl:t.release_notes_url,state:null!=(n=t.feature_flag)?n.state:void 0,labels:[]},t.feature_flag&&(e.flag=t.feature_flag),t.feature_flag&&(e.state=t.feature_flag.state),t.beta&&e.labels.push(s.prototype.LABEL.beta),t.hidden&&e.labels.push(s.prototype.LABEL.hidden),t.development&&e.labels.push(s.prototype.LABEL.development),o.extend(t,e)},s}(r.Model)})}).call(this);