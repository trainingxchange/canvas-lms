(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};define(["underscore","jquery","Backbone","jquery.instructure_forms"],function(e,r,i){var s,o;return s=function(s){function u(){return this.addDaySubsitutions=t(this.addDaySubsitutions,this),this.save=t(this.save,this),this.urlRoot=t(this.urlRoot,this),o=u.__super__.constructor.apply(this,arguments)}return n(u,s),u.prototype.urlRoot=function(){return"/api/v1/courses/"+this.get("course_id")+"/content_migrations"},u.dynamicDefaults={},u.prototype.initialize=function(t){return u.__super__.initialize.apply(this,arguments),this.dynamicDefaults=t},u.prototype.resetModel=function(){return this.clear(),this.resetDynamicDefaultCollections(),this.set(this.dynamicDefaults)},u.prototype.resetDynamicDefaultCollections=function(){return e.each(this.dynamicDefaults,function(t){var n,r;return t instanceof i.Collection?(n=t,r=n.map(function(t){return t}),e.each(r,function(t){return n.remove(t)})):void 0})},u.prototype.save=function(){var t,e,n=this;return this.get("pre_attachment")?(t=r.Deferred(),e=this.get("pre_attachment").fileElement,delete this.get("pre_attachment").fileElement,u.__super__.save.call(this,null,{error:function(e){return t.rejectWith(n,e.responseText)},success:function(){var r;return r=new i.Model(n.get("pre_attachment").upload_params),r.url=function(){return n.get("pre_attachment").upload_url},r.set("attachment",e),r.save(null,{multipart:e,success:function(e,r){return r.message?t.rejectWith(n,r.message):n.fetch({success:function(){return t.resolve()}})},error:function(e){return t.rejectWith(n,e)}})}}),t):u.__super__.save.apply(this,arguments)},u.prototype.toJSON=function(){var t;return t=u.__super__.toJSON.apply(this,arguments),this.addDaySubsitutions(t),t},u.prototype.addDaySubsitutions=function(t){var e;return e=this.daySubCollection,t.date_shift_options||(t.date_shift_options={}),e?t.date_shift_options.day_substitutions=e.toJSON():void 0},u.prototype.setDateShiftOptions=function(t){var e,n,i,s;return s=t.value,n=t.property,i=t.silent,e=this.get("date_shift_options")||{},e[n]=r.datetime.process(s),this.set("date_shift_options",e,{silent:i})},u}(i.Model)})}).call(this);