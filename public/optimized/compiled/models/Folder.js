(function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};define(["require","Backbone","jquery","underscore","compiled/util/deparam","compiled/collections/PaginatedCollection","compiled/collections/FilesCollection","compiled/collections/FoldersCollection"],function(e,r,n,o,i,s,l){var p,d;return p=function(r){function s(){return d=s.__super__.constructor.apply(this,arguments)}var p;return t(s,r),s.prototype.defaults={name:"",sort:"name",order:"asc"},s.prototype.initialize=function(e){return this.contentTypes||(this.contentTypes=null!=e?e.contentTypes:void 0),this.setUpFilesAndFoldersIfNeeded(),this.on("change:sort change:order",this.setQueryStringParams),s.__super__.initialize.apply(this,arguments)},s.prototype.parse=function(e){var t;return t=s.__super__.parse.apply(this,arguments),this.contentTypes||(this.contentTypes=e.contentTypes),this.setUpFilesAndFoldersIfNeeded(),this.folders.url=e.folders_url,this.files.url=e.files_url,t},s.prototype.setUpFilesAndFoldersIfNeeded=function(){var t;return this.folders||(t=e("compiled/collections/FoldersCollection"),this.folders=new t([],{parentFolder:this})),this.files?void 0:this.files=new l([],{parentFolder:this})},s.prototype.expand=function(e){var t,r,o=this;return null==e&&(e=!1),this.isExpanded=!0,this.trigger("expanded"),this.expandDfd||e?void 0:(this.isExpanding=!0,this.trigger("beginexpanding"),this.expandDfd=n.Deferred().done(function(){return o.isExpanding=!1,o.trigger("endexpanding")}),r=this.folders.url===this.folders.constructor.prototype.url||this.files.url===this.files.constructor.prototype.url,(r||e)&&(t=this.fetch()),n.when(t).done(function(){var e,t;return 0!==o.get("folders_count")&&(t=o.folders.fetch()),0!==o.get("files_count")&&(e=o.files.fetch()),n.when(t,e).done(o.expandDfd.resolve)}))},s.prototype.collapse=function(){return this.isExpanded=!1,this.trigger("collapsed")},s.prototype.toggle=function(){return this.isExpanded?this.collapse():this.expand()},s.prototype.previewUrl=function(){var e;return"Course"===(e=this.get("context_type"))||"Group"===e?"/"+(this.get("context_type").toLowerCase()+"s")+"/"+this.get("context_id")+"/files/{{id}}/preview":void 0},s.resolvePath=function(e,t,r){var o;return o="/api/v1/"+e+"/"+t+"/folders/by_path"+r,n.get(o).pipe(function(e){return e.map(function(e){return new s(e,{parse:!0})})})},p=function(e,t){var r;return"name"!==t||e instanceof s?"user"===t?null!=(r=e.get("user"))?r.display_name:void 0:e.get(t):e.get("display_name")},s.prototype.childrenSorter=function(e,t){var r,n;return n=this.get("sort"),e=p(e,n),t=p(t,n),r=function(){if(e===t)return 0;if(e>t||void 0===e)return 1;if(t>e||void 0===t)return-1;throw new Error("wat? error sorting")}(),"desc"===this.get("order")&&(r=0-r),r},s.prototype.children=function(){return this.folders.toArray().concat(this.files.toArray()).sort(this.childrenSorter.bind(this))},s.prototype.loadAll=function(){var e,t=this;return e=function(e){var r;return(r=function(){return t[e].loadedAll?void 0:t[e].fetch({page:"next"}).pipe(r)})()},n.when.apply(n,["folders","files"].map(e))},s.prototype.setQueryStringParams=function(){var e,t=this;return e={include:["user"],per_page:20,sort:this.get("sort"),order:this.get("order")},["folders","files"].map(function(r){var s,l;if(!t[r].loadedAll)return l=new URL(t[r].url),s=i(l.search),l.search=n.param(o.extend(s,e)),t[r].url=l.toString(),t[r].reset()})},s}(r.Model)})}).call(this);