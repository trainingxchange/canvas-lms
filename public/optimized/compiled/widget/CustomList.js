(function(){define(["jquery","compiled/util/objectCollection","jst/courseList/wrapper","jst/courseList/content","jquery.ajaxJSON"],function(t,e,i,s){var n;return n=function(){function n(e,i,s){this.options=t.extend({},this.options,s),this.appendTarget=t(this.options.appendTarget),this.element=t(e),this.targetList=this.element.find("> ul"),this.wrapper=t(this.options.wrapper({})),this.sourceList=this.wrapper.find("> ul"),this.contentTemplate=this.options.content,this.ghost=t("<ul/>").addClass("customListGhost"),this.requests={add:{},remove:{}},this.doc=t(document.body),this.attach(),this.setItems(i),this.options.autoOpen&&this.open()}return n.prototype.options={animationDuration:200,dataAttribute:"id",wrapper:i,content:s,url:"/api/v1/users/self/favorites/courses",appendTarget:"body",resetCount:12,onToggle:!1},n.prototype.open=function(t){var e=this;return t&&t.preventDefault(),this.wrapper.appendTo(this.appendTarget).show(),setTimeout(function(){var t;return e.element.addClass("customListEditing"),"function"==typeof(t=e.options).onToggle&&t.onToggle(!0),document.activeElement.blur(),e.wrapper.find("li a").first().focus()},1),this.element.find(".customListOpen").attr({"aria-expanded":"true"})},n.prototype.close=function(t){var e;return t&&t.preventDefault(),this.wrapper.hide(),this.element.removeClass("customListEditing"),"function"==typeof(e=this.options).onToggle&&e.onToggle(!1),0===this.pinned.length&&this.resetList(),document.activeElement.blur(),this.element.find(".customListOpen").focus().attr({"aria-expanded":"false"})},n.prototype.attach=function(){var e;return this.element.delegate(".customListOpen","click",t.proxy(this,"open")),this.wrapper.delegate(".customListClose","click",t.proxy(this,"close")),this.wrapper.delegate(".customListRestore","click",t.proxy(this,"reset")),this.wrapper.delegate("a","click.customListTeardown",function(t){return t.preventDefault()}),this.wrapper.delegate(".customListItem","click.customListTeardown",t.proxy(this,"sourceClickHandler")),e="customListWrapper-"+t.guid++,this.wrapper.appendTo(this.appendTarget).attr({id:e}).hide(),this.element.find(".customListOpen").attr({role:"button","aria-expanded":"false","aria-controls":e})},n.prototype.setOn=function(t,e){return t.toggleClass("on",e),t.find("a").attr("aria-checked",e.toString())},n.prototype.add=function(t,e){var i,s,n,r;return n=this.items.findBy("id",t),i=e.clone().hide(),n.element=i,this.setOn(e,!0),this.pinned.push(n),this.pinned.sortBy("shortName"),s=this.pinned.indexOf(n)+1,r=this.targetList.find("li:nth-child("+s+")"),0!==r.length?i.insertBefore(r):i.appendTo(this.targetList),i.slideDown(this.options.animationDuration),this.animateGhost(e,i),this.onAdd(n)},n.prototype.animateGhost=function(t,e){var i,s,n,r=this;return s=t.offset(),n=e.offset(),i=t.clone(),s.position="absolute",this.ghost.append(i),this.ghost.appendTo(this.doc).css(s).animate(n,this.options.animationDuration,function(){return r.ghost.detach().empty()})},n.prototype.remove=function(t,e){var i=this;return this.setOn(e,!1),this.animating=!0,this.onRemove(t),t.element.slideUp(this.options.animationDuration,function(){return t.element.remove(),i.pinned.eraseBy("id",t.id),i.animating=!1})},n.prototype.abortAll=function(){var t,e,i,s,n;i=this.requests.add;for(t in i)e=i[t],e.abort();s=this.requests.remove,n=[];for(t in s)e=s[t],n.push(e.abort());return n},n.prototype.reset=function(){var e,i=this;return this.abortAll(),e=function(){return delete i.requests.reset},this.requests.reset=t.ajaxJSON(this.options.url,"DELETE",{},e,e),this.resetList()},n.prototype.resetList=function(){var t,e;return t=this.items.slice(0,this.options.resetCount),e=this.contentTemplate({items:t}),this.targetList.empty().html(e),this.setPinned()},n.prototype.onAdd=function(e){var i,s,n,r,o=this;return this.requests.remove[e.id]?void this.requests.remove[e.id].abort():(n=function(){var t;return t=[].slice.call(arguments),t.unshift(e.id),o.addSuccess.apply(o,t)},i=function(){var t;return t=[].slice.call(arguments),t.unshift(e.id),o.addError.apply(o,t)},r=this.options.url+"/"+e.id,s=t.ajaxJSON(r,"POST",{},n,i),this.requests.add[e.id]=s)},n.prototype.onRemove=function(e){var i,s,n,r,o=this;return this.requests.add[e.id]?void this.requests.add[e.id].abort():(n=function(){var t;return t=[].slice.call(arguments),t.unshift(e.id),o.removeSuccess.apply(o,t)},i=function(){var t;return t=[].slice.call(arguments),t.unshift(e.id),o.removeError.apply(o,t)},r=this.options.url+"/"+e.id,s=t.ajaxJSON(r,"DELETE",{},n,i),this.requests.remove[e.id]=s)},n.prototype.addSuccess=function(t){return delete this.requests.add[t]},n.prototype.addError=function(t){return delete this.requests.add[t]},n.prototype.removeSuccess=function(t){return delete this.requests.remove[t]},n.prototype.removeError=function(t){return delete this.requests.remove[t]},n.prototype.setItems=function(t){var i;return this.items=e(t),this.items.sortBy("shortName"),i=this.contentTemplate({items:this.items}),this.sourceList.html(i),this.setPinned()},n.prototype.setPinned=function(){var i,s,n,r,o,a,p=this;for(this.pinned=e([]),this.element.find("> ul > li").each(function(e,i){var s,n;return i=t(i),s=i.data("id"),s=s&&String(s),(n=p.items.findBy("id",s))?(n.element=i,p.pinned.push(n)):void 0}),this.setOn(this.wrapper.find("ul > li"),!1),o=this.pinned,a=[],n=0,r=o.length;r>n;n++)i=o[n],s=this.wrapper.find("ul > li[data-id="+i.id+"]"),a.push(this.setOn(s,!0));return a},n.prototype.sourceClickHandler=function(e){return this.checkElement(t(e.currentTarget))},n.prototype.checkElement=function(t){var e,i;if(!this.animating&&!this.requests.reset)return e=t.data("id"),e=e&&String(e),i=this.pinned.findBy("id",e),i?this.remove(i,t):this.add(e,t)},n}()})}).call(this);