(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function o(){this.constructor=t}for(var s in n)e.call(n,s)&&(t[s]=n[s]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t};define(["i18n!recipient_input","jquery","underscore","compiled/util/contextList","compiled/widget/TokenInput","str/htmlEscape","jst/_avatar"],function(e,o,s,r,a,i,c){var u;return u=function(a){function i(e,n){this.contextList=t(this.contextList,this),this.buildContextInfo=t(this.buildContextInfo,this),this.populator=t(this.populator,this),n=o.extend(!0,{},this.defaults(),n),this.prefixUserIds=n.prefixUserIds,this.contexts=n.contexts,n.canToggle&&(this.canToggle=n.canToggle),i.__super__.constructor.call(this,e,n)}return n(i,a),i.prototype.defaults=function(){return{placeholder:e.t("context_search_placeholder","Enter a name, course, or group"),title:e.t("context_search_title","Name, course, or group"),selector:{messages:{noResults:e.t("no_results","No results found")},populator:this.populator,baseData:{synthetic_contexts:1,blank_avatar_fallback:!1},browser:{data:{types:["context"]}}}}},i.prototype.populator=function(t,n,s,r){var a,i,u,p,l,d,x,h,_;return null==r&&(r={}),d=null!=(h=r.noExpand)?h:s.noExpand,s.id=""+s.id,null==(_=s.type)&&(s.type="user"),s.avatar_url&&n.append("user"===s.type?c(s):o('<div class="avatar-box" />')),a=o("<b />"),a.text(s.name),u=o("<span />",{id:""+s.type+"-"+s.id+"-description"}),p=o("<span />",{"class":"name"}),r.parent||(i=this.buildContextInfo(s)),p.append(a,i),l=o("<span />",{"class":"details"}),null!=s.common_courses?l.html(this.contextList({courses:s.common_courses,groups:s.common_groups})):null!=s.user_count?l.text(e.t("people_count","person",{count:s.user_count})):null!=s.item_count?s.id.match(/_groups$/)?l.text(e.t("groups_count","group",{count:s.item_count})):s.id.match(/_sections$/)&&l.text(e.t("sections_count","section",{count:s.item_count})):s.subText&&l.text(s.subText),u.append(p,l),n.append(u),n.attr("role","menuitem"),n.attr("aria-labelledby",""+s.type+"-"+s.id+"-description"),x=s.name,r.parent&&(s.selectAll&&d?x=r.parent.data("text"):s.id.match(/_\d+_/)&&(x=e.beforeLabel(r.parent.data("text"))+" "+x)),n.data("text",x),n.data("id","context"!==s.type&&this.prefixUserIds?"user_"+s.id:s.id),s.rootId=r.ancestors[0],n.data("user_data",s),n.addClass(s.type),r.level>0&&t.options.showToggles&&(n.prepend('<a class="toggle"><i></i></a>'),this.canToggle(s)&&n.addClass("toggleable")),"context"!==s.type||d?void 0:(n.prepend('<a class="expand"><i></i></a>'),n.addClass("expandable"))},i.prototype.canToggle=function(t){return!t.item_count},i.prototype.buildContextInfo=function(t){var e,n,s;return n=t.id.match(/^(course|section)_(\d+)$/),n&&(s=this.contexts[""+n[1]+"s"][n[2]]),e=t.context_name||"",e=e.length<40?e:e.substr(0,40)+"...",(null!=s?s.term:void 0)&&(e=e?""+e+" - "+s.term:s.term),e?o("<span />",{"class":"context_info"}).text("("+e+")"):""},i.prototype.contextList=function(t){return t={courses:s.keys(t.courses),groups:s.keys(t.groups)},r(t,this.contexts,{linkToContexts:!1,hardCutoff:2})},i}(a),o.fn.contextSearch=function(t){return this.each(function(){return new u(o(this),o.extend(!0,{},t))})},u})}).call(this);