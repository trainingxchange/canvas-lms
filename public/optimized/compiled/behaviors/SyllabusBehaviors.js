(function(){define(["jquery","calendar_move","wikiSidebar","jquery.instructure_date_and_time","jquery.instructure_forms","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.loadingImg","compiled/tinymce","tinymce.editor_box","vendor/jquery.scrollTo","jqueryui/datepicker"],function(e,t,n){var r,i,a,s,d,o,l,u,c,_;return c=!1,d=function(){var t,n;return t=e(".mini_month"),n=e("#syllabus"),t&&n?(t.find(".day.has_event").removeClass("has_event"),n.find("tr.date:visible").each(function(){var n;return n=e(this).find(".day_date").attr("data-date"),t.find("#mini_day_"+n).addClass("has_event")})):void 0},s=function(t){var n,r;return n=e(".mini_month"),r=e("#syllabus"),e("tr.date.related, .day.related").removeClass("related"),t&&(n&&n.find("#mini_day_"+t).addClass("related"),r)?r.find("tr.date.events_"+t).addClass("related"):void 0},o=function(t,n){var r,i,a,s,d,o;if(r=e("#syllabus"),r.find(".detail_list tr.related_event").removeClass("related_event"),t&&r){for(d=r.find(".detail_list tr.related-"+t),o=[],a=0,s=d.length;s>a;a++)i=d[a],i!==n&&o.push(e(i).addClass("related_event"));return o}},_=function(){var t;return e(".special_date").each(function(){var t,n;return n=e(this),t=n,n.siblings().not(".special_date").length||(t=n.closest("tr.date")),t.toggle(c)}),t=e("#toggle_special_dates_in_syllabus"),t.removeClass("hidden").removeClass("shown"),t.addClass(c?"shown":"hidden"),c=!c,d()},a=function(){var t,n,r;return t=e("#syllabus"),t.on("mouseenter mouseleave","tr.date",function(t){var n;return"mouseenter"===t.type&&(n=e(this).find(".day_date").attr("data-date")),s(n)}),t.on("mouseenter mouseleave","tr.date .detail_list tr",function(t){var n,r,i,a,s,d;if(r=null,"mouseenter"===t.type)for(d=null!=(s=e(this).attr("class"))?s.split(/\s+/):void 0,i=0,a=d.length;a>i;i++)if(n=d[i],"related-"===n.substr(0,8)){r=n.substr(8);break}return o(r,this)}),n=e("#toggle_special_dates_in_syllabus"),n.on("click",function(e){return e.preventDefault(),_()}),d(),r=e.datepicker.formatDate("yy_mm_dd",new Date),s(r)},u=function(t){return t.length>0?(e("tr.selected").removeClass("selected"),t.addClass("selected"),e("html, body").scrollTo(t),t.find("a").first().focus()):void 0},l=function(t){return e(".mini_month .day.selected").removeClass("selected"),e(".mini_month").find("#mini_day_"+t).addClass("selected")},i=function(){var n,r;return n=e(".mini_month"),r=n.find(".next_month_link, .prev_month_link"),r.on("click",!1),r.on("mousedown",function(r){return r.preventDefault(),t.changeMonth(n,e(this).hasClass("next_month_link")?1:-1),d()}),n.on("click",".mini_calendar_day",function(r){var i,a,s,o,c;return r.preventDefault(),i=this.id.slice(9),c=i.split("_"),o=c[0],s=c[1],a=c[2],t.changeMonth(n,""+s+"/"+a+"/"+o),d(),l(i),e(".events_"+i).ifExists(function(e){return u(e,r)})}),n.on("mouseover mouseout",".mini_calendar_day",function(e){var t;return"mouseout"!==e.type&&(t=this.id.slice(9)),s(t)}),e(".jump_to_today_link").on("click",function(r){var i,a;return r.preventDefault(),a=e.datepicker.formatDate("yy_mm_dd",new Date),i=void 0,e("tr.date").each(function(){var t;return t=e(this).find(".day_date").attr("data-date"),!t||t>a?!1:i=e(this)}),t.changeMonth(n,e.datepicker.formatDate("mm/dd/yy",new Date)),d(),i||(i=e("tr.date:first")),l(a),u(i,r)})},r=function(){var t,r,i,a;return a=e("#edit_course_syllabus_form"),r=e("#course_syllabus_body"),t=e("#course_syllabus"),i=e("#course_syllabus_details"),t.data("syllabus_body",ENV.SYLLABUS_BODY),n&&n.init(),a.on("edit",function(){return a.show(),t.hide(),i.hide(),r.editorBox(),r.editorBox("set_code",t.data("syllabus_body")),n?(n.attachToEditor(r),n.show(),e("#sidebar_content").hide()):void 0}),a.on("hide_edit",function(){var s;return a.hide(),t.show(),s=e.trim(t.html()),i.showIf(!s),r.editorBox("destroy"),e("#sidebar_content").show(),n?n.hide():void 0}),e(".edit_syllabus_link").on("click",function(e){return e.preventDefault(),a.triggerHandler("edit")}),a.on("click",".toggle_views_link",function(t){return t.preventDefault(),r.editorBox("toggle"),e(t.currentTarget).siblings(".toggle_views_link").andSelf().toggle()}),a.on("click",".cancel_button",function(e){return e.preventDefault(),a.triggerHandler("hide_edit")}),a.formSubmit({object_name:"course",processData:function(e){return e["course[syllabus_body]"]=r.editorBox("get_code"),e},beforeSubmit:function(){return a.triggerHandler("hide_edit"),i.hide(),t.loadingImage()},success:function(e){return t.loadingImage("remove").html(e.course.syllabus_body),t.data("syllabus_body",e.course.syllabus_body),i.hide()},error:function(e){return a.triggerHandler("edit").formErrors(e)}})},{bindToEditSyllabus:r,bindToMiniCalendar:i,bindToSyllabus:a}})}).call(this);