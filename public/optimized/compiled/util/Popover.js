(function(){var t=function(t,i){return function(){return t.apply(i,arguments)}};define(["jquery"],function(i){var e,o,s,r;return r=function(t,e){return i(this).css(t).toggleClass("carat-bottom","bottom"===e.vertical)},s=0,o=[],e=function(){function e(e,o,s){var r=this;this.content=o,this.options=null!=s?s:{},this.position=t(this.position,this),this.outsideClickHandler=t(this.outsideClickHandler,this),this.trigger=i(e.currentTarget),this.el=i(this.content).addClass("carat-bottom").attr("role","dialog").data("popover",this).keyup(function(t){return t.keyCode===i.ui.keyCode.ESCAPE?r.hide():void 0}),this.el.delegate(".popover_close","click",function(t){return t.preventDefault(),r.hide()}),this.show(e)}return e.prototype.show=function(t){for(var e,r,n,a,h,l,c;l=o.pop();)l.hide();return o.push(this),a="popover-"+s++,this.trigger.attr({"aria-haspopup":!0,"aria-owns":a}),this.el.attr({id:a,"aria-hidden":!1,"aria-expanded":!0}).appendTo(document.body).show(),this.el.find(":tabbable").not(".popover_close").first().focus(1),this.position(),this.el.find(".ui-menu-carat").remove(),n=this.trigger.offset().left-this.el.offset().left,e=t.pageX-this.trigger.offset().left,h=Math.max(0,this.trigger.width()/2-this.el.width()/2)+20,c=this.trigger.width()-h,r=Math.min(Math.max(h,e),c)+n,i('<span class="ui-menu-carat"><span /></span>').css("left",r).prependTo(this.el),this.positionInterval=setInterval(this.position,200),i(window).click(this.outsideClickHandler)},e.prototype.hide=function(){var t,e,s,r;for(t=s=0,r=o.length;r>s;t=++s)e=o[t],this===e&&o.splice(t,1);return this.el.detach(),clearInterval(this.positionInterval),i(window).unbind("click",this.outsideClickHandler),this.trigger&&this.trigger.is(":visible")?this.trigger.focus():void 0},e.prototype.ignoreOutsideClickSelector=".ui-dialog",e.prototype.outsideClickHandler=function(t){return i(t.target).closest(this.el.add(this.trigger).add(this.ignoreOutsideClickSelector)).length?void 0:this.hide()},e.prototype.position=function(){return this.el.position({my:"center "+("bottom"===this.options.verticalSide?"top":"bottom"),at:"center "+(this.options.verticalSide||"top"),of:this.trigger,offset:"0 -10px",within:"body",collision:"flipfit "+(this.options.verticalSide?"none":"flipfit"),using:r})},e}()})}).call(this);