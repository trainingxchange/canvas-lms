(function(){define(["i18n!submissions","ember","../register","../templates/components/ic-submission-download-dialog","jqueryui/progressbar","jqueryui/dialog"],function(e,t,i){return i("component","ic-submission-download-dialog",t.Component.extend({isOpened:!1,isChecking:!0,attachment:{},percentComplete:0,hideIndicator:t.computed.not("isChecking"),showFileLink:t.computed.equal("status","finished"),sizeOfFile:t.computed.alias("attachment.readable_size"),dialogTitle:e.t("download_submissions_title","Download Assignment Submissions"),bindFunctions:function(){return this.reviewProgress=this.reviewProgress.bind(this),this.progressError=this.progressError.bind(this),this.checkForChange=this.checkForChange.bind(this)}.on("init"),status:function(){return this.fileReady()?"finished":this.get("percentComplete")>=95?"zipping":"starting"}.property("attachment","percentComplete","isOpened"),progress:function(){var e,t,i;return e=this.get("attachment"),t=0,e&&this.fileReady()?t=100:e&&(t=this.get("percentComplete"),this.get("percentComplete")<95&&(t+=5),i=parseInt(this.get("attachment.file_state")),isNaN(i)&&(t=0)),this.set("percentComplete",t)}.observes("attachment"),keepChecking:function(){return 100!==this.get("percentComplete")&&this.get("isOpened")?!0:void 0}.property("percentComplete","isOpened"),url:function(){return""+this.get("assignmentUrl")+"/submissions?zip=1"}.property("assignmentUrl"),statusText:function(){switch(this.get("status")){case"starting":return e.t("gathering_files","Gathering Files (%{progress})...",{progress:e.toPercentage(this.get("percentComplete"),{precision:0})});case"zipping":return e.t("creating_zip","Creating zip file...");case"finished":return e.t("finished_redirecting","Finished!  Redirecting to File...")}}.property("status","percentComplete"),updateProgressBar:function(){return this.$("#submissions_download_dialog #progressbar").progressbar({value:this.get("percentComplete")})}.observes("percentComplete"),downloadCompletedFile:function(){return 100===this.get("percentComplete")?location.href=this.get("url"):void 0}.observes("percentComplete"),resetAttachment:function(){return this.set("attachment",null)}.observes("isOpened"),setDimensions:function(){return this.get("isOpened")?this.$(".ui-widget-overlay").css({height:$(window).height()+"px",width:$(window).width()+"px"}):void 0}.observes("isOpened"),setPosition:function(){return this.get("isOpened")?this.$(".ui-dialog").css({top:$(window).height()/2-this.$(".ui-dialog").height()/2+"px",left:$(window).width()/2-this.$(".ui-dialog").width()/2+"px"}):void 0}.observes("isOpened"),closeOnEsc:function(e){return 27===e.keyCode?this.close():void 0}.on("keyDown"),actions:{openDialog:function(){return this.set("isOpened",!0),this.$("#submissions_download_dialog .ui-dialog").focus(),this.updateProgressBar(),this.checkForChange()},closeDialog:function(){return this.close()}},close:function(){return this.set("isOpened",!1),this.$("#submissions_download_button").focus()},fileReady:function(){var e;return e=this.get("attachment.workflow_state"),"zipped"===e||"available"===e},checkForChange:function(){return this.set("isChecking",!0),$.ajaxJSON(this.get("url"),"GET",{},this.reviewProgress,this.progressError)},reviewProgress:function(e){return this.set("isChecking",!1),this.set("attachment",e.attachment),this.setCheckTimeOut(3e3)},progressError:function(){return this.set("isChecking",!1),this.setCheckTimeOut(1e3)},setCheckTimeOut:function(e){return this.get("keepChecking")?setTimeout(this.checkForChange,e):void 0}}))})}).call(this);