(function(){define(["ember","../mixins/redirect","../shared/environment","i18n!quiz_moderate_route","../shared/title_builder"],function(e,t,r,n,o){var i;return i=e.Route.extend(t,{beforeModel:function(){return this.validateRoute("canManage","quiz.show")},model:function(){return this.combinedUsersSubmissionsPromise()},afterModel:function(){var e,t;return t=this.modelFor("quiz").get("title"),e=n.t("moderate","Moderate"),o([t,e])},combinedUsersSubmissionsPromise:function(){var e,t;return e=this.modelFor("quiz"),t=this,e.get("studentQuizSubmissions").then(function(r){return r||(r=[]),e.get("users").then(function(e){return t.combineModels(e,r)})})},combineModels:function(e,t){var r;return r=this.createSubHash(t),e.forEach(function(e){var t;return t=r[e.get("id")]||Ember.Object.create(),e.set("quizSubmission",t)}),e},createSubHash:function(e){var t;return t={},e.forEach(function(e){var r;return r=e.get("user.id"),t[r]=e}),t},forceReload:function(t){var r,n,o,i=this;return o=e.RSVP.defer(),o.resolve=function(e){return e.then(function(){return Ember.run.later(i,function(){return this.controllerFor("quiz.moderate").set("reloading",!1)},500),i.combinedUsersSubmissionsPromise().then(function(e){return i.get("controller").set("content",e)})})},n=t.constructor.metaForProperty("studentQuizSubmissions"),r=t.get("links.studentQuizSubmissions"),this.store.findHasMany(t,r,n,o)},actions:{refreshData:function(){var e;return e=this.modelFor("quiz"),this.controllerFor("quiz.moderate").set("reloading",!0),this.forceReload(e)},studentExtension:function(t){var r;return t=t.get("length")?t:[t],r=this.controllerFor("quiz.moderate.student_extension"),r.set("model",e.A(t)),this.render("quiz/moderate/student_extension",{into:"application",outlet:"modal",controller:r})},extendTime:function(e){var t;return t=this.controllerFor("quiz.moderate.extend_time"),t.set("model",e),this.render("quiz/moderate/extend_time",{into:"application",outlet:"modal",controller:t})}}})})}).call(this);