(function(){define(["ember","ic-ajax","i18n!quiz_statistics","jquery.instructure_date_and_time"],function(e,t,r){var n,o,i;return i=e.$,n=i.friendlyDatetime,o=i.fudgeDateForProfileTimezone,e.ObjectController.extend({isLocked:e.computed.alias("busy"),readableTypeLabel:function(){return"item_analysis"===this.get("reportType")?r.t("item_analysis","Item Analysis"):r.t("student_analysis","Student Analysis")}.property("reportType"),generatedAtLabel:function(){return r.t("generated_at","Generated at %{date}",{date:n(o(this.get("file.created_at")))})}.property("file.created_at"),isGenerating:function(){return e.A(["queued","running"]).contains(this.get("progress.workflowState"))}.property("progress.workflowState"),generationStatusLabel:function(){var e;return e=this.get("progress.workflowState"),this.get("isGenerating")?r.t("generating","Report is being generated..."):"completed"===e?r.t("generated","Report is ready."):"failed"===e?r.t("generation_failed","Something went wrong, please try again later."):r.t("generatable","Report has never been generated.")}.property("progress.workflowState"),actions:{generate:function(){var e,r,n=this;return this.get("isLocked")?!1:(this.lock(),r=this.get("quiz.links.quizReports"),e={type:"POST",data:{quiz_report:{report_type:this.get("reportType"),includes_all_versions:!0}}},this.autoDownload=!0,t.raw(r,e).then(function(e){return n.trackProgress(e.response.progress_url)})["catch"](function(){return n.unlock()}))}},trackProgress:function(e){var r=this;return t.raw(e).then(function(e){return r.set("progress",r.store.push("progress",e.response)),r.get("progress").trackCompletion(1e3).then(function(){return r.pullGeneratedReport()})})["catch"](function(){return r.unlock()})},pullGeneratedReport:function(){var e=this;return this.get("model").reload({include:["file"]}).then(function(){return e.autoDownload?e.triggerDownload():void 0})["finally"](function(){return e.unlock()})},triggerDownload:function(){return e.$("<iframe />",{style:"display: none;",src:this.get("file.url")}).appendTo(document.body)},lock:function(){return this.set("busy",!0)},unlock:function(){return this.set("busy",!1)}})})}).call(this);