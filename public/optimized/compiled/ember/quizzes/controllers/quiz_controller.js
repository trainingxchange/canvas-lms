(function(){define(["ember","../mixins/legacy_submission_html","../shared/is_locked","i18n!quiz","jquery","../shared/environment","compiled/jquery.rails_flash_notifications","compiled/bundles/submission_download"],function(e,t,i,s,n,u){var r;return r=e.ObjectController.extend(t,e.Evented,{disabledMessage:s.t("cant_unpublish_when_students_submit","Can't unpublish if there are student submissions"),showAsPublished:!1,isLocked:function(){return i(this.get("unlockAt"),this.get("lockAt"))}.property("unlockAt","lockAt"),displayPublished:function(){return this.set("showAsPublished",this.get("published"))}.observes("model"),moderateEnabled:function(){return u.get("moderateEnabled")}.property(),speedGraderActive:function(){return this.get("studentQuizSubmissions.length")}.property("studentQuizSubmissions.length"),downloadActive:function(){return!!this.get("quizSubmissionsZipUrl")}.property("quizSubmissionsZipUrl"),takeQuizActive:function(){return this.get("published")&&this.get("takeable")&&!this.get("lockedForUser")}.property("published","takeable","lockedForUser"),messageStudentsActive:function(){return this.get("published")}.property("published"),takeOrResumeMessage:function(){return this.get("quizSubmission.isCompleted")?this.get("isSurvey")?s.t("take_the_survey_again","Take the Survey Again"):s.t("take_the_quiz_again","Take the Quiz Again"):this.get("quizSubmission.isUntaken")?this.get("isSurvey")?s.t("resume_the_survey","Resume the Survey"):s.t("resume_the_quiz","Resume the Quiz"):this.get("isSurvey")?s.t("take_the_survey","Take the Survey"):s.t("take_the_quiz","Take the Quiz")}.property("isSurvey","quizSubmisison.isUntaken"),updatePublished:function(e){var t,i,s=this;return i=function(){return s.displayPublished()},t=function(){return s.set("published",!0),s.set("unpublishable",!1),s.displayPublished()},this.set("published",e),this.get("model").save().then(i,t)},submissionHasRegrade:function(){var e;return e=this.get("quizSubmission.scoreBeforeRegrade"),null!==e&&e>=0}.property("quizSubmission.scoreBeforeRegrade"),scoreAffectedByRegradeLabel:function(){var e;return this.get("quizSubmission.scoreBeforeRegrade")!==this.get("quizSubmission.keptScore")?(e=this.get("quizSubmission.questionsRegradedSinceLastAttempt"),1===e?s.t("regrade_score_affected","This quiz has been regraded; your score was affected."):s.t("regrade_count_affected","This quiz has been regraded; your new score reflects %{num} questions that were affected.",{num:e})):s.t("quiz_regraded_your_score_not_affected","This quiz has been regraded; your score was not affected.")}.property("quizSubmission.scoreBeforeRegrade","quizSubmission.keptScore","quizSubmission.questionsRegradedSinceLastAttempt"),warningText:function(){return s.t("warning","Warning")}.property(),deleteTitle:function(){return s.t("delete_quiz","Delete Quiz")}.property(),confirmText:function(){return s.t("delete","Delete")}.property(),cancelText:function(){return s.t("cancel","Cancel")}.property(),timeLimitWithMinutes:function(){return s.t("time_limit_minutes","%{limit} minutes",{limit:this.get("timeLimit")})}.property("timeLimit"),actions:{takeQuiz:function(){var e,t;return this.get("takeQuizActive")?(t=""+this.get("takeQuizUrl")+"&authenticity_token="+ENV.AUTHENTICITY_TOKEN,n("<form></form>").prop("action",t).prop("method","POST").appendTo("body").submit()):(e=this.get("published")?s.t("no_more_allowed_quiz_attempts","You aren't allowed any more attempts on this quiz."):s.t("cant_take_unpublished_quiz","You can't take a quiz until it is published"),n.flashWarning(e))},speedGrader:function(){return this.get("speedGraderActive")?window.location=this.get("speedGraderUrl"):n.flashWarning(s.t("there_are_no_submissions_to_grade","There are no submissions to grade."))},messageStudents:function(){return this.get("messageStudentsActive")?!0:n.flashWarning(s.t("you_cannot_message_unpublished","You can not message students until this quiz is published."))},moderateQuiz:function(){return window.location=this.get("moderateUrl")},downloadFiles:function(){return this.get("downloadActive")?INST.downloadSubmissions(this.get("quizSubmissionsZipUrl")):n.flashWarning(s.t("there_are_no_files_to_download","There are no files to download."))},showStudentResults:function(){return this.replaceRoute("quiz.moderate"),n.flashMessage(s.t("now_on_moderate","This information is now found on the Moderate tab."))},preview:function(){return n("<form/>").attr("action",""+this.get("previewUrl")+"&authenticity_token="+ENV.AUTHENTICITY_TOKEN).attr("method","POST").appendTo("body").submit()},toggleLock:function(){return this.send(this.get("isLocked")?"unlock":"lock")},lock:function(){var e,t;return e=new Date,t=this.get("dueAt"),(!t||t>e)&&this.set("dueAt",e),this.set("lockAt",e),this.get("model").save().then(function(){return n.flashMessage(s.t("quiz_successfully_updated","Quiz Successfully Updated!"))})},unlock:function(){var e,t,i;return t=new Date,i=this.get("unlockAt"),e=this.get("lockAt"),i&&i>t&&this.set("unlockAt",t),e&&t>e&&this.set("lockAt",null),this.get("model").save().then(function(){return n.flashMessage(s.t("quiz_successfully_updated","Quiz Successfully Updated!"))})},publish:function(){return this.updatePublished(!0)},unpublish:function(){return this.updatePublished(!1)},"delete":function(){var e;e=this.get("model"),e.deleteRecord(),e.save().then(function(){return n.flashMessage(s.t("quiz_successfully_deleted","Quiz Successfully Deleted!"))}),this.transitionToRoute("quizzes")},showRubric:function(){return this.trigger("rubricDisplayRequest")}},rubricActionUrl:function(){return"/courses/"+u.get("courseId")+"/rubrics"}.property("env.courseId"),rubricUrl:function(){var e,t,i;return t=u.get("courseId"),i=this.get("id"),e=this.get("assignmentId"),"/courses/"+t+"/assignments/"+e+"/rubric"}.property("env.courseId")})})}).call(this);