(function(){define(["jquery","underscore","../start_app","ember","../shared_ajax_fixtures","../../controllers/screenreader_gradebook_controller","compiled/userSettings","vendor/jquery.ba-tinypubsub"],function(t,e,s,n,r,o,i){var u,a,c,g,l,h,d,b,m;return u=null,h=null,d=null,l=function(t){return Em.copy(t,!0)},r.create(),b=function(t,e){var a=this;return null==t&&(t=!1),null==e&&(e="assignment_group"),window.ENV.GRADEBOOK_OPTIONS.draft_state_enabled=t,d=window.ENV.GRADEBOOK_OPTIONS.group_weighting_scheme,this.contextGetStub=sinon.stub(i,"contextGet"),this.contextSetStub=sinon.stub(i,"contextSet"),this.contextGetStub.withArgs("sort_grade_columns_by").returns({sortType:e}),this.contextSetStub.returns({sortType:e}),u=s(),n.run(function(){return a.srgb=o.create(),a.srgb.set("model",{enrollments:n.ArrayProxy.create({content:l(r.students)}),assignment_groups:n.ArrayProxy.create({content:l(r.assignment_groups)}),submissions:n.ArrayProxy.create({content:[]}),sections:n.ArrayProxy.create({content:l(r.sections)}),outcomes:n.ArrayProxy.create({content:l(r.outcomes)}),outcome_rollups:n.ArrayProxy.create({content:l(r.outcome_rollups)})})})},m=function(){return window.ENV.GRADEBOOK_OPTIONS.draft_state_enabled=!1,window.ENV.GRADEBOOK_OPTIONS.group_weighting_scheme=d,this.contextGetStub.restore(),this.contextSetStub.restore(),n.run(u,"destroy")},module("screenreader_gradebook_controller",{setup:function(){return b.call(this)},teardown:function(){return m.call(this)}}),test("calculates students properly",function(){return equal(this.srgb.get("students.length"),10),equal(this.srgb.get("students.firstObject").name,r.students[0].user.name)}),test("calculates assignments properly",function(){return equal(this.srgb.get("assignments.length"),7),ok(!this.srgb.get("assignments").findBy("name","Not Graded")),equal(this.srgb.get("assignments.firstObject").name,r.assignment_groups[0].assignments[0].name)}),test("calculates outcomes properly",function(){return equal(this.srgb.get("outcomes.length"),2),equal(this.srgb.get("outcomes.firstObject").title,r.outcomes[0].title)}),test("studentsHash returns the expected hash",function(){var t=this;return e.each(this.srgb.studentsHash(),function(e){return strictEqual(t.srgb.get("students").findBy("id",e.id),e)})}),test("assignmentGroupsHash retuns the expected hash",function(){var t=this;return e.each(this.srgb.assignmentGroupsHash(),function(e){return strictEqual(t.srgb.get("assignment_groups").findBy("id",e.id),e)})}),test("student objects have isLoaded flag set to true once submissions are loaded",function(){return this.srgb.get("students").forEach(function(t){return equal(n.get(t,"isLoaded"),!0)})}),test("displayName is hiddenName when hideStudentNames is true",function(){return this.srgb.set("hideStudentNames",!0),equal(this.srgb.get("displayName"),"hiddenName"),this.srgb.set("hideStudentNames",!1),equal(this.srgb.get("displayName"),"name")}),test("displayPointTotals is false when groups are weighted even if showTotalAsPoints is true",function(){var t=this;return n.run(function(){return t.srgb.set("showTotalAsPoints",!0),t.srgb.set("groupsAreWeighted",!0),equal(t.srgb.get("displayPointTotals"),!1)})}),test("displayPointTotals is toggled by showTotalAsPoints when groups are unweighted",function(){var t=this;return n.run(function(){return t.srgb.set("groupsAreWeighted",!1),t.srgb.set("showTotalAsPoints",!0),equal(t.srgb.get("displayPointTotals"),!0),t.srgb.set("showTotalAsPoints",!1),equal(t.srgb.get("displayPointTotals"),!1)})}),test("updateSubmission attaches the submission to the student",function(){var t,e;return t=l(r.students[0].user),e=l(r.submissions[t.id].submissions[0]),this.srgb.updateSubmission(e,t),strictEqual(t["assignment_"+e.assignment_id],e)}),test("studentsInSelectedSection is the same as students when selectedSection is null",function(){return ok(!this.srgb.get("selectedSection")),deepEqual(this.srgb.get("students"),this.srgb.get("studentsInSelectedSection"))}),test("selecting a section filters students properly",function(){var t=this;return n.run(function(){return t.srgb.set("selectedSection",t.srgb.get("sections.lastObject"))}),equal(this.srgb.get("studentsInSelectedSection.length"),6),equal(this.srgb.get("studentsInSelectedSection.firstObject").name,"Buffy")}),test("sorting assignments by position",function(){var t=this;return n.run(function(){return t.srgb.set("assignmentSort",t.srgb.get("assignmentSortOptions").findBy("value","assignment_group"))}),equal(this.srgb.get("assignments.firstObject.name"),"Z Eats Soup"),equal(this.srgb.get("assignments.lastObject.name"),"Da Fish and Chips!")}),test("updates assignment groups and weightingScheme when event is triggered",function(){return window.ENV.GRADEBOOK_OPTIONS.group_weighting_scheme="whoa",n.run(function(){return t.publish("assignment_group_weights_changed",{assignmentGroups:n.copy(r.assignment_groups,!0).slice(0,1)})}),equal(this.srgb.get("weightingScheme"),"whoa","weightingScheme was updated"),equal(this.srgb.get("assignment_groups.length"),1,"assignment_groups was updated")}),module("screenreader_gradebook_controller: sorting alpha",{setup:function(){return b.call(this,!1,"alpha")},teardown:function(){return m.call(this)}}),test("sorting assignments alphabetically",function(){var t=this;return n.run(function(){return t.srgb.set("assignmentSort",t.srgb.get("assignmentSortOptions").findBy("value","alpha"))}),equal(this.srgb.get("assignments.firstObject.name"),"Apples are good"),equal(this.srgb.get("assignments.lastObject.name"),"Z Eats Soup")}),module("screenreader_gradebook_controller: sorting due_date",{setup:function(){return b.call(this,!1,"due_date")},teardown:function(){return m.call(this)}}),test("sorting assignments by due date",function(){var t=this;return n.run(function(){return t.srgb.set("assignmentSort",t.srgb.get("assignmentSortOptions").findBy("value","due_date"))}),equal(this.srgb.get("assignments.firstObject.name"),"Can You Eat Just One?"),equal(this.srgb.get("assignments.lastObject.name"),"Drink Water")}),module("screenreader_gradebook_controller: with selected student",{setup:function(){var t=this;return b.call(this),n.run(function(){var e;return e=t.srgb.get("students.firstObject"),t.srgb.set("selectedStudent",e)})},teardown:function(){return m.call(this)}}),test("selectedSubmission should be null when just selectedStudent is set",function(){return strictEqual(this.srgb.get("selectedSubmission"),null)}),module("screenreader_gradebook_controller: with selected student, assignment, and outcome",{setup:function(){var t=this;return b.call(this),n.run(function(){return t.student=t.srgb.get("students.firstObject"),t.assignment=t.srgb.get("assignments.firstObject"),t.outcome=t.srgb.get("outcomes.firstObject"),t.srgb.set("selectedStudent",t.student),t.srgb.set("selectedAssignment",t.assignment),t.srgb.set("selectedOutcome",t.outcome)})},teardown:function(){return m.call(this)}}),test("assignmentDetails is computed properly",function(){var t,e;return t=this.srgb.get("assignmentDetails"),e=this.srgb.get("selectedAssignment"),strictEqual(t.assignment,e),strictEqual(t.cnt,3)}),test("outcomeDetails is computed properly",function(){var t,e;return t=this.srgb.get("outcomeDetails"),e=this.srgb.get("selectedOutcome"),strictEqual(t.cnt,1)}),test("selectedSubmission is computed properly",function(){var t,s,n,o=this;return t=this.srgb.get("selectedSubmission"),s=e.find(r.submissions,function(t){return t.user_id===o.student.id}),n=e.find(s.submissions,function(t){return t.assignment_id===o.assignment.id}),e.each(n,function(e,s){return equal(t[s],e,""+s+" is the expected value on selectedSubmission")})}),module("screenreader_gradebook_controller: with selected assignment",{setup:function(){var t=this;return b.call(this),this.assignment=this.srgb.get("assignments.firstObject"),n.run(function(){return t.srgb.set("selectedAssignment",t.assignment)})},teardown:function(){return this.contextGetStub.restore(),this.contextSetStub.restore(),n.run(u,"destroy")}}),test("gets the submission types",function(){var t=this;return equal(this.srgb.get("assignmentSubmissionTypes"),"None"),n.run(function(){var e;return e=t.srgb.get("assignments"),t.srgb.set("selectedAssignment",e.objectAt(1))}),equal(this.srgb.get("assignmentSubmissionTypes"),"Online URL, Online text entry")}),module("screenreader_gradebook_controller:draftState",{setup:function(){var t=this;return b.call(this,!0),Em.run(function(){return t.srgb.get("assignment_groups").pushObject({id:"100",name:"Silent Assignments",position:2,assignments:[{id:"21",name:"Unpublished Assignment",points_possible:10,grading_type:"percent",submission_types:["none"],due_at:null,position:6,assignment_group_id:"4",published:!1}]})})},teardown:function(){return m.call(this)}}),test("calculates assignments properly",function(){return equal(this.srgb.get("assignments.length"),7),ok(!this.srgb.get("assignments").findBy("name","Unpublished Assignment"))}),a={group_sums:[{"final":{possible:100,score:50,submission_count:10,weight:50,submissions:[]},current:{possible:100,score:20,submission_count:5,weight:50,submissions:[]},group:{id:"1"}}],"final":{possible:100,score:90},current:{possible:88,score:70}},c={group_sums:[{"final":{possible:0,score:50,submission_count:10,weight:50,submissions:[]},current:{possible:0,score:20,submission_count:5,weight:50,submissions:[]},group:{id:"1"}}],"final":{possible:0,score:0},current:{possible:0,score:0}},g=function(t){var e=this;return null==t&&(t=a),u=s(),n.run(function(){return e.srgb=o.create(),e.srgb.reopen({calculate:function(){return t}}),e.srgb.set("model",{enrollments:n.ArrayProxy.create({content:l(r.students)}),assignment_groups:n.ArrayProxy.create({content:l(r.assignment_groups)}),submissions:n.ArrayProxy.create({content:[]}),sections:n.ArrayProxy.create({content:l(r.sections)})})})},module("screenreader_gradebook_controller: grade calc",{setup:function(){return g.call(this)}}),test("calculates final grade",function(){return equal(this.srgb.get("students.firstObject.total_percent"),79.5)}),module("grade calc with 0s",{setup:function(){return g.call(this,c)}}),test("calculates final grade",function(){return equal(this.srgb.get("students.firstObject.total_percent"),0)}),module("screenreader_gradebook_controller: notes computed props",{setup:function(){var t=this;return ENV.GRADEBOOK_OPTIONS.custom_column_url="/here/is/an/:id",ENV.GRADEBOOK_OPTIONS.teacher_notes={id:"42"},this.server=sinon.fakeServer.create(),b.call(this),n.run(function(){return t.srgb.reopen({updateOrCreateNotesColumn:function(){}})})},teardown:function(){return ENV.GRADEBOOK_OPTIONS.custom_column_url=null,ENV.GRADEBOOK_OPTIONS.teacher_notes=null,this.server.restore(),m.call(this)}}),test("computes showNotesColumn correctly",function(){return ENV.GRADEBOOK_OPTIONS.teacher_notes={hidden:!1},equal(this.srgb.get("showNotesColumn"),!0),ENV.GRADEBOOK_OPTIONS.teacher_notes={hidden:!0},equal(this.srgb.get("showNotesColumn"),!1),ENV.GRADEBOOK_OPTIONS.teacher_notes=null,equal(this.srgb.get("showNotesColumn"),!1)}),test("shouldCreateNotes, no notes in ENV",function(){var t=this;return ENV.GRADEBOOK_OPTIONS.teacher_notes=null,n.run(function(){return t.srgb.set("showNotesColumn",!0)}),equal(this.srgb.get("shouldCreateNotes"),!0,"true if no teacher_notes and showNotesColumns is true")}),test("shouldCreateNotes, notes in ENV, hidden",function(){var t,e=this;return ENV.GRADEBOOK_OPTIONS.teacher_notes={hidden:!0},n.run(function(){return e.srgb.set("showNotesColumn",!0)}),t=this.srgb.get("shouldCreateNotes"),equal(t,!1,"does not create if there is a teacher_notes object in the ENV")}),test("shouldCreateNotes, notes in ENV, shown",function(){var t=this;return ENV.GRADEBOOK_OPTIONS.teacher_notes={hidden:!1},n.run(function(){return t.srgb.set("showNotesColumn",!0)}),equal(this.srgb.get("shouldCreateNotes"),!1,"does not create if there is a teacher_notes object in the ENV")}),test("notesURL, no notes object in ENV",function(){var t=this;return n.run(function(){return t.srgb.set("shouldCreateNotes",!0)}),equal(this.srgb.get("notesURL"),ENV.GRADEBOOK_OPTIONS.custom_columns_url,"computes properly when creating"),n.run(function(){return t.srgb.set("shouldCreateNotes",!1)}),equal(this.srgb.get("notesURL"),"/here/is/an/42","computes properly when showing")}),test("notesParams",function(){var t=this;return n.run(function(){return t.srgb.set("showNotesColumn",!0),t.srgb.set("shouldCreateNotes",!1)}),deepEqual(this.srgb.get("notesParams"),{"column[hidden]":!1}),n.run(function(){return t.srgb.set("showNotesColumn",!1),t.srgb.set("shouldCreateNotes",!1)}),deepEqual(this.srgb.get("notesParams"),{"column[hidden]":!0}),n.run(function(){return t.srgb.set("showNotesColumn",!0),t.srgb.set("shouldCreateNotes",!0)}),deepEqual(this.srgb.get("notesParams"),{"column[title]":"Notes","column[position]":1,"column[teacher_notes]":!0})}),test("notesVerb",function(){var t=this;return n.run(function(){return t.srgb.set("shouldCreateNotes",!0)}),equal(this.srgb.get("notesVerb"),"POST"),n.run(function(){return t.srgb.set("shouldCreateNotes",!1)}),equal(this.srgb.get("notesVerb"),"PUT")}),module("screenreader_gradebook_controller:invalidGroups",{setup:function(){var t=this;return b.call(this,!0),Em.run(function(){return t.srgb.set("assignment_groups",n.ArrayProxy.create({content:l(r.assignment_groups)}))})},teardown:function(){return m.call(this)}}),test("calculates invalidGroupsWarningPhrases properly",function(){return equal(this.srgb.get("invalidGroupsWarningPhrases"),"Note: Score does not include assignments from the group Invalid AG because it has no points possible.")}),test("sets showInvalidGroupWarning to false if groups are not weighted",function(){var t=this;return n.run(function(){return t.srgb.set("weightingScheme","equal"),equal(t.srgb.get("showInvalidGroupWarning"),!1),t.srgb.set("weightingScheme","percent"),equal(t.srgb.get("showInvalidGroupWarning"),!0)})})})}).call(this);