(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define(["jquery","i18n!paginated_list","vendor/spin"],function(e,n,s){var i;return i=function(){function i(n,s){this.onResponse=t(this.onResponse,this),this.getData=t(this.getData,this),this.cacheElements(n),this.options=e.extend({},this.defaultOptions,s),this.addEvents(),this.options.start&&this.getData()}return i.prototype.keys={noResults:n.t("no_results_found","No Results"),viewMore:n.t("view_more_link","View More")},i.prototype.spinnerOptions={length:4,lines:12,radius:7,width:2},i.prototype.defaultOptions={presenter:!1,requestParams:{page:1,per_page:25},start:!0,template:e.noop,url:""},i.prototype.cacheElements=function(t){return this.el={wrapper:t,list:t.find("ul:first")},"static"===this.el.wrapper.css("position")?this.el.wrapper.css("position","relative"):void 0},i.prototype.addEvents=function(){return this.el.wrapper.delegate(".view-more-link","click",this.getData)},i.prototype.getData=function(t){return t&&t.preventDefault(),this.startSpinner(t),this.currentRequest=e.getJSON(this.options.url,this.options.requestParams,this.onResponse)},i.prototype.onResponse=function(t){return this.stopSpinner(),0===t.length?this.noResults():(this.options.presenter&&(t=this.options.presenter(t)),this.animateInResults(e(this.options.template(t))),this.updatePaging())},i.prototype.startSpinner=function(t){return this.spinner=new s(this.spinnerOptions).spin(this.el.wrapper[0]).el,null!=t?e(this.spinner).css({bottom:10,top:"auto"}):void 0},i.prototype.stopSpinner=function(){return e(this.spinner).remove()},i.prototype.animateInResults=function(t){var e;return e=0===this.el.list.children().length,t.css("display","none"),this.el.list.append(t),t.slideDown()},i.prototype.updatePaging=function(){return this.hasNextPage()?(this.options.requestParams.page++,this.pageLinkPresent?void 0:(this.el.wrapper.append(this.viewMoreLink()),this.pageLinkPresent=!0)):this.el.wrapper.find(".view-more-link").remove()},i.prototype.hasNextPage=function(){return this.currentRequest.getAllResponseHeaders().match(/rel="next"/)},i.prototype.viewMoreLink=function(){return'<a class="view-more-link" href="#">'+this.keys.viewMore+"</a>"},i.prototype.noResults=function(){return this.el.list.append("<li>"+this.keys.noResults+"</li>")},i}()})}).call(this);