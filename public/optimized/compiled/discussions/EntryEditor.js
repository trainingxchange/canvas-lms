(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define(["i18n!editor","jquery","compiled/editor/EditorToggle","compiled/str/convertApiUserContent","vendor/jquery.ba-tinypubsub"],function(e,n,s,r,o){var a,c;return c=o.publish,a=function(s){function o(e){this.view=e,this.onSaveError=t(this.onSaveError,this),this.onSaveSuccess=t(this.onSaveSuccess,this),o.__super__.constructor.call(this,this.getEditingElement(),{switchViews:!0}),this.cancelButton=this.createCancelButton(),this.done.addClass("btn-small")}return i(o,s),o.prototype.display=function(t){return o.__super__.display.apply(this,arguments),this.cancelButton.detach(),(null!=t?t.cancel:void 0)!==!0?(this.view.model.set("replies",[]),this.view.model.set("updated_at",(new Date).toISOString()),this.view.model.set("editor",ENV.current_user),this.view.model.save({messageNotification:e.t("saving","Saving..."),message:this.content},{success:this.onSaveSuccess,error:this.onSaveError})):void 0},o.prototype.createCancelButton=function(){var t=this;return n("<a/>").html(e.t("cancel","Cancel")).css({marginLeft:"5px"}).attr("href","javascript:").addClass("cancel_button").click(function(){return t.display({cancel:!0})})},o.prototype.edit=function(){return this.editingElement(this.getEditingElement()),o.__super__.edit.apply(this,arguments),this.cancelButton.insertAfter(this.done)},o.prototype.getEditingElement=function(){return this.view.$(".message:first")},o.prototype.getContent=function(){return r(this.view.model.get("message"),{forEditing:!0})},o.prototype.onSaveSuccess=function(){return this.view.model.set("messageNotification","")},o.prototype.onSaveError=function(){return this.view.model.set({messageNotification:e.t("save_failed","Failed to save, please try again later")}),this.edit()},o}(s)})}).call(this);