(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define(["Backbone","i18n!discussions","underscore","jquery"],function(t,i,r,n){var s,o,a;return o=2e3,s=1e3,a=function(){function t(i){var r=this;this.view=i,this.markAsRead=e(this.markAsRead,this),t.unread.push(this),this.view.model.bind("change:collapsedView",function(e,t){return r.ignore=t,t?r.clearTimer():void 0})}var i;return t.unread=[],t.prototype.createTimer=function(){return this.timer||(this.timer=setTimeout(this.markAsRead,o))},t.prototype.clearTimer=function(){return clearTimeout(this.timer),delete this.timer},t.prototype.markAsRead=function(){return this.view.model.markAsRead(),t.unread=r(t.unread).without(this),t.trigger("markAsRead",this.view.model)},i=n(window),t.init=function(){return i.bind("scroll resize",this.checkForVisibleEntries),this.checkForVisibleEntries()},t.checkForVisibleEntries=r.throttle(function(){var e,r,n,s,o,a,c,u;for(o=i.scrollTop(),e=o+i.height(),u=t.unread,a=0,c=u.length;c>a;a++)r=u[a],r.ignore||r.view.model.get("forced_read_state")||(s=r.view.$el.offset().top,n=e>s&&s+r.view.$el.height()>o,r[n?"createTimer":"clearTimer"]())},s),t}.call(this),r.extend(a,t.Events)})}).call(this);