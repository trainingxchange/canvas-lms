(function(){var s=function(s,t){return function(){return s.apply(t,arguments)}};define(["i18n!gradebook2","jquery","message_students","compiled/AssignmentDetailsDialog","compiled/AssignmentMuter","compiled/gradebook2/SetDefaultGradeDialog","compiled/gradebook2/CurveGradesDialog","jst/gradebook2/GradebookHeaderMenu","jst/re_upload_submissions_form","underscore","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","compiled/jquery.kylemenu"],function(t,e,n,o,i,a,r,u,d,l){var m;return m=function(){function n(t,n,o){var a,r=this;this.assignment=t,this.$trigger=n,this.gradebook=o,this.reuploadSubmissions=s(this.reuploadSubmissions,this),this.downloadSubmissions=s(this.downloadSubmissions,this),this.curveGrades=s(this.curveGrades,this),this.setDefaultGrade=s(this.setDefaultGrade,this),this.messageStudentsWho=s(this.messageStudentsWho,this),this.showAssignmentDetails=s(this.showAssignmentDetails,this),a={assignmentUrl:""+this.gradebook.options.context_url+"/assignments/"+this.assignment.id,speedGraderUrl:""+this.gradebook.options.context_url+"/gradebook/speed_grader?assignment_id="+this.assignment.id},this.gradebook.options.speed_grader_enabled||(a.speedGraderUrl=null),this.gradebook.allSubmissionsLoaded.done(function(){return r.allSubmissionsLoaded=!0}),this.$menu=e(u(a)).insertAfter(this.$trigger),this.$trigger.kyleMenu({noButton:!0}),this.$menu.appendTo("#gradebook_grid").delegate("a","click",function(s){var t;return t=r[e(s.target).data("action")],t?(t(),!1):void 0}).bind("popupopen popupclose",function(s){return r.$trigger.toggleClass("ui-menu-trigger-menu-is-open","popupopen"===s.type),"popupclose"===s.type&&null!=s.originalEvent&&"focusout"!==s.originalEvent.type?setTimeout(function(){return r.gradebook.grid.editActiveCell()},0):void 0}).bind("popupopen",function(){var s,t,e,n;e={showAssignmentDetails:r.allSubmissionsLoaded,messageStudentsWho:r.allSubmissionsLoaded,setDefaultGrade:r.allSubmissionsLoaded,curveGrades:r.allSubmissionsLoaded&&"pass_fail"!==r.assignment.grading_type&&r.assignment.points_possible,downloadSubmissions:(""+r.assignment.submission_types).match(/(online_upload|online_text_entry|online_url)/)&&r.assignment.has_submitted_submissions,reuploadSubmissions:r.assignment.submissions_downloads>0},n=[];for(s in e)t=e[s],n.push(r.$menu.find("[data-action="+s+"]").showIf(t));return n}).popup("open"),new i(this.$menu.find("[data-action=toggleMuting]"),this.assignment,""+this.gradebook.options.context_url+"/assignments/"+this.assignment.id+"/mute")}return n.prototype.showAssignmentDetails=function(s){return null==s&&(s={assignment:this.assignment,students:this.gradebook.students}),new o(s)},n.prototype.messageStudentsWho=function(s){var n,o,i,a,r;return null==s&&(s={assignment:this.assignment,students:this.gradebook.students}),a=s.students,n=s.assignment,a=l.map(a,function(s){var t;return t=s["assignment_"+n.id],{id:s.id,name:s.name,score:null!=t?t.score:void 0,submitted_at:null!=t?t.submitted_at:void 0}}),r=n.submission_types,o=!0,0===r.length?o=!1:1===r.length&&(o=!l.include(["none","on_paper"],r[0])),i=[{text:t.t("students_who.havent_submitted_yet","Haven't submitted yet")},{text:t.t("students_who.havent_been_graded","Haven't been graded")},{text:t.t("students_who.scored_less_than","Scored less than"),cutoff:!0},{text:t.t("students_who.scored_more_than","Scored more than"),cutoff:!0}],o||i.splice(0,1),window.messageStudents({options:i,title:n.name,points_possible:n.points_possible,students:a,context_code:"course_"+n.course_id,callback:function(s,n,o){return o=e.grep(o,function(e){var o;return o=e.user_data,s===t.t("students_who.havent_submitted_yet","Haven't submitted yet")?!o.submitted_at&&null==o.score:s===t.t("students_who.havent_been_graded","Haven't been graded")?null==o.score:s===t.t("students_who.scored_less_than","Scored less than")?null!=o.score&&""!==o.score&&null!=n&&o.score<n:s===t.t("students_who.scored_more_than","Scored more than")?null!=o.score&&""!==o.score&&null!=n&&o.score>n:void 0}),e.map(o,function(s){return s.user_data.id})},subjectCallback:function(s,e){return e=e||"",s===t.t("students_who.not_submitted_yet","Haven't submitted yet")?t.t("students_who.no_submission_for","No submission for %{assignment}",{assignment:n.name}):s===t.t("students_who.havent_been_graded","Haven't been graded")?t.t("students_who.no_grade_for","No grade for %{assignment}",{assignment:n.name}):s===t.t("students_who.scored_less_than","Scored less than")?t.t("students_who.scored_less_than_on","Scored less than %{cutoff} on %{assignment}",{assignment:n.name,cutoff:e}):s===t.t("students_who.scored_more_than","Scored more than")?t.t("students_who.scored_more_than_on","Scored more than %{cutoff} on %{assignment}",{assignment:n.name,cutoff:e}):void 0}})},n.prototype.setDefaultGrade=function(s){return null==s&&(s={assignment:this.assignment,students:this.gradebook.students,context_id:this.gradebook.options.context_id,selected_section:this.gradebook.sectionToShow}),new a(s)},n.prototype.curveGrades=function(s){return null==s&&(s={assignment:this.assignment,students:this.gradebook.students,context_url:this.gradebook.options.context_url}),new r(s)},n.prototype.downloadSubmissions=function(){var s,t,n;return s=e.replaceTags(this.gradebook.options.download_assignment_submissions_url,"assignment_id",this.assignment.id),INST.downloadSubmissions(s),this.assignment.submissions_downloads=(null!=(n=(t=this.assignment).submissions_downloads)?n:t.submissions_downloads=0)+1},n.prototype.reuploadSubmissions=function(){var s,o;return this.$re_upload_submissions_form||(s={authenticityToken:e("#ajax_authenticity_token").text()},n.prototype.$re_upload_submissions_form=e(d(s)).dialog({width:400,modal:!0,resizable:!1,autoOpen:!1}).submit(function(){var s;return s=e(this).getFormData(),s.submissions_zip?s.submissions_zip.match(/\.zip$/)?void 0:(e(this).formErrors({submissions_zip:t.t("errors.upload_as_zip","Please upload files as a .zip")}),!1):!1})),o=e.replaceTags(this.gradebook.options.re_upload_submissions_url,"assignment_id",this.assignment.id),this.$re_upload_submissions_form.attr("action",o).dialog("open")},n}()})}).call(this);