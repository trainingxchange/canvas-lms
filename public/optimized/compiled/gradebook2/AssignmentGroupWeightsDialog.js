(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};define(["compiled/util/round","jquery","jst/AssignmentGroupWeightsDialog","jquery.ajaxJSON","jquery.disableWhileLoading","jqueryui/dialog","jquery.instructure_misc_helpers","vendor/jquery.ba-tinypubsub"],function(e,i,n){var o;return o=function(){function o(e){this.afterSave=t(this.afterSave,this),this.save=t(this.save,this),this.calcTotal=t(this.calcTotal,this),this.addGroupWeightListener=t(this.addGroupWeightListener,this),this.update=t(this.update,this),this.render=t(this.render,this);var o=this;this.$dialog=i(n()),this.$dialog.dialog({autoOpen:!1,resizable:!1,width:350,buttons:[{text:this.$dialog.find("button[type=submit]").hide().text(),click:this.save}]}),this.$dialog.delegate("input","change keyup keydown input",this.calcTotal),this.$dialog.find("#group_weighting_scheme").change(function(t){var e;return e=!t.currentTarget.checked,o.$dialog.find("table").css("opacity",e?.5:1),o.$dialog.find(".assignment_group_row input").attr("disabled",e)}),this.$group_template=this.$dialog.find(".assignment_group_row.blank").removeClass("blank").detach().show(),this.$groups_holder=this.$dialog.find(".groups_holder"),this.mergeFunction=e.mergeFunction||i.extend,this.update(e)}return o.prototype.render=function(){var t,e,i,n,o;for(this.$groups_holder.empty(),o=this.options.assignmentGroups,i=0,n=o.length;n>i;i++)t=o[i],e="assignment_group_"+t.id+"_weight",this.$group_template.clone().data("assignment_group",t).find("label").attr("for",e).text(t.name).end().find("input").attr("id",e).val(t.group_weight).end().appendTo(this.$groups_holder);return this.$dialog.find("#group_weighting_scheme").prop("checked","percent"===this.options.context.group_weighting_scheme).change(),this.calcTotal(),this.addGroupWeightListener()},o.prototype.update=function(t){return this.options=t,this.render()},o.prototype.addGroupWeightListener=function(){return i(".group_weight").on("change",function(t){var n,o;return o=i(t.target).val(),n=e(parseFloat(o),2),isNaN(n)?void 0:i(t.target).val(n)})},o.prototype.calcTotal=function(){var t;return t=0,this.$dialog.find(".assignment_group_row input").each(function(){return t+=Number(i(this).val())}),t=e(t,2),this.$dialog.find(".total_weight").text(t)},o.prototype.save=function(){var t,e,n,o,r=this;return t="/courses/"+this.options.context.context_id,o=[],e=this.$dialog.find("#group_weighting_scheme").is(":checked")?"percent":"equal",e!==this.options.context.group_weighting_scheme&&o.push(i.ajaxJSON(t,"PUT",{"course[group_weighting_scheme]":e},function(t){return r.options.context.group_weighting_scheme=t.course.group_weighting_scheme,"percent"===r.options.context.group_weighting_scheme?r.options.context.show_total_grade_as_points=!1:void 0})),this.$dialog.find(".assignment_group_row").each(function(e,n){var s,a;return s=i(n).data("assignment_group"),a=Number(i(n).find("input").val()),a!==s.group_weight?o.push(i.ajaxJSON("/api/v1"+t+"/assignment_groups/"+s.id,"PUT",{group_weight:a},function(t){return r.mergeFunction(s,t)})):void 0}),n=i.when.apply(i,o).done(this.afterSave),this.$dialog.disableWhileLoading(n,{buttons:[".ui-button-text"]})},o.prototype.afterSave=function(){return this.$dialog.dialog("close"),this.render(),i.publish("assignment_group_weights_changed",this.options)},o}()})}).call(this);