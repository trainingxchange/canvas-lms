(function(){var t={}.hasOwnProperty,s=function(s,e){function i(){this.constructor=s}for(var n in e)t.call(e,n)&&(s[n]=e[n]);return i.prototype=e.prototype,s.prototype=new i,s.__super__=e.prototype,s};define(["compiled/gradebook2/GRADEBOOK_TRANSLATIONS","str/htmlEscape","jquery","underscore","compiled/gradebook2/Turnitin","compiled/util/round","jquery.ajaxJSON"],function(t,e,i,n,r,o){var a,u,p,l,c,d,m;return u=r.extractData,a=function(){function s(t){this.opts=t,this.init()}return s.prototype.init=function(){var t;return t=this.opts.item[this.opts.column.field],this.$wrapper=i(this.cellWrapper("<input "+this.ariaLabel(t.submission_type)+" class='grade'/>")).appendTo(this.opts.container),this.$input=this.$wrapper.find("input").focus().select()},s.prototype.destroy=function(){return this.$input.remove()},s.prototype.focus=function(){return this.$input.focus()},s.prototype.loadValue=function(){return this.val=e(this.opts.item[this.opts.column.field].grade||""),this.$input.val(this.val),this.$input[0].defaultValue=this.val,this.$input.select()},s.prototype.serializeValue=function(){return this.$input.val()},s.prototype.applyValue=function(t,s){var i;return t[this.opts.column.field].grade=e(s),null!=(i=this.wrapper)&&i.remove(),this.postValue(t,s)},s.prototype.postValue=function(t,s){var e,n;return e=t[this.opts.column.field],n=this.opts.grid.getOptions().change_grade_url,n=n.replace(":assignment",e.assignment_id).replace(":submission",e.user_id),i.ajaxJSON(n,"PUT",{"submission[posted_grade]":s},this.onUpdateSuccess,this.onUpdateError)},s.prototype.onUpdateSuccess=function(t){return i.publish("submissions_updated",[t.all_submissions])},s.prototype.onUpdateError=function(){return i.flashError(t.submission_update_error)},s.prototype.isValueChanged=function(){return this.val!==this.$input.val()},s.prototype.validate=function(){return{valid:!0,msg:null}},s.formatter=function(t,s,e,i){var n;return n=parseFloat(e.grade),n=isNaN(n)?e.grade:o(n,o.DEFAULT),this.prototype.cellWrapper(n,{submission:e,assignment:i,editable:!1})},s.prototype.cellWrapper=function(e,n){var r,o,a,p,l,c;return null==n&&(n={}),r=i.extend({},{classes:"",editable:!0},n),r.submission||(r.submission=this.opts.item[this.opts.column.field]),r.assignment||(r.assignment=this.opts.column.object),(null!=(c=r.submission)?c.submission_type:void 0)&&(a=r.submission.submission_type),o=s.classesBasedOnSubmission(r.submission,r.assignment),r.submission.grade||(r.classes+=" no_grade_yet "),null==e&&(e=a?s.submissionIcon(a):"-"),(l=u(r.submission))&&(o.push("turnitin"),e+="<span class='gradebook-cell-turnitin "+l.state+"-score' />"),p=i.map(o,function(s){return t["submission_tooltip_"+s]}).join(", "),""+(p?'<div class="gradebook-tooltip">'+p+"</div>":"")+'\n<div class="gradebook-cell '+(r.editable?"gradebook-cell-editable focus":"")+" "+r.classes+" "+o.join(" ")+'">\n  <a href="#" data-user-id='+r.submission.user_id+" data-assignment-id="+r.assignment.id+' class="gradebook-cell-comment"><span class="gradebook-cell-comment-label">submission comments</span></a>\n  '+e+"\n</div>"},s.prototype.ariaLabel=function(s){var e;return e=t["submission_tooltip_"+s],null!=e?"aria-label='"+e+"'":""},s.classesBasedOnSubmission=function(t,s){var e;return null==t&&(t={}),null==s&&(s={}),e=[],t.grade_matches_current_submission===!1&&e.push("resubmitted"),t.late&&e.push("late"),""+s.submission_types=="not_graded"&&e.push("ungraded"),s.muted&&e.push("muted"),t.submission_type&&e.push(t.submission_type),e},s.submissionIcon=function(t){var e;return e=s.iconFromSubmissionType(t),"<i class='icon-"+e+"' ></i>"},s.iconFromSubmissionType=function(t){switch(t){case"online_upload":return"document";case"discussion_topic":return"discussion";case"online_text_entry":return"text";case"online_url":return"link";case"media_recording":return"filmstrip";case"online_quiz":return"quiz"}},s}(),a.out_of=function(t){function e(){return p=e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.init=function(){var t;return t=this.opts.item[this.opts.column.field],this.$wrapper=i(this.cellWrapper('<div class="overflow-wrapper">\n  <div class="grade-and-outof-wrapper">\n    <input type="number" '+this.ariaLabel(t.submission_type)+' class="grade"/><span class="outof"><span class="divider">/</span>'+this.opts.column.object.points_possible+"</span>\n  </div>\n</div>",{classes:"gradebook-cell-out-of-formatter"})).appendTo(this.opts.container),this.$input=this.$wrapper.find("input").focus().select()},e}(a),a.letter_grade=function(t){function e(){return l=e.__super__.constructor.apply(this,arguments)}return s(e,t),e.formatter=function(t,s,e,i){var n;return n=e.score?""+e.grade+"<span class='letter-grade-points'>"+e.score+"</span>":e.grade,a.prototype.cellWrapper(n,{submission:e,assignment:i,editable:!1})},e}(a),a.gpa_scale=function(t){function e(){return c=e.__super__.constructor.apply(this,arguments)}return s(e,t),e.formatter=function(t,s,e,i){var n;return n=e.grade,a.prototype.cellWrapper(n,{submission:e,assignment:i,editable:!1,classes:"gpa_scale_cell"})},e}(a),a.pass_fail=function(t){function e(){return d=e.__super__.constructor.apply(this,arguments)}var n,r;return s(e,t),r=["pass","fail",""],n=function(t){return{pass:"pass",complete:"pass",fail:"fail",incomplete:"fail"}[t.grade]||""},e.prototype.htmlFromSubmission=function(t){var s;return null==t&&(t={}),s=n(t.submission),a.prototype.cellWrapper('<a data-value="'+s+'" class="gradebook-checkbox gradebook-checkbox-'+s+" "+(t.editable?"editable":void 0)+'" href="#">'+s+"</a>",t)},e.formatter=function(t,s,i,n){return null==i.grade?a.formatter.apply(this,arguments):e.prototype.htmlFromSubmission({submission:i,assignment:n,editable:!1})},e.prototype.init=function(){var t=this;return this.$wrapper=i(this.cellWrapper()),this.$wrapper=i(this.htmlFromSubmission({submission:this.opts.item[this.opts.column.field],assignment:this.opts.column.object,editable:!0})).appendTo(this.opts.container),this.$input=this.$wrapper.find(".gradebook-checkbox").bind("click keypress",function(s){var e,i;return s.preventDefault(),e=t.$input.data("value"),i="pass"===e?"fail":"fail"===e?"":"pass",t.transitionValue(i)}).focus()},e.prototype.destroy=function(){return this.$wrapper.remove()},e.prototype.transitionValue=function(t){return this.$input.removeClass("gradebook-checkbox-pass gradebook-checkbox-fail").addClass("gradebook-checkbox-"+n({grade:t})).data("value",t)},e.prototype.loadValue=function(){return this.val=this.opts.item[this.opts.column.field].grade||""},e.prototype.serializeValue=function(){return this.$input.data("value")},e.prototype.isValueChanged=function(){return this.val!==this.$input.data("value")},e}(a),a.points=function(t){function e(){return m=e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(a),a})}).call(this);