(function(){var s=function(s,i){return function(){return s.apply(i,arguments)}};define(["i18n!submission_details_dialog","jquery","jst/SubmissionDetailsDialog","compiled/gradebook2/Turnitin","jst/_submission_detail","jst/_turnitinScore","jquery.ajaxJSON","jquery.disableWhileLoading","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_plugins","vendor/jquery.scrollTo","vendor/jquery.ba-tinypubsub"],function(i,t,n,e){var o,a;return a=e.extractDataFor,o=function(){function i(i,e,o){var a,r,u=this;this.assignment=i,this.student=e,this.options=o,this.update=s(this.update,this),this.scrollCommentsToBottom=s(this.scrollCommentsToBottom,this),this.open=s(this.open,this),r=this.options.speed_grader_enabled?""+this.options.context_url+"/gradebook/speed_grader?assignment_id="+this.assignment.id+"#%7B%22student_id%22%3A"+this.student.id+"%7D":null,this.url=this.options.change_grade_url.replace(":assignment",this.assignment.id).replace(":submission",this.student.id),this.submission=t.extend({},this.student["assignment_"+this.assignment.id],{inputName:"submission[posted_grade]",assignment:this.assignment,speedGraderUrl:r,loading:!0,showPointsPossible:(this.assignment.points_possible||"0"===this.assignment.points_possible)&&"gpa_scale"!==this.assignment.grading_type}),this.submission["assignment_grading_type_is_"+this.assignment.grading_type]=!0,this.dialog=t('<div class="use-css-transitions-for-show-hide" style="padding:0;"/>'),this.dialog.html(n(this.submission)).dialog({title:this.student.name,width:600,resizable:!1,open:this.scrollCommentsToBottom}).delegate("select","change",function(s){return u.dialog.find(".submission_detail").each(function(i){return t(this).showIf(i===s.currentTarget.selectedIndex)})}).delegate(".submission_details_grade_form","submit",function(s){return s.preventDefault(),t(s.currentTarget.form).disableWhileLoading(t.ajaxJSON(u.url,"PUT",t(s.currentTarget).getFormData(),function(s){return u.update(s),t.publish("submissions_updated",[u.submission.all_submissions]),setTimeout(function(){return u.dialog.dialog("close")},500)}))}).delegate(".submission_details_add_comment_form","submit",function(s){return s.preventDefault(),t(s.currentTarget).disableWhileLoading(t.ajaxJSON(u.url,"PUT",t(s.currentTarget).getFormData(),function(s){return u.update(s),setTimeout(function(){return u.dialog.dialog("close")},500)}))}),a=t.ajaxJSON(this.url+"?include[]=submission_history&include[]=submission_comments&include[]=rubric_assessment","GET",{},this.update),this.dialog.find(".submission_details_comments").disableWhileLoading(a)}return i.prototype.open=function(){return this.dialog.dialog("open"),t(".submission_details_dialog .assignment-name").focus()},i.prototype.scrollCommentsToBottom=function(){return this.dialog.find(".submission_details_comments").scrollTop(999999)},i.prototype.update=function(s){var i,e,o,r,u,l,d,m,h,g,c,_,p;for(t.extend(this.submission,s),this.submission.submission_history[0]=this.submission,this.submission.moreThanOneSubmission=this.submission.submission_history.length>1,this.submission.loading=!1,c=this.submission.submission_history,u=0,m=c.length;m>u;u++){for(o=c[u],_=o.submission_comments||[],l=0,h=_.length;h>l;l++)e=_[l],e.url=""+this.options.context_url+"/users/"+e.author_id,r=""+location.protocol+"//"+location.host,e.image_url=""+r+"/images/users/"+e.author_id+"?fallback="+encodeURIComponent(r+"/images/messages/avatar-50.png");for(o.turnitin=a(o,"submission_"+o.id,this.options.context_url),p=o.attachments||[],d=0,g=p.length;g>d;d++)i=p[d],i.turnitin=a(o,"attachment_"+i.id,this.options.context_url)}return this.dialog.html(n(this.submission)),this.dialog.find("select").trigger("change"),this.scrollCommentsToBottom()},i.cachedDialogs={},i.open=function(s,t,n){var e,o;return((e=i.cachedDialogs)[o=""+s.id+"-"+t.id]||(e[o]=new i(s,t,n))).open()},i}()})}).call(this);