define("datagrid",["INST","jquery","ajax_errors","jquery.instructure_misc_plugins","jquery.keycodes","jquery.scrollToVisible","vendor/jquery.scrollTo","jqueryui/position"],function(e,t){var r={columns:[],rows:[],dataRows:[],dataFragment:document.createDocumentFragment(),cells:{},divs:{},init:function(i,o){var l=o.onReady,n=o.tick,s=o.maxWidth||150;r.borderSize=o.borderSize||1,r.paddingBottom=o.paddingBottom||0,o.scroll&&t.isFunction(o.scroll)&&(r.scrollCallback=o.scroll),r.table=i,r.toggleCallback=o.toggle;var a=i.find("tr:first td"),c=i.find("tr"),d=0;a.each(function(e){var i=r.columns[e]=t(this);i.metrics={width:Math.min(i.width(),s),outerWidth:Math.min(i.outerWidth(),s+1)},d+=i.metrics.outerWidth});var u=0;c.each(function(e){var i=r.rows[e]=t(this);i.metrics={outerHeight:i.find("td:first").outerHeight(),height:i.find("td:first").height()},u+=i.metrics.height}),n&&t.isFunction(n)&&n(),r.divs.all=t(".datagrid"),r.divs.topleft=t("#datagrid_topleft"),r.divs.left=t("#datagrid_left"),r.divs.top=t("#datagrid_top"),r.divs.data=t("#datagrid_data"),r.divs.filler=t("#datagrid_filler"),r.divs.topleft.width(r.columns[0].metrics.width+r.borderSize),r.divs.left.width(r.columns[0].metrics.width+r.borderSize),r.divs.filler.width(d-r.columns[0].metrics.width),r.divs.top.height(r.rows[0].metrics.height+r.borderSize),r.divs.topleft.height(r.rows[0].metrics.height+r.borderSize),r.divs.filler.height(u-r.rows[0].metrics.height),r._initializeListeners(),r._templateCellHTML=o.templateCellHTML,r.sizeToWindow(),t(window).resize(r.sizeToWindow);var h=r._createRow(0,!0);h.append(r._createCell(0,0,i.find("tr:first td:first"))),r.divs.topleft.children(".content:first").append(h),h=r._createRow(0),h.width(d-r.columns[0].metrics.outerWidth),i.find("tr:first").children("td:not(:first)").each(function(e){h.append(r._createCell(0,e+1,t(this)))}),r.divs.top.children(".content:first").append(h),n&&t.isFunction(n)&&n();var f=!1,v=function(e){f||(h=r._createRow(e+1,!0),h.append(r._createCell(e+1,0,t(this).find("td:first"))),r.divs.left.children(".content:first").append(h)),h=r._createRow(e+1),t(this).children("td:not(:first)").each(function(i){r._createCell(e+1,i+1,t(this)),r._placeDataCell(e+1,i+1)}),r._placeDataRow(e+1)},g=[],m=0;i.find("tr:not(:first)").each(function(e){var i=0;h=r._createRow(e+1,!0),h.append(r._createCell(e+1,0,t(this).find("td:first"))),r.divs.left.children(".content:first").append(h),h=r._createRow(e+1),h.width(d-r.columns[0].metrics.outerWidth),t(this).children("td:not(:first)").each(function(e){i+=r.columns[e+1].metrics.width}),r._placeDataRow(e+1),m+=r.rows[e+1].metrics.height,g.push(t(this))}),f=!0,r._placeDataFragment(),o&&o.onViewable&&t.isFunction(o.onViewable)&&o.onViewable.call(this);var w=0,p=function(o){function s(){var e=c.width();c.width(99999999),d.css({position:"relative",width:""});var t=d.width()+1;c.width(e),d.css("position",""),u.width(t)}try{if(n&&t.isFunction(n)&&o&&n(),w<g.length){var a=w;w++,v.call(g[a],a),setTimeout(function(){p(!0)},1)}else if(o&&!p.finished&&(p.finished=!0,r.initialized=!0,i.hide(),r.ready&&t.isFunction(r.ready)&&r.ready(),l&&t.isFunction(l)&&l(),e.browser.ff)){var c=t("#datagrid_top"),d=c.find(".row"),u=d.add("#datagrid_data .row");s();var h;t(window).resize(function(){clearTimeout(h),h=setTimeout(s,100)})}}catch(f){e.log_error({message:f.toString()})}};setTimeout(function(){p(!0)},5),setTimeout(function(){p(!1)},5),setTimeout(function(){p(!1)},5),setTimeout(function(){p(!1)},5);var _=r.divs.top.children(".content:first"),C=r.divs.left.children(".content:first"),b=!1;setInterval(function(){b&&(0===_.length&&(_=r.divs.top.children(".content:first")),0===C.length&&(C=r.divs.left.children(".content:first")),_.css("left",0-r.divs.data.scrollLeft()),C.css("top",0-r.divs.data.scrollTop()),r.scrollCallback&&r.scrollCallback(),b=!1)},100),r.divs.data.bind("scroll",function(){b=!0}),r.mouseHasMoved=!0,t(document).mousemove(function(){r.mouseHasMoved=!0}),t(document).keycodes("up down left right tab shift+tab",function(e){t(e.target).closest(".ui-dialog").length>0||(e.preventDefault(),e.stopPropagation(),"right"==e.keyString||"tab"==e.keyString?r.moveRight():"down"==e.keyString?r.moveDown():"up"==e.keyString?r.moveUp():("left"==e.keyString||"shift+tab"==e.keyString)&&r.moveLeft())})},_initializeListeners:function(){r.divs.all.delegate(".cell","mousemove",r._cellMove).delegate(".cell","mouseover",r._cellOver).delegate(".cell","mouseout",r._cellOut).delegate(".cell","click",r._cellClick)},titles:function(e){var t=[];for(var i in e){var o=r.cells["0,"+e[i]];t.push(o.find(".assignment_title").text()||"--")}},reorderColumns:function(e){for(var t={},i=[],o=[],l=0;l<e.length;l++)o[l]=l;for(var n=0;n<e.length;n++){for(var s=e[n],a=0;a<r.rows.length;a++){{var c=r.cells[a+","+s];r.cells[a+","+o[n]]}o[n]==s||(o[n]<s?r.cells[a+","+o[n]].before(c):r.cells[a+","+o[n]].after(c)),t[a+","+n]=r.cells[a+","+s],t[a+","+n].column=n,t[a+","+n].data("datagrid_position",{row:a,column:n}),t[a+","+n].data("column",n),i[n]=r.columns[s]}for(var d=-1,l=0;l<o.length;l++)o[l]==s&&(d=l);n==d||(d>n?(o.splice(n,0,s),o.splice(d+1,1)):(o.splice(n,0,s),o.splice(d,1)))}r.cells=t,r.columns=i},reorderRows:function(e){for(var t={},i=[],o=[],l=0;l<e.length;l++)o[l]=l;for(var n=0,s=0;s<e.length;s++){var a=e[s],c=r.cells[a+",0"].parents(".row"),d=r.cells[a+",1"].parents(".row");d.css("top",n),c.css("top",n),s>0&&(n=n+r.rows[a].metrics.height+1),o[s]==a||(o[s]<a?(r.cells[o[s]+",0"].parents(".row").before(c),r.cells[o[s]+",1"].parents(".row").before(d)):(r.cells[o[s]+",0"].parents(".row").after(c),r.cells[o[s]+",1"].parents(".row").after(d))),i[s]=r.rows[a];for(var u=0;u<r.columns.length;u++){{r.cells[a+","+u]}t[s+","+u]=r.cells[a+","+u],t[s+","+u].row=s,t[s+","+u].data("datagrid_position",{row:s,column:u}),t[s+","+u].data("row",s),i[s]=r.rows[a]}for(var h=-1,l=0;l<o.length;l++)o[l]==a&&(h=l);s==h||(h>s?(o.splice(s,0,a),o.splice(h+1,1)):(o.splice(s,0,a),o.splice(h,1)))}r.cells=t,r.rows=i},moveColumn:function(e,t){if(new_order=[],0!=e&&0!=t&&e!=t){for(var i=0;i<r.columns.length;i++)new_order.push(i==t?e:i>=t&&e>=i||t>=i&&i>=e?e>t?i-1:i+1:i);r.reorderColumns(new_order)}},_placeDataCell:function(e,t){if(!(1>e||1>t)){var i=r.cells[e+","+t];if(!i||!i.placed){var o=r.dataRows[e];o&&(o.append(i),i.placed=!0)}}},_initializeCell:function(e,i){if(!r.cells[e+","+i]){var o=["cell"];0===e&&o.push("column_header"),0===i&&o.push("row_header"),0!==i&&0!==e&&o.push("data_cell");var l=t(["<div class='",o.join(" "),"' style='visibility: hidden; height:",r.rows[e].metrics.height,"px; width:",r.columns[i].metrics.width,"px;' data-row='",e,"' data-column='",i,"'/>"].join("")).data({row:e,column:i});l.row=e,l.column=i,r.cells[e+","+i]=l}return r.cells[e+","+i]},_createCell:function(e,t,i){var o=r._initializeCell(e,t);return o.transferred?o:(o.append(0!=e&&0!=t&&r._templateCellHTML?r._templateCellHTML(e,t):i.children()),o.attr("id",i.attr("id")),i.attr("id","original_"+o.attr("id")),o.originalTD=i,o.addClass(i.attr("class")),o.css("visibility",""),o.transferred=!0,o)},_trigger:function(e,i,o){var l=t.Event(e);l.originalEvent=i,l.originalTarget=o,r.table.trigger(l,{cell:o,trueEvent:i&&i.originalEvent})},_cellClick:function(e){var i=r.position(t(this)),o=r.cells[i.row+","+i.column];return r.columns[o.column].hidden?void r.toggleColumn(o.column):void r._trigger("entry_click",e,o)},_cellMove:function(){if(!r.disableHighlights){var e=r.position(t(this)),i=r.cells[e.row+","+e.column];r.table.trigger("entry_move",i),-1==t(this).index(r.currentHover)&&i.trigger("mouseover")}},_cellOver:function(e){if(!r.disableHighlights&&(!e.originalEvent||r.mouseHasMoved)){r.mouseHasMoved=!1;var i=r.position(t(this)),o=r.cells[i.row+","+i.column];if(o.addClass("selected"),r.currentHover&&-1==o.index(r.currentHover)&&t(r.currentHover).trigger("mouseout"),r.currentHover=o,0==o.row)for(var l=1;l<r.rows.length;l++)r.cells[l+","+o.column].addClass("related");else if(0==o.column)for(var l=1;l<r.columns.length;l++)r.cells[o.row+","+l].addClass("related");else r.cells[o.row+",0"].addClass("related"),r.cells["0,"+o.column].addClass("related");r._trigger("entry_over",e,o)}},_cellOut:function(e){if(!r.disableHighlights&&-1==t(e.target).parents("div").index(this)){var i=r.position(t(this)),o=r.cells[i.row+","+i.column];if(o.removeClass("selected"),0==o.row)for(var l=1;l<r.rows.length;l++)r.cells[l+","+o.column].removeClass("related");else if(0==o.column)for(var l=1;l<r.columns.length;l++)r.cells[o.row+","+l].removeClass("related");else r.cells[o.row+",0"].removeClass("related"),r.cells["0,"+o.column].removeClass("related");r._trigger("entry_out",e,o)}},_placeDataFragment:function(){r.dataFragment&&(r.divs.data.find(".content:first")[0].appendChild(r.dataFragment),r.dataFragment=null)},_placeDataRow:function(e){if(!(1>e)){var t=r.dataRows[e]||r._createRow(e);t.placed||(r.dataFragment?r.dataFragment.appendChild(t[0]):r.divs.data.find(".content:first").append(t),t.placed=!0)}},_createRow:function(e,i){if(r.dataRows[e])return r.dataRows[e];var o=document.createDocumentFragment(),l=t(document.createElement("div")).addClass("row");o.appendChild(l[0]),l.height(r.rows[e].metrics.height);for(var n=0,s=1;e>s;s++)n+=r.rows[s].metrics.height+1;var a=0;return l.css({top:n,left:a}),e>0&&!i&&(r.dataRows[e]=l),l},toggleColumn:function(e,i,o){var l=!r.columns[e].hidden,n=!!r.columns[e].hidden;if(i?n=!0:i===!1&&(n=!1),o&&o.callback===!1||!t.isFunction(r.toggleCallback)||r.toggleCallback(e,!!n),l!=n){for(var s=0;s<r.rows.length;s++)r.cells[s+","+e].width(n?r.columns[e].metrics.width:10).children().showIf(n).toggleClass("hidden_column",!n);return r.columns[e].hidden=!n,o&&o.skipSizeGrid||r.sizeGrid(),n}},sizeGrid:function(){for(var e=0,t=1;t<r.columns.length;t++)e+=r.columns[t].hidden?10:r.columns[t].metrics.width;r.divs.filler.width(e-r.columns[0].metrics.width);for(var t=0;t<r.rows.length;t++)r.cells[t+",1"].parent(".row").width(e+r.columns.length+3)},focus:function(e,t){var i=r.cells[e+","+t];r.currentFocus&&-1!=i.index(r.currentFocus||[])||(r.currentFocus&&r.blur(),i.addClass("focus"),r.currentFocus=i,r._trigger("entry_focus",null,i))},blur:function(){r.currentFocus&&(r.currentFocus.removeClass("focus"),r._trigger("entry_blur",null,r.currentFocus),r.currentFocus=null)},scrollTo:function(e,t){r.disableHighlights=!0,0==e&&(e=1),0==t&&(t=1);var i=r.cells[e+","+t];return r.divs.data.scrollToVisible(i).triggerHandler("scroll"),r.disableHighlights=!1,i&&i.filter(":visible").length>0?(i.attr("tabindex",0),!0):void 0},sizeToWindow:function(){t("html,body").css("overflow","hidden");var i=t("#content,#wide_content");(!i.length||i.width()<100)&&(i=t(window));var o=e.browser.ff?1:0,l=t(window).height()-o-r.divs.top.offset().top,n=i.width()-o,s=Math.floor(n-r.columns[0].metrics.outerWidth),a=Math.floor(l-r.rows[0].metrics.height-r.borderSize-r.paddingBottom);r.divs.top.width(s),r.divs.data.width(s),r.divs.left.height(a),r.divs.data.height(a),r.divs.data.metrics={width:s,height:a}},_selectFirstCell:function(){var e=r.cells["1,1"];e.trigger("mouseover"),r.currentHover=e,r.scrollTo(1,1)},position:function(e){if(e.hasClass("cell")||(e=e.closest(".cell")),e.data("datagrid_position"))return e.data("datagrid_position");if(0==e.length)return{};var t={row:parseInt(e.attr("data-row"),10),column:parseInt(e.attr("data-column"),10)};return e.data("datagrid_position",t),t},moveLeft:function(){var e=r.currentHover;if(!r.currentHover)return void r._selectFirstCell();for(var t=e.column-1,i=r.cells[e.row+","+t];i&&i.hidden;)t--,i=r.cells[e.row+","+t];i&&0!==i.length||(i=e),i.trigger("mouseover").focus(),r.currentHover=i,r.scrollTo(i.row,i.column)},moveRight:function(){var e=r.currentHover;if(!r.currentHover)return void r._selectFirstCell();for(var t=e.column+1,i=r.cells[e.row+","+t];i&&i.hidden;)t++,i=r.cells[e.row+","+t];i&&0!==i.length||(i=e),i.trigger("mouseover").focus(),r.currentHover=i,r.scrollTo(i.row,i.column)},moveUp:function(){var e=r.currentHover;if(!r.currentHover)return void r._selectFirstCell();for(var t=e.row-1,i=r.cells[t+","+e.column];i&&i.hidden;)t--,i=r.cells[t+","+e.column];i&&0!==i.length||(i=e),i.trigger("mouseover").focus(),r.currentHover=i,r.scrollTo(i.row,i.column)},moveDown:function(){var e=r.currentHover;if(!r.currentHover)return void r._selectFirstCell();for(var t=e.row+1,i=r.cells[t+","+e.column];i&&i.hidden;)t++,i=r.cells[t+","+e.column];i&&0!==i.length||(i=e),i.trigger("mouseover").focus(),r.currentHover=i,r.scrollTo(i.row,i.column)}};return r}),function(){require(["datagrid"])}.call(this),define("compiled/bundles/datagrid",function(){});