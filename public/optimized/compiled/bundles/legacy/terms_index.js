(function(){require(["i18n!terms.index","jquery","jquery.instructure_date_and_time","jquery.instructure_forms","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.templateData"],function(t,e){return e(document).ready(function(){return e(".edit_term_link").click(function(t){return t.preventDefault(),e(this).parents(".term").addClass("editing_term"),e(this).parents(".term").find(":text:visible:first").focus().select(),e(this).parents(".term").find(".date_field").not(".already_has_date_field").addClass("already_has_date_field").date_field()}),e(".term .cancel_button").click(function(){return e(this).parents(".term").removeClass("editing_term"),"term_new"===e(this).parents(".term").attr("id")?e(this).parents(".term").remove():void 0}),e(".cant_delete_term_link").click(function(e){return e.preventDefault(),alert(t.t("messages.classes_in_term","You can't delete a term that still has classes in it."))}),e(".delete_term_link").click(function(r){var n;return r.preventDefault(),n=e(this).parents(".term").find(".enrollment_term_form").attr("action"),e(this).parents(".term").confirmDelete({url:n,message:t.t("prompts.delete","Are you sure you want to delete this term?"),success:function(){return e(this).fadeOut(function(){return e(this).remove()})}})}),e(".enrollment_term_form").formSubmit({processData:function(t){var r;return r=e(this).parents("tr").find(".permissions").getFormData({object_name:"enrollment_term"}),e.each(r,function(t,n){return t.match(/\[(start)|(end)_at\]/)?r[t]=e.datetime.process(n):void 0}),e.extend(r,t)},beforeSubmit:function(){return e(this).find("button").attr("disabled",!0),e(this).find(".submit_button").text(t.t("messages.submitting","Submitting..."))},success:function(r){var n,i,a,s,d,m;s=r.enrollment_term,n=e(this).parents(".term"),e(this).find("button").attr("disabled",!1),e(this).find(".submit_button").text(t.t("update_term","Update Term")),m=e.replaceTags(e(".term_url").attr("href"),"id",s.id),e(this).attr("action",m),e(this).attr("method","PUT");for(i in s.enrollment_dates_overrides)a=s.enrollment_dates_overrides[i].enrollment_dates_override,d=e.underscore(a.enrollment_type),s[d+"_start_at"]=e.dateString(a.start_at)||t.t("date.term_start","term start"),s[d+"_end_at"]=e.dateString(a.end_at)||t.t("date.term_end","term end"),s["enrollment_term[overrides]["+d+"][start_at]"]=e.dateString(a.start_at),s["enrollment_term[overrides]["+d+"][end_at]"]=e.dateString(a.end_at);return s.start_at=e.dateString(s.start_at)||t.t("date.unspecified","whenever"),s.end_at=e.dateString(s.end_at)||t.t("date.unspecified","whenever"),n.fillTemplateData({data:s}),n.attr("id","term_"+s.id),n.fillFormData(r,{object_name:"enrollment_term"}),n.removeClass("editing_term")},error:function(r){return e(this).find("button").attr("disabled",!1),e(this).formErrors(r),e(this).find(".submit_button").text(t.t("errors.submit","Error Submitting"))}}),e(".add_term_link").click(function(t){var r;return t.preventDefault(),e("#term_new").length>0?void 0:(r=e("#term_blank").clone(!0).attr("id","term_new"),e("#terms").prepend(r.show()),r.find(".edit_term_link").click())})})})}).call(this);