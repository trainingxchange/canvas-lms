(function(){define(["underscore","i18n!editor","jquery","Backbone","compiled/fn/preventDefault","tinymce.editor_box"],function(t,e,i,n,s){var o;return o=function(){function t(t,e){this.editingElement(t),this.options=i.extend({},this.options,e),this.textArea=this.createTextArea(),this.options.switchViews&&(this.switchViews=this.createSwitchViews()),this.done=this.createDone(),this.content=this.getContent(),this.editing=!1}return t.prototype.options={doneText:e.t("done_as_in_finished","Done"),switchViews:!0},t.prototype.toggle=function(){return this.editing?this.display():this.edit()},t.prototype.edit=function(){var t;return this.textArea.val(this.getContent()),this.textArea.insertBefore(this.el),this.el.detach(),this.options.switchViews&&this.switchViews.insertBefore(this.textArea),this.done.insertAfter(this.textArea),t={focus:!0,tinyOptions:{}},this.options.editorBoxLabel&&(t.tinyOptions.aria_label=this.options.editorBoxLabel),this.textArea.editorBox(t),this.editing=!0,this.trigger("edit")},t.prototype.display=function(t){return(null!=t?t.cancel:void 0)||(this.content=this.textArea._justGetCode(),this.textArea.val(this.content),this.el.html(this.content)),this.el.insertBefore(this.textArea),this.textArea._removeEditor(),this.textArea.detach(),this.options.switchViews&&this.switchViews.detach(),this.done.detach(),this.textArea.attr("id",""),this.editing=!1,this.trigger("display")},t.prototype.editingElement=function(t){return this.el=t},t.prototype.getContent=function(){return i.trim(this.el.html())},t.prototype.createTextArea=function(){return i("<textarea/>").css({width:"100%",minHeight:"110px"}).addClass("editor-toggle")},t.prototype.createDone=function(){var t=this;return i("<a/>").html(this.options.doneText).attr("href","#").addClass("btn edit-html-done edit_html_done").attr("title",e.t("done.title","Click to finish editing the rich text area")).click(s(function(){return t.display()}))},t.prototype.createSwitchViews=function(){var t,n,o,r=this;return t=i("<a/>",{href:"#"}),n=t.clone(),t.text(e.t("switch_editor_html","HTML Editor")),n.hide().text(e.t("switch_editor_visual","Visual Editor")),o=i("<div/>",{style:"float: right"}),o.append(t,n),o.find("a").click(s(function(t){return r.textArea.editorBox("toggle"),i(t.currentTarget).siblings("a").andSelf().toggle()})),o},t}(),t.extend(o.prototype,n.Events),o})}).call(this);