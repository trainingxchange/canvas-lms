(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,r=function(e,r){function o(){this.constructor=e}for(var u in r)t.call(r,u)&&(e[u]=r[u]);return o.prototype=r.prototype,e.prototype=new o,e.__super__=r.prototype,e};define(["jquery","Backbone","underscore","jst/content_migrations/subviews/CourseFindSelect","jst/courses/autocomplete_item","jquery.ajaxJSON","jquery.disableWhileLoading"],function(t,o,u,s,n){var i,c;return i=function(o){function i(){return this.updateSearch=e(this.updateSearch,this),this.updateSelect=e(this.updateSelect,this),c=i.__super__.constructor.apply(this,arguments)}return r(i,o),i.optionProperty("current_user_id"),i.prototype.template=s,i.prototype.els={"#courseSearchField":"$courseSearchField","#courseSelect":"$courseSelect"},i.prototype.events={"change #courseSelect":"updateSearch","change #include_completed_courses":"toggleConcludedCourses"},i.prototype.render=function(){var e,t=this;return i.__super__.render.apply(this,arguments),e=this.getManageableCourses(),this.$el.disableWhileLoading(e),e.done(function(e){return t.courses=e,t.coursesByTerms=u.groupBy(e,function(e){return e.term}),i.__super__.render.apply(t,arguments)})},i.prototype.afterRender=function(){var e;return this.$courseSearchField.autocomplete({source:this.manageableCourseUrl(),select:this.updateSelect}),this.$courseSearchField.data("ui-autocomplete")._renderItem=function(e,r){return t(n(r)).appendTo(e)},e=t("#converter"),this.$courseSearchField.on("focus",function(){return e.attr("aria-atomic",!1)}),this.$courseSearchField.on("blur",function(){return e.attr("aria-atomic",!0)}),this.$courseSelect.on("focus",function(){return e.attr("aria-atomic",!1)}),this.$courseSelect.on("blur",function(){return e.attr("aria-atomic",!0)})},i.prototype.toJSON=function(){var e;return e=i.__super__.toJSON.apply(this,arguments),e.terms=this.coursesByTerms,e.include_concluded=this.includeConcludedCourses,e},i.prototype.getManageableCourses=function(){var e;return e=t.ajaxJSON(this.manageableCourseUrl(),"GET",{},{},{},{}),this.$el.disableWhileLoading(e),e},i.prototype.toggleConcludedCourses=function(){return this.includeConcludedCourses=this.includeConcludedCourses?!1:!0,this.$courseSearchField.autocomplete("option","source",this.manageableCourseUrl()),this.render()},i.prototype.manageableCourseUrl=function(){var e;return this.includeConcludedCourses&&(e=t.param({"include[]":"concluded"})),e?"/users/"+this.current_user_id+"/manageable_courses?"+e:"/users/"+this.current_user_id+"/manageable_courses"},i.prototype.autocompleteCourses=function(){return u.map(this.courses,function(e){return{label:e.label,id:e.id,value:e.label}})},i.prototype.updateSelect=function(e,t){return this.setSourceCourseId(t.item.id),this.$courseSelect.val(t.item.id)},i.prototype.updateSearch=function(e){var t,r,o;return o=e.target.value&&String(e.target.value),this.setSourceCourseId(o),r=this.autocompleteCourses(),t=u.find(r,function(e){return e.id===o}),this.$courseSearchField.val(null!=t?t.value:void 0)},i.prototype.setSourceCourseId=function(e){var t;return this.model.set("settings",{source_course_id:e}),(t=u.find(this.courses,function(t){return t.id===e}))?this.trigger("course_changed",t):void 0},i.prototype.validations=function(){var e,t;return e={},t=this.model.get("settings"),(null!=t?t.source_course_id:void 0)||(e.courseSearchField=[{type:"required",message:"You must select a course to copy content from"}]),e},i}(o.View)})}).call(this);