(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,s=function(e,s){function i(){this.constructor=e}for(var o in s)t.call(s,o)&&(e[o]=s[o]);return i.prototype=s.prototype,e.prototype=new i,e.__super__=s.prototype,e};define(["jquery","Backbone","i18n!content_migrations","jst/content_migrations/ProgressingContentMigration","jst/content_migrations/ProgressingIssues","compiled/views/PaginatedCollectionView","compiled/views/content_migrations/ContentMigrationIssueView","compiled/views/content_migrations/ProgressBarView","compiled/views/content_migrations/ProgressStatusView","compiled/views/content_migrations/SelectContentView","compiled/views/content_migrations/SourceLinkView"],function(t,i,o,n,r,u,a,l,h,c,g){var d,p;return d=function(i){function d(){return this.showSelectContentDialog=e(this.showSelectContentDialog,this),this.render=e(this.render,this),p=d.__super__.constructor.apply(this,arguments)}return s(d,i),d.prototype.template=n,d.prototype.tagName="li",d.prototype.className="clearfix migrationProgressItem",d.prototype.events={"click .showIssues":"toggleIssues","click .selectContentBtn":"showSelectContentDialog"},d.prototype.els={".showIssues":"$showIssues",".migrationIssues":"$migrationIssues",".changable":"$changable",".progressStatus":"$progressStatus",".selectContentDialog":"$selectContentDialog","[data-bind=migration_issues_count]":"$issuesCount",".sourceLink":"$sourceLink"},d.prototype.initialize=function(){var e=this;return d.__super__.initialize.apply(this,arguments),this.issuesLoaded=!1,this.progress=this.model.progressModel,this.issues=this.model.issuesCollection,this.model.on("continue",function(){var t;return null!=(t=e.progress)&&t.poll(),e.render()})},d.prototype.toJSON=function(){var e;switch(e=d.__super__.toJSON.apply(this,arguments),e.display_name=this.displayName(),e.created_at=this.createdAt(),e.issuesCount=this.model.get("migration_issues_count"),this.model.get("workflow_state")){case"waiting_for_select":e.waiting_for_select=!0;break;case"completed":case"failed":this.model.get("migration_issues_count")>0&&(e.migration_issues=!0);break;case"failed":e.message=this.model.get("message")||this.progress.get("message");break;case"running":e.loading=!0}return e},d.prototype.displayName=function(){return this.model.get("migration_type_title")||o.t("content_migration","Content Migration")},d.prototype.createdAt=function(){return this.model.get("created_at")||(new Date).toISOString()},d.prototype.render=function(){var e,t,s;return d.__super__.render.apply(this,arguments),e=new u({collection:this.issues,itemView:a,template:r}),this.$migrationIssues.html(e.render().el),t=new h({model:this.model,el:this.$progressStatus}),t.render(),s=new g({model:this.model,el:this.$sourceLink}),s.render(),this},d.prototype.afterRender=function(){var e=this;return"running"===this.model.get("workflow_state")&&("running"===this.progress.get("workflow_state")&&this.renderProgressBar(),this.progress.on("change:workflow_state",function(){return"running"===e.progress.get("workflow_state")?e.renderProgressBar():void 0})),this.progress.on("complete",function(){return e.updateMigrationModel()})},d.prototype.renderProgressBar=function(){var e;return e=new l({model:this.progress,el:this.$changable}),e.render()},d.prototype.updateMigrationModel=function(){var e=this;return this.model.fetch({error:function(){return e.model.set("status","failed")},success:function(){return e.render()}})},d.prototype.toggleIssues=function(e){var t,s=this;return e.preventDefault(),this.issuesLoaded?(this.$migrationIssues.toggle(),this.$migrationIssues.attr("aria-expanded","true"!==this.$migrationIssues.attr("aria-expanded")),this.setIssuesButtonText()):(t=this.fetchIssues(),t.done(function(){return s.issuesLoaded=!0,s.toggleIssues(e)}))},d.prototype.fetchIssues=function(){var e;return this.model.set("issuesButtonText",o.t("loading","Loading...")),e=this.issues.fetch(),this.$el.disableWhileLoading(e),e},d.prototype.setIssuesButtonText=function(){var e;return e=this.model.get("issuesButtonText"),this.hiddenIssues?(this.$issuesCount.show(),this.$showIssues.attr("aria-label",o.t("show_issues","Show Issues")),this.$showIssues.attr("title",o.t("show_issues","Show Issues")),t(document.activeElement).is(this.$showIssues)&&this.$showIssues.blur().focus(),this.model.set("issuesButtonText",o.t("issues","issues")),this.hiddenIssues=!1):(this.$issuesCount.hide(),this.model.set("issuesButtonText",o.t("hide_issues","Hide Issues")),this.$showIssues.attr("aria-label",o.t("hide_issues","Hide Issues")),this.$showIssues.attr("title",o.t("hide_issues","Hide Issues")),t(document.activeElement).is(this.$showIssues)&&this.$showIssues.blur().focus(),this.hiddenIssues=!0)},d.prototype.showSelectContentDialog=function(e){return e.preventDefault(),this.selectContentView||(this.selectContentView=new c({model:this.model,el:this.$selectContentDialog,title:o.t("#select_content","Select Content"),width:900,height:700})),this.selectContentView.open()},d}(i.View)})}).call(this);