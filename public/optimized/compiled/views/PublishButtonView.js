(function(){var t={}.hasOwnProperty,s=function(s,e){function i(){this.constructor=s}for(var l in e)t.call(e,l)&&(s[l]=e[l]);return i.prototype=e.prototype,s.prototype=new i,s.__super__=e.prototype,s};define(["i18n!publish_btn_module","jquery","compiled/fn/preventDefault","Backbone","jquery.instructure_forms"],function(t,e,i,l){var n,r;return n=function(i){function l(){return r=l.__super__.constructor.apply(this,arguments)}return s(l,i),l.prototype.disabledClass="disabled",l.prototype.publishClass="btn-publish",l.prototype.publishedClass="btn-published",l.prototype.unpublishClass="btn-unpublish",l.prototype.tagName="button",l.prototype.className="btn",l.prototype.events={click:"click",hover:"hover"},l.prototype.els={i:"$icon",".publish-text":"$text"},l.prototype.initialize=function(){var t,s=this;return l.__super__.initialize.apply(this,arguments),null!=(t=this.model)?t.on("change:unpublishable",function(){return s.model.get("unpublishable")?void 0:s.disable()}):void 0},l.prototype.setElement=function(){return l.__super__.setElement.apply(this,arguments),this.$el.attr("data-tooltip",""),this.model.get("unpublishable")?void 0:this.disable()},l.prototype.hover=function(t){var s;if(s=t.type,"mouseenter"===s){if(this.keepState||this.isPublish()||this.isDisabled())return;return this.renderUnpublish(),this.keepState=!0}return this.keepState=!1,this.isPublish()||this.isDisabled()?void 0:this.renderPublished()},l.prototype.click=function(t){return t.preventDefault(),t.stopPropagation(),this.isDisabled()?void 0:(this.keepState=!0,this.isPublish()?this.publish():this.isUnpublish()||this.isPublished()?this.unpublish():void 0)},l.prototype.addAriaLabel=function(t){var s;return s=this.$el.find("span.screenreader-only.accessible_label"),s.length||e('<span class="screenreader-only accessible_label"></span>').appendTo(this.$el),s.text(t),this.$el.attr("aria-label",t)},l.prototype.publish=function(){var t=this;return this.renderPublishing(),this.model.publish().always(function(){return t.trigger("publish"),t.enable(),t.render()})},l.prototype.unpublish=function(){var t=this;return this.renderUnpublishing(),this.model.unpublish().done(function(){return t.trigger("unpublish"),t.disable(),t.render()}).fail(function(s){var i;return i=JSON.parse(s.responseText).errors,e.flashError(i.published[0].message),t.model.set("unpublishable",!0),t.disable(),t.renderPublished()})},l.prototype.isPublish=function(){return this.$el.hasClass(this.publishClass)},l.prototype.isPublished=function(){return this.$el.hasClass(this.publishedClass)},l.prototype.isUnpublish=function(){return this.$el.hasClass(this.unpublishClass)},l.prototype.isDisabled=function(){return this.$el.hasClass(this.disabledClass)},l.prototype.disable=function(){return this.$el.addClass(this.disabledClass)},l.prototype.enable=function(){return this.$el.removeClass(this.disabledClass)},l.prototype.reset=function(){return this.$el.removeClass(""+this.publishClass+" "+this.publishedClass+" "+this.unpublishClass),this.$icon.removeClass("icon-publish icon-unpublish icon-unpublished"),this.$el.removeAttr("aria-label")},l.prototype.render=function(){return this.$el.attr("role","button"),this.$el.attr("tabindex","0"),this.$el.html('<i></i><span class="publish-text"></span>'),this.cacheEls(),this.$text.attr("tabindex","-1"),this.model.get("published")?this.renderPublished():this.renderPublish(),this},l.prototype.renderPublish=function(){return this.renderState({text:t.t("buttons.publish","Publish"),label:t.t("buttons.publish_desc","Unpublished. Click to publish."),buttonClass:this.publishClass,iconClass:"icon-unpublished"})},l.prototype.renderPublished=function(){return this.renderState({text:t.t("buttons.published","Published"),label:t.t("buttons.published_desc","Published. Click to unpublish."),buttonClass:this.publishedClass,iconClass:"icon-publish"})},l.prototype.renderUnpublish=function(){var s;return s=t.t("buttons.unpublish","Unpublish"),this.renderState({text:s,buttonClass:this.unpublishClass,iconClass:"icon-unpublish"})},l.prototype.renderPublishing=function(){var s;return this.disable(),s=t.t("buttons.publishing","Publishing..."),this.renderState({text:s,buttonClass:this.publishClass,iconClass:"icon-publish"})},l.prototype.renderUnpublishing=function(){var s;return this.disable(),s=t.t("buttons.unpublishing","Unpublishing..."),this.renderState({text:s,buttonClass:this.unpublishClass,iconClass:"icon-unpublished"})},l.prototype.renderState=function(t){return this.reset(),this.$el.addClass(t.buttonClass),this.$el.attr("aria-pressed",t.buttonClass===this.publishedClass),this.$icon.addClass(t.iconClass),this.$text.html("&nbsp;"+t.text),null==this.model.get("unpublishable")||this.model.get("unpublishable")?(this.enable(),this.$el.attr("title",t.text),t.label?this.addAriaLabel(t.label):void 0):(this.disable(),this.$el.attr("aria-disabled",!0),this.$el.attr("title",this.model.disabledMessage()),this.addAriaLabel(this.model.disabledMessage()))},l}(l.View)})}).call(this);