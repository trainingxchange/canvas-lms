(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,s=function(t,s){function i(){this.constructor=t}for(var r in s)e.call(s,r)&&(t[r]=s[r]);return i.prototype=s.prototype,t.prototype=new i,t.__super__=s.prototype,t};define(["i18n!outcomes","jquery","underscore","compiled/views/ValidatedFormView","tinymce.editor_box","compiled/jquery.rails_flash_notifications","jquery.disableWhileLoading","compiled/tinymce"],function(e,i,r,o){var n,a;return n=function(n){function l(){return this.updateTitle=t(this.updateTitle,this),this["delete"]=t(this["delete"],this),this.edit=t(this.edit,this),this.cancel=t(this.cancel,this),this.submit=t(this.submit,this),this._cleanUpTiny=t(this._cleanUpTiny,this),a=l.__super__.constructor.apply(this,arguments)}return s(l,n),l.prototype.tagName="div",l.prototype.className="wrapper",l.prototype.events=r.extend({"click .edit_button":"edit","click .cancel_button":"cancel","click .delete_button":"delete","keyup input.outcome_title":"updateTitle"},o.prototype.events),l.prototype.validations={title:function(t){return r.isEmpty(t.title)?e.t("blank_error","Cannot be blank"):t.title.length>255?e.t("length_error","Must be 255 characters or less"):void 0}},l.prototype.isValid=function(){var t,e,s,i,o;this.errors={},t=this.getFormData(),o=this.validations;for(s in o)i=o[s],(e=i(t))&&(this.errors[s]=[{message:e}]);return r.isEmpty(this.errors)},l.prototype.initialize=function(t){var e=this;return this.state=t.state,this._readOnly=t.readOnly,this.on("success",this.success,this),this.on("fail",this.fail,this),this.setModelUrl(),this.model.isAbbreviated()&&"add"!==this.state&&(this.state="loading",this.$el.disableWhileLoading(this.model.fetch({success:function(){return e.state=t.state,e.render()}}))),l.__super__.initialize.apply(this,arguments)},l.prototype._cleanUpTiny=function(){return this.$el.find('[name="description"]').editorBox("destroy")},l.prototype.submit=function(t){return t.preventDefault(),this.setModelUrl(),this.getTinyMceCode(),this.isValid()?(l.__super__.submit.call(this,t),this._cleanUpTiny(),i(".edit_button").focus()):this.showErrors(this.errors)},l.prototype.success=function(){return"add"===this.state?(this.trigger("addSuccess",this.model),i.flashMessage(e.t("flash.addSuccess","Creation successful"))):i.flashMessage(e.t("flash.updateSuccess","Update successful")),this.state="show",this.render(),i(".edit_button").focus(),this},l.prototype.fail=function(){return i.flashError(e.t("flash.error","An error occurred. Please refresh the page and try again."))},l.prototype.getTinyMceCode=function(){var t;return t=this.$("textarea"),t.val(t.editorBox("get_code"))},l.prototype.setModelUrl=function(){return this.model.setUrlTo(function(){switch(this.state){case"add":return"add";case"delete":return"delete";default:return"edit"}}.call(this))},l.prototype.getFormData=function(){return this.$("form").toJSON()},l.prototype.remove=function(){return this.$el.hideErrors(),"add"===this.state&&this.model.isNew()&&this.model.destroy(),l.__super__.remove.apply(this,arguments)},l.prototype.cancel=function(t){return t.preventDefault(),this.resetModel(),this._cleanUpTiny(),this.$el.hideErrors(),"add"===this.state?(this.$el.empty(),this.model.destroy(),this.state="show",i(".add_outcome_link").focus()):(this.state="show",this.render(),i(".edit_button").focus()),this},l.prototype.edit=function(t){return t.preventDefault(),this.state="edit",this._modelAttributes=this.model.toJSON(),this.render()},l.prototype["delete"]=function(t){var s=this;return t.preventDefault(),confirm(e.t("confirm.delete","Are you sure you want to delete?"))?(this.state="delete",this.setModelUrl(),this.$el.disableWhileLoading(this.model.destroy({success:function(){return i.flashMessage(e.t("flash.deleteSuccess","Deletion successful")),s.trigger("deleteSuccess"),s.remove(),i(".add_outcome_link").focus()},error:function(){return i.flashError(e.t("flash.deleteError","Something went wrong. Unable to delete at this time."))}}))):void 0},l.prototype.resetModel=function(){return this.model.set(this._modelAttributes)},l.prototype.readyForm=function(){var t=this;return setTimeout(function(){return t.$("textarea").editorBox(),t.$("input:first").focus()})},l.prototype.readOnly=function(){return this._readOnly||!this.model.get("can_edit")},l.prototype.updateTitle=function(t){return this.model.set("title",t.currentTarget.value)},l}(o)})}).call(this);