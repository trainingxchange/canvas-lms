(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,o=function(t,o){function r(){this.constructor=t}for(var i in o)e.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t};define(["i18n!outcomes","jquery","underscore","compiled/models/OutcomeGroup","compiled/views/DialogBaseView","compiled/views/outcomes/SidebarView","compiled/views/outcomes/ContentView","jst/outcomes/browser","jst/outcomes/findInstructions","compiled/jquery.rails_flash_notifications","jquery.disableWhileLoading"],function(e,r,i,s,n,u,c,p,l){var a,m;return a=function(n){function a(){return this.showOrHideImport=t(this.showOrHideImport,this),this["import"]=t(this["import"],this),m=a.__super__.constructor.apply(this,arguments)}return o(a,n),a.prototype.dialogOptions=function(){return{id:"import_dialog",title:this.title,width:1e3,resizable:!0,close:function(){return r(".find_outcome").focus()},buttons:[{text:e.t("#buttons.cancel","Cancel"),click:this.cancel},{text:e.t("#buttons.import","Import"),"class":"btn-primary",click:this["import"]}]}},a.prototype.initialize=function(t){return this.selectedGroup=t.selectedGroup,this.title=t.title,this.shouldImport=t.shouldImport===!1?!1:!0,this.disableGroupImport=t.disableGroupImport,a.__super__.initialize.apply(this,arguments),this.render(),this.dialog.parent().find(".ui-dialog-buttonpane").css("margin-top",0),this.sidebar=new u({el:this.$el.find(".outcomes-sidebar .wrapper"),directoryView:t.directoryView,rootOutcomeGroup:t.rootOutcomeGroup,readOnly:!0}),this.content=new c({el:this.$el.find(".outcomes-content"),instructionsTemplate:l,readOnly:!0,setQuizMastery:t.setQuizMastery,useForScoring:t.useForScoring}),this.sidebar.on("select",this.content.show),this.sidebar.on("select",this.showOrHideImport),this.showOrHideImport()},a.prototype["import"]=function(t){var o,n,u,c=this;return t.preventDefault(),n=this.sidebar.selectedModel(),this.content.setQuizMastery&&(n.quizMasteryLevel=parseFloat(this.$el.find("#outcome_mastery_at").val())||0),this.content.useForScoring&&(n.useForScoring=this.$el.find("#outcome_use_for_scoring").prop("checked")),n.get("dontImport")?alert(e.t("dont_import","This group cannot be imported.")):confirm(this.confirmText(n))?this.shouldImport?(n instanceof s?(u=this.selectedGroup.get("import_url"),o=r.ajaxJSON(u,"POST",{source_outcome_group_id:n.get("id")})):(u=this.selectedGroup.get("outcomes_url"),o=r.ajaxJSON(u,"POST",{outcome_id:n.get("id")})),this.$el.disableWhileLoading(o),r.when(o).done(function(t){var o;return o=n.clone(),o instanceof s?o.set(t):(o.outcomeLink=i.extend({},n.outcomeLink),o.outcomeGroup=t.outcome_group,o.outcomeLink.url=t.url,o.set({context_id:t.context_id,context_type:t.context_type})),c.trigger("import",o),c.close(),r.flashMessage(e.t("flash.importSuccess","Import successful"))}).fail(function(){return r.flashError(e.t("flash.importError","An error occurred while importing. Please try again later."))})):(this.trigger("import",n),void this.close()):void 0},a.prototype.render=function(){return this.$el.html(p({skipToolbar:!0})),this},a.prototype.showOrHideImport=function(){var t,e;return e=this.sidebar.selectedModel(),t=!0,!e||e.get("dontImport")?t=!1:e&&e instanceof s&&this.disableGroupImport&&(t=!1),r(".ui-dialog-buttonpane .btn-primary").toggle(t)},a.prototype.confirmText=function(t){var o;return o=this.selectedGroup.get("title")||e.t("top_level","%{context} Top Level",{context:this.selectedGroup.get("context_type")}),t instanceof s?e.t("confirm.import_group",'Import group "%{group}" to group "%{target}"?',{group:t.get("title"),target:o}):e.t("confirm.import_outcome",'Import outcome "%{outcome}" to group "%{target}"?',{outcome:t.get("title"),target:o})},a}(n)})}).call(this);