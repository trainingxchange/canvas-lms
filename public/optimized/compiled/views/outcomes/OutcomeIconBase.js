(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,r=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};define(["jquery","Backbone","str/htmlEscape","jqueryui/draggable"],function(e,o,n){var i,a;return i=function(o){function i(){return this.triggerSelect=t(this.triggerSelect,this),a=i.__super__.constructor.apply(this,arguments)}return r(i,o),i.prototype.tagName="li",i.prototype.attributes={tabindex:-1},i.prototype.events={click:"triggerSelect",keydown:"onKeydown",focus:"onFocus"},i.prototype.keyCodes={13:"Enter",27:"Escape",32:"Space",37:"LeftArrow",38:"UpArrow",39:"RightArrow",40:"DownArrow"},i.prototype.initialize=function(t){return i.__super__.initialize.apply(this,arguments),this.readOnly=t.readOnly,this.dir=t.dir,this.attachEvents()},i.prototype.attachEvents=function(){return this.model.on("change:title",this.updateTitle,this),this.model.on("remove",this.remove,this),this.model.on("select",this.triggerSelect,this)},i.prototype.triggerSelect=function(t){return t&&t.preventDefault(),this.trigger("select",this),this.select()},i.prototype.onKeydown=function(t){var r,o;return r=e(t.target),o="on"+this.keyCodes[t.keyCode]+"Key",this[o]?this[o].call(this,t,r)&&t.preventDefault():void 0},i.prototype.onUpArrowKey=function(t,e){return e.prev().focus()},i.prototype.onDownArrowKey=function(t,e){return e.next().focus()},i.prototype.onLeftArrowKey=function(t,e){return e.parent().prev().length>0?this.$el.parent().prev().find("[aria-expanded=true]").click().attr("aria-expanded",!1).attr("tabindex",0).focus():void 0},i.prototype.onEnterKey=function(t,e){return e.hasClass("outcome-group")?this.onRightArrowKey(t,e):this.triggerSelect()},i.prototype.onDrop=function(t,r){var o,n,i,a,s;return o=t.li,a=t.model,n=r.data("view"),s=t.parent,null!=n?(a.collection.remove(a),o.hasClass("outcome-link")?n.outcomes.add(a):n.groups.add(a),a.trigger("select"),i=n.moveModelHere(a)):n=s,i?i.done(function(){return e(".wrapper [data-id="+o.data("id")+"]").attr("tabindex",0).attr("aria-grabbed",!1).focus(),r.parents(".wrapper:first").data("drag",null)}):void 0},i.prototype.onSpaceKey=function(t,e){var r,o;return r=e.parents(".wrapper:first"),(o=r.data("drag"))?(e.after(o.li),this.onDrop(o,e.parent())):(e.attr("aria-grabbed",!0),o={li:e,model:e.data("view").model,parent:e.parent().data("view")},r.data("drag",o),e.blur(),e.focus())},i.prototype.onEscapeKey=function(t,e){var r,o;return r=e.parents(".wrapper:first"),(o=r.data("drag"))?(o.li.data("parent",null).attr("aria-grabbed",!1),r.data("drag",null)):void 0},i.prototype.onFocus=function(t){var r;return r=e(t.target),r.parents(".wrapper:first").find("[tabindex=0]").attr("tabindex",-1),r.attr("tabindex",0)},i.prototype.select=function(){return this.$el.parent().find("[tabindex=0]").attr("tabindex",-1),this.$el.addClass("selected").attr("tabindex",0)},i.prototype.unSelect=function(){return this.$el.removeClass("selected")},i.prototype.remove=function(){return this.model.off("change:title",this.updateTitle,this),this.model.off("remove",this.remove,this),this.model.off("select",this.triggerSelect,this),i.__super__.remove.apply(this,arguments)},i.prototype.updateTitle=function(){return this.$("span").text(this.model.get("title")),this.$("a").attr("title",n(this.model.get("title")))},i.prototype.render=function(){return this.readOnly||this.initDraggable(),this.$el.data("view",this),this},i.prototype.initDraggable=function(){return this.$el.draggable({scope:"outcomes",containment:".outcomes-sidebar",opacity:.7,helper:"clone",revert:"invalid",scroll:!1,drag:function(t){var r,o,n,i,a,s;return r=e(this).data("draggable"),o=r.options,n=!1,i=r.relative_container,a=i.offset().left,s=i.width(),t.pageX-a<o.scrollSensitivity?i[0].scrollLeft=n=i[0].scrollLeft-o.scrollSpeed:a+s-t.pageX<o.scrollSensitivity&&(i[0].scrollLeft=n=i[0].scrollLeft+o.scrollSpeed),n!==!1&&e.ui.ddmanager&&!o.dropBehaviour?e.ui.ddmanager.prepareOffsets(r,t):void 0}})},i}(o.View)})}).call(this);