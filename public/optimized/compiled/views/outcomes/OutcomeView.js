(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var o in i)e.call(i,o)&&(t[o]=i[o]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define(["i18n!outcomes","jquery","underscore","compiled/views/outcomes/OutcomeContentBase","jst/outcomes/outcome","jst/outcomes/outcomeForm","jst/outcomes/_criterion","jqueryui/dialog"],function(e,n,o,r,s,a,u){var c;return c=function(c){function p(e){this.setQuizMastery=e.setQuizMastery,this.useForScoring=e.useForScoring,this.showRatingDialog=t(this.showRatingDialog,this),this.insertRating=t(this.insertRating,this),this.deleteRating=t(this.deleteRating,this),this.editRating=t(this.editRating,this),this.submit=t(this.submit,this),p.__super__.constructor.apply(this,arguments)}return i(p,c),p.prototype.events=o.extend({"click .outcome_information_link":"showRatingDialog","click .edit_rating":"editRating","click .delete_rating_link":"deleteRating","click .save_rating_link":"saveRating","click .insert_rating":"insertRating"},r.prototype.events),p.prototype.validations=o.extend({mastery_points:function(t){return o.isEmpty(t.mastery_points)||parseFloat(t.mastery_points)<0?e.t("mastery_error","Must be greater than or equal to 0"):void 0}},r.prototype.validations),p.prototype.submit=function(t){var e;return e=o.max(o.map(o.pluck(this.getFormData().ratings,"points"),function(t){return parseFloat(t)})),this.model.set({points_possible:e},{silent:!0}),p.__super__.submit.call(this,t)},p.prototype.editRating=function(t){return t.preventDefault(),n(t.currentTarget).parent().hide()},p.prototype.deleteRating=function(t){var e,i;return t.preventDefault(),this.$(".rating").length>1?(e=n(t.currentTarget),i=e.closest(".rating").prev().find(".insert_rating"),0===i.length&&(i=e.closest(".rating").next().find(".edit_rating")),e.closest("td").remove(),i.focus(),this.updateRatings()):void 0},p.prototype.saveRating=function(t){var e,i;return t.preventDefault(),e=n(t.currentTarget).parents(".edit:first"),i=e.prev(),i.find("h5").text(e.find("input.outcome_rating_description").val()),i.find(".points").text(e.find("input.outcome_rating_points").val()||0),e.attr("aria-expanded",!1).hide(),i.show(),i.find(".edit_rating").focus(),this.updateRatings()},p.prototype.insertRating=function(t){var e;return t.preventDefault(),e=n(u({description:"",points:"",_index:99})),n(t.currentTarget).closest(".rating").after(e),e.find(".show").hide().next().show(200),e.find(".edit input:first").focus(),this.updateRatings()},p.prototype.updateRatings=function(){var t,e,i,r,s,a,u,c,p,l,d,h;for(a=0,d=this.$(".rating"),u=0,p=d.length;p>u;u++)for(r=d[u],s=n(r).find(".outcome_rating_points").val()||0,a=o.max([a,parseFloat(s)]),e=u,h=n(r).find("input"),c=0,l=h.length;l>c;c++)t=h[c],n(t).attr("name",t.name.replace(/\[[0-9]+\]/,"["+e+"]"));return i=this.$(".points_possible"),i.html(i.html().replace(/[0-9/.]+/,a))},p.prototype.showRatingDialog=function(t){return t.preventDefault(),n("#outcome_criterion_dialog").dialog({autoOpen:!1,title:e.t("outcome_criterion","Learning Outcome Criterion"),width:400,close:function(){return n(t.target).focus()}}).dialog("open")},p.prototype.render=function(){var t;switch(t=this.model.toJSON(),t.html_url=ENV.CONTEXT_URL_ROOT+"/outcomes/"+t.id,this.state){case"edit":this.$el.html(a(t)),this.readyForm();break;case"add":this.$el.html(a(o.extend(t,{points_possible:5,mastery_points:3,ratings:[{description:e.t("criteria.exceeds_expectations","Exceeds Expectations"),points:5},{description:e.t("criteria.meets_expectations","Meets Expectations"),points:3},{description:e.t("criteria.does_not_meet_expectations","Does Not Meet Expectations"),points:0}]}))),this.readyForm();break;case"loading":this.$el.empty();break;default:t.points_possible||(t.points_possible=0),t.mastery_points||(t.mastery_points=0),this.$el.html(s(o.extend(t,{readOnly:this.readOnly(),"native":this.model.outcomeLink.outcome.context_id===this.model.outcomeLink.context_id&&this.model.outcomeLink.outcome.context_type===this.model.outcomeLink.context_type,setQuizMastery:this.setQuizMastery,useForScoring:this.useForScoring,isLargeRoster:ENV.IS_LARGE_ROSTER})))}return this.$("input:first").focus(),this},p}(r)})}).call(this);