(function(){var t=function(t,o){return function(){return t.apply(o,arguments)}},o={}.hasOwnProperty,r=function(t,r){function e(){this.constructor=t}for(var n in r)o.call(r,n)&&(t[n]=r[n]);return e.prototype=r.prototype,t.prototype=new e,t.__super__=r.prototype,t};define(["Backbone","jquery","underscore","compiled/views/CollectionView"],function(o,e,n,i){var s,p;return s=function(o){function i(){return this._updateSort=t(this._updateSort,this),p=i.__super__.constructor.apply(this,arguments)}return r(i,o),i.optionProperty("sortURL"),i.prototype.sortOptions={tolerance:"pointer",opacity:.9,zIndex:100,placeholder:"sortable-dropzone",forcePlaceholderSize:!0},i.prototype.render=function(t){return null==t&&(t=!0),i.__super__.render.apply(this,arguments),t&&this._initSort(),this},i.prototype._initSort=function(){return this.$list.sortable(n.extend({},this.sortOptions,{scope:this.cid})),this.$list.on("sortupdate",this._updateSort),this.$list.disableSelection()},i.prototype._getItemId=function(t){return t.children(":first").data("id")},i.prototype._updateSort=function(t,o){var r,n,i,s,p,u,c,a,l;for(t.stopPropagation(),p={},n=this._getItemId(o.item),p[n]=o.item.index()+1,l=o.item.siblings(),c=0,a=l.length;a>c;c++)u=l[c],r=e(u),s=this._getItemId(r),i=r.prevAll().length,p[s]=i+1;return this._updatePositions(p)},i.prototype._updatePositions=function(t){return this.collection.each(function(o){var r;return r=t[o.id],o.set("position",r)}),this.collection.sort(),this._sendPositions(this._orderPositions(t))},i.prototype._orderPositions=function(t){var o,r,e,n,i,s,p;i=[];for(o in t)e=t[o],i.push([o,e]);for(i.sort(function(t,o){return t[1]-o[1]}),n=[],s=0,p=i.length;p>s;s++)r=i[s],n.push(r[0]);return n},i.prototype._sendPositions=function(t){return e.post(this.sortURL,{order:t.join(",")})},i}(i)})}).call(this);