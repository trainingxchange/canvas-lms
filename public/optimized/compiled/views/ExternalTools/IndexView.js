(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function o(){this.constructor=e}for(var n in i)t.call(i,n)&&(e[n]=i[n]);return o.prototype=i.prototype,e.prototype=new o,e.__super__=i.prototype,e};define(["jquery","i18n!external_tools","str/htmlEscape","jst/ExternalTools/IndexView","compiled/views/ExternalTools/AddAppView","compiled/views/ExternalTools/EditView","compiled/views/ExternalTools/AppFullView","compiled/models/ExternalTool"],function(t,o,n,l,r,p,s,a){var h,d;return h=function(h){function w(){return this.toggleInstalledState=e(this.toggleInstalledState,this),this.filterApps=e(this.filterApps,this),this.onToolSync=e(this.onToolSync,this),this.showAppCenterView=e(this.showAppCenterView,this),this.showExternalToolsView=e(this.showExternalToolsView,this),this.hideAppCenterView=e(this.hideAppCenterView,this),this.hideExternalToolsView=e(this.hideExternalToolsView,this),d=w.__super__.constructor.apply(this,arguments)}return i(w,h),w.child("appCenterView","[data-view=appCenter]"),w.child("externalToolsView","[data-view=externalTools]"),w.prototype.template=l,w.prototype.els={".view_tools_link":"$viewToolsLink",".view_app_center_link":"$viewAppCenterLink",".add_tool_link":"$addToolLink","#app_center_filter":"$appCenterFilter","#app_center_filter_wrapper":"$appCenterFilterWrapper","[data-view=appFull]":"$appFull"},w.prototype.events={"click .view_tools_link":"showExternalToolsView","click .view_app_center_link":"showAppCenterView","click .app":"showAppFullView","keyup .app":"showAppFullView","click .add_tool_link":"addTool","click [data-edit-external-tool]":"editTool","click [data-delete-external-tool]":"deleteTool","change #app_center_filter":"filterApps","keyup #app_center_filter":"filterApps","click [data-toggle-installed-state]":"toggleInstalledState"},w.prototype.currentAppCenterPosition=0,w.prototype.afterRender=function(){return this.options.appCenterEnabled?(this.appCenterView.collection.fetch(),this.showAppCenterView()):this.showExternalToolsView()},w.prototype.hideExternalToolsView=function(){return this.externalToolsView.hide(),this.$viewToolsLink.show(),this.$addToolLink.hide()},w.prototype.hideAppCenterView=function(){return this.currentAppCenterPosition=t(document).scrollTop(),this.appCenterView.hide(),this.$appCenterFilterWrapper.hide(),this.options.appCenterEnabled?this.$viewAppCenterLink.show():void 0},w.prototype.removeAppFullView=function(){return this.appFullView?this.appFullView.remove():void 0},w.prototype.showExternalToolsView=function(){return this.removeAppFullView(),this.hideAppCenterView(),this.options.appCenterEnabled||this.$viewAppCenterLink.hide(),this.$viewToolsLink.hide(),this.$addToolLink.show(),this.externalToolsView.collection.fetch(),this.externalToolsView.show()},w.prototype.showAppCenterView=function(){return this.removeAppFullView(),this.hideExternalToolsView(),this.$viewAppCenterLink.hide(),this.appCenterView.show(),this.$appCenterFilterWrapper.show(),t(document).scrollTop(this.currentAppCenterPosition)},w.prototype.showAppFullView=function(e){var t;return"keyup"!==e.type||32===e.keyCode?(this.hideExternalToolsView(),this.hideAppCenterView(),t=this.$(e.currentTarget).data("view"),this.appFullView=new s({model:t.model}),this.appFullView.on("cancel",this.showAppCenterView,this),this.appFullView.on("addApp",this.addApp,this),this.appFullView.render(),this.$appFull.append(this.appFullView.$el)):void 0},w.prototype.addApp=function(){var e;return e=new a,e.on("sync",this.onToolSync),this.addAppView=new r({app:this.appFullView.model,model:e}).render()},w.prototype.addTool=function(){var e;return e=new a,e.on("sync",this.onToolSync),this.editView=new p({model:e}).render()},w.prototype.editTool=function(e){var t,i;return i=this.$(e.currentTarget).closest(".external_tool_item").data("view"),t=i.model,t.on("sync",this.onToolSync),this.editView=new p({model:t}).render(),!1},w.prototype.onToolSync=function(e){return this.addAppView&&this.addAppView.remove(),this.editView&&this.editView.remove(),this.showExternalToolsView(),t.flashMessage(n(o.t("app_saved_message","%{app} saved successfully!",{app:e.get("name")})))},w.prototype.filterApps=function(){return this.appCenterView.filterText=this.$appCenterFilter.val(),this.appCenterView.render()},w.prototype.deleteTool=function(e){var i,n,l,r,p=this;return r=this.$(e.currentTarget).closest(".external_tool_item").data("view"),l=r.model,n=o.t("remove_tool","Are you sure you want to remove this tool?"),i=t("<div>"+n+"</div>").dialog({modal:!0,resizable:!1,title:o.t("delete","Delete")+" "+l.get("name")+"?",buttons:[{text:o.t("buttons.cancel","Cancel"),click:function(){return i.dialog("close")}},{text:o.t("buttons.delete","Delete"),click:function(){return l.on("sync",function(){return p.externalToolsView.collection.fetch(),p.appCenterView.collection.fetch()}),l.destroy(),i.dialog("close")}}]}),!1},w.prototype.toggleInstalledState=function(e){var t;return t=this.$(e.currentTarget),this.appCenterView.targetInstalledState=t.data("toggle-installed-state"),this.$("[data-installed-state] > a").attr("aria-selected","false"),this.$("[data-installed-state]").removeClass("active"),this.$('[data-installed-state="'+this.appCenterView.targetInstalledState+'"]').addClass("active"),this.$('[data-installed-state="'+this.appCenterView.targetInstalledState+'"] > a').attr("aria-selected","true"),this.appCenterView.render()},w}(Backbone.View)})}).call(this);