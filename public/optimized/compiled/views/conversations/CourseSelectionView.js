(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,r=function(t,r){function o(){this.constructor=t}for(var n in r)e.call(r,n)&&(t[n]=r[n]);return o.prototype=r.prototype,t.prototype=new o,t.__super__=r.prototype,t};define(["i18n!conversations","jquery","underscore","Backbone","compiled/views/conversations/SearchableSubmenuView","jst/conversations/courseOptions","jquery.instructure_date_and_time","vendor/bootstrap/bootstrap-dropdown","vendor/bootstrap-select/bootstrap-select"],function(e,o,n,s,i,u){var a,c,p,l;return p=s.View,a=s.Collection,c=function(s){function a(){return this.truncate_course=t(this.truncate_course,this),this.loadAll=t(this.loadAll,this),this.render=t(this.render,this),l=a.__super__.constructor.apply(this,arguments)}return r(a,s),a.prototype.events={change:"onChange"},a.prototype.initialize=function(){return a.__super__.initialize.apply(this,arguments),this.options.defaultOption||(this.options.defaultOption=e.t("all_courses","All Courses")),this.$el.addClass("show-tick"),this.$el.selectpicker({useSubmenus:!0}).next().on("mouseover",this.loadAll).find(".dropdown-toggle").on("focus",this.loadAll),this.options.courses.favorites.on("reset",this.render),this.options.courses.all.on("reset",this.render),this.options.courses.all.on("add",this.render),this.options.courses.groups.on("reset",this.render),this.options.courses.groups.on("add",this.render),this.render()},a.prototype.render=function(){var t,e,r,n,s=this;return a.__super__.render.call(this),r=[],t=[],n=o.fudgeDateForProfileTimezone(new Date),this.options.courses.all.each(function(e){var o,i;if(!s.options.courses.favorites.get(e.id))return i="completed"===e.get("workflow_state")||e.get("end_at")&&new Date(e.get("end_at"))<n||e.get("term").end_at&&new Date(e.get("term").end_at)<n,o=i?t:r,o.push(e.toJSON())}),e={defaultOption:this.options.defaultOption,favorites:this.options.courses.favorites.toJSON(),more:r,concluded:t,groups:this.options.courses.groups.toJSON()},this.truncate_course_name_data(e),this.$el.html(u(e)),this.$el.selectpicker("refresh"),this.$picker=this.$el.next(),this.$picker.find(".paginatedLoadingIndicator").remove(),this.createSearchViews(),this.renderValue()?void 0:this.loadAll()},a.prototype.createSearchViews=function(){var t;return t=[],this.$picker.find(".dropdown-submenu").each(function(){return t.push(new i({el:this}))}),this.searchViews=t},a.prototype.loadAll=function(){var t;return t=this.options.courses.all,t._loading?void 0:(t.fetch(),t._loading=!0,this.options.courses.groups.fetch(),this.$picker.find("> .dropdown-menu").append(o("<div />").attr("class","paginatedLoadingIndicator").css("clear","both")))},a.prototype._value="",a.prototype.setValue=function(t){return this._value=t||"",this.renderValue(),this.triggerEvent()},a.prototype.renderValue=function(){return this.silenced=!0,this.$el.selectpicker("val",this._value),this.silenced=!1,this.$el.val()===this._value},a.prototype.onChange=function(){return this.silenced?void 0:(this._value=this.$el.val(),this.triggerEvent(),this.searchViews.forEach(function(t){return t.clearSearch()}))},a.prototype.getCurrentContext=function(){var t,e,r,o,n,s;return(n=this._value.match(/(\w+)_(\d+)/))?(o=n[0],s=n[1],r=n[2],t="course"===s?e=this.options.courses.favorites.get(r)||this.options.courses.all.get(r):this.options.courses.groups.get(r),t?{name:t.get("name"),id:this._value}:{}):{}},a.prototype.triggerEvent=function(){return this.trigger("course",this.getCurrentContext())},a.prototype.focus=function(){return this.$el.next().find(".dropdown-toggle").focus()},a.prototype.truncate_course_name_data=function(t){var e=this;return n.each(["favorites","more","concluded","groups"],function(r){return e.truncate_course_names(t[r])})},a.prototype.truncate_course_names=function(t){return n.each(t,this.truncate_course)},a.prototype.truncate_course=function(t){var e,r;return e=t.name,r=this.middle_truncate(e),e!==r?t.truncated_name=r:void 0},a.prototype.middle_truncate=function(t){return t.length>25?t.slice(0,10)+"&hellip;"+t.slice(-10):t},a}(p)})}).call(this);