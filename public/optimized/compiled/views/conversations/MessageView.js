(function(){var t={}.hasOwnProperty,e=function(e,o){function r(){this.constructor=e}for(var s in o)t.call(o,s)&&(e[s]=o[s]);return r.prototype=o.prototype,e.prototype=new r,e.__super__=o.prototype,e};define(["i18n!conversations","Backbone","underscore","jst/conversations/message"],function(t,o,r,s){var n,a,i;return a=o.View,n=function(o){function n(){return i=n.__super__.constructor.apply(this,arguments)}return e(n,o),n.prototype.tagName="li",n.prototype.template=s,n.prototype.els={".star-btn":"$starBtn",".read-state":"$readBtn"},n.prototype.events={click:"onSelect","click .open-message":"onSelect","click .star-btn":"toggleStar","click .read-state":"toggleRead",mousedown:"onMouseDown"},n.prototype.messages={read:t.t("mark_as_read","Mark as read"),unread:t.t("mark_as_unread","Mark as unread"),star:t.t("star_conversation","Star conversation"),unstar:t.t("unstar_conversation","Unstar conversation")},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.attachModel()},n.prototype.attachModel=function(){var t=this;return this.model.on("change:starred",function(){return t.$starBtn.toggleClass("active")}),this.model.on("change:workflow_state",function(){return t.$readBtn.toggleClass("read","unread"!==t.model.get("workflow_state"))}),this.model.on("change:selected",function(e){return t.$el.toggleClass("active",e.get("selected"))})},n.prototype.onSelect=function(t){var e;if(!t||!t.target.className.match(/star|read-state/))return t.shiftKey?this.model.collection.selectRange(this.model):(e=t.metaKey||t.ctrlKey,this.model.get("selected")&&e?this.deselect(e):this.select(e))},n.prototype.select=function(t){return t||r.each(this.model.collection.without(this.model),function(t){return t.set("selected",!1)}),this.model.set("selected",!0),this.model.unread()?this.model.set("workflow_state","read"):void 0},n.prototype.deselect=function(t){return t?this.model.set("selected",!1):void 0},n.prototype.toggleStar=function(t){return t.preventDefault(),this.model.toggleStarred(),this.model.save(),this.$starBtn.attr({"aria-checked":this.model.starred(),title:this.model.starred()?this.messages.unstar:this.messages.star})},n.prototype.toggleRead=function(t){return t.preventDefault(),this.model.toggleReadState(),this.model.save(),this.$readBtn.attr({"aria-checked":this.model.unread(),title:this.model.unread()?this.messages.read:this.messages.unread})},n.prototype.onMouseDown=function(t){return t.shiftKey?(t.preventDefault(),setTimeout(function(){return window.getSelection().removeAllRanges()},0)):void 0},n.prototype.toJSON=function(){return this.model.toJSON().conversation},n}(a)})}).call(this);