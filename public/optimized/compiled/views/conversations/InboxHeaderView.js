(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};define(["i18n!conversations","underscore","Backbone","compiled/views/conversations/CourseSelectionView","compiled/views/conversations/SearchView","vendor/bootstrap/bootstrap-dropdown","vendor/bootstrap-select/bootstrap-select"],function(e,r,o,i,s){var a,h,c;return h=o.View,a=function(o){function a(){return this.onFilterChange=t(this.onFilterChange,this),this.onSearch=t(this.onSearch,this),c=a.__super__.constructor.apply(this,arguments)}return n(a,o),a.prototype.els={"#compose-btn":"$composeBtn","#reply-btn":"$replyBtn","#reply-all-btn":"$replyAllBtn","#archive-btn":"$archiveBtn","#delete-btn":"$deleteBtn","#type-filter":"$typeFilter","#course-filter":"$courseFilter","#admin-btn":"$adminBtn","#mark-unread-btn":"$markUnreadBtn","#mark-read-btn":"$markReadBtn","#forward-btn":"$forwardBtn","#star-toggle-btn":"$starToggleBtn","#admin-menu":"$adminMenu","#sending-message":"$sendingMessage","#sending-spinner":"$sendingSpinner","[role=search]":"$search"},a.prototype.events={"click #compose-btn":"onCompose","click #reply-btn":"onReply","click #reply-all-btn":"onReplyAll","click #archive-btn":"onArchive","click #delete-btn":"onDelete","change #type-filter":"onFilterChange","change #course-filter":"onFilterChange","click #mark-unread-btn":"onMarkUnread","click #mark-read-btn":"onMarkRead","click #forward-btn":"onForward","click #star-toggle-btn":"onStarToggle"},a.prototype.messages={star:e.t("star","Star"),unstar:e.t("unstar","Unstar"),archive:e.t("archive","Archive"),unarchive:e.t("unarchive","Unarchive"),archive_conversation:e.t("archive_conversation","Archive conversation"),unarchive_conversation:e.t("unarchive_conversation","Unarchive conversation")},a.prototype.spinnerOptions={color:"#fff",lines:10,length:2,radius:2,width:2,left:0},a.prototype.render=function(){var t;return a.__super__.render.call(this),this.$typeFilter.selectpicker(),this.courseView=new i({el:this.$courseFilter,courses:this.options.courses}),this.searchView=new s({el:this.$search}),this.searchView.on("search",this.onSearch),t=new Spinner(this.spinnerOptions),t.spin(this.$sendingSpinner[0]),this.toggleSending(!1)},a.prototype.onSearch=function(t){return this.trigger("search",t)},a.prototype.onCompose=function(){return this.trigger("compose")},a.prototype.onReply=function(){return this.trigger("reply")},a.prototype.onReplyAll=function(){return this.trigger("reply-all")},a.prototype.onArchive=function(){return this.trigger("archive")},a.prototype.onDelete=function(){return this.trigger("delete")},a.prototype.onMarkUnread=function(t){return t.preventDefault(),this.trigger("mark-unread")},a.prototype.onMarkRead=function(t){return t.preventDefault(),this.trigger("mark-read")},a.prototype.onForward=function(t){return t.preventDefault(),this.trigger("forward")},a.prototype.onStarToggle=function(t){return t.preventDefault(),this.trigger("star-toggle")},a.prototype.onModelChange=function(t,e){return this.detachModelEvents(e),this.attachModelEvents(t),this.updateUi(t)},a.prototype.updateUi=function(t){return this.toggleMessageBtns(!t||!t.get("selected")),this.onReadStateChange(t),this.onStarStateChange(t),this.onArchivedStateChange(t)},a.prototype.detachModelEvents=function(t){return t?t.off(null,null,this):void 0},a.prototype.attachModelEvents=function(t){return t?(t.on("change:workflow_state",this.onReadStateChange,this),t.on("change:starred",this.onStarStateChange,this)):void 0},a.prototype.onReadStateChange=function(t){return this.hideMarkUnreadBtn(!t||t.unread()),this.hideMarkReadBtn(!t||!t.unread()),this.refreshMenu()},a.prototype.onStarStateChange=function(t){var e;return t&&(e=t.starred()?"unstar":"star",this.$starToggleBtn.text(this.messages[e])),this.refreshMenu()},a.prototype.onArchivedStateChange=function(t){var e;if(t)return e="archived"===t.get("workflow_state"),this.$archiveBtn.find("i").attr("class",e?"icon-remove-from-collection":"icon-collection-save"),this.$archiveBtn.attr("title",e?this.messages.unarchive:this.messages.archive),this.$archiveBtn.find(".screenreader-only").text(e?this.messages.unarchive_conversation:this.messages.archive_conversation),this.refreshMenu()},a.prototype.refreshMenu=function(){return this.$adminMenu.is(".ui-menu")?this.$adminMenu.menu("refresh"):void 0},a.prototype.filterObj=function(t){return r.object(r.filter(r.pairs(t),function(t){return!!t[1]}))},a.prototype.onFilterChange=function(){var t;return null!=(t=this.searchView)&&t.autocompleteView.setContext(this.courseView.getCurrentContext()),this.trigger("filter",this.filterObj({type:this.$typeFilter.val(),course:this.$courseFilter.val()}))},a.prototype.displayState=function(t){return this.$typeFilter.selectpicker("val",t.type),this.courseView.setValue(t.course),this.trigger("course",this.courseView.getCurrentContext())},a.prototype.toggleMessageBtns=function(t){return this.toggleReplyBtn(t),this.toggleReplyAllBtn(t),this.toggleArchiveBtn(t),this.toggleDeleteBtn(t),this.toggleAdminBtn(t),this.hideForwardBtn(t)},a.prototype.toggleReplyBtn=function(t){return this._toggleBtn(this.$replyBtn,t)},a.prototype.toggleReplyAllBtn=function(t){return this._toggleBtn(this.$replyAllBtn,t)},a.prototype.toggleArchiveBtn=function(t){return this._toggleBtn(this.$archiveBtn,t)},a.prototype.toggleDeleteBtn=function(t){return this._toggleBtn(this.$deleteBtn,t)},a.prototype.toggleAdminBtn=function(t){return this._toggleBtn(this.$adminBtn,t)},a.prototype.hideMarkUnreadBtn=function(t){return t?this.$markUnreadBtn.parent().detach():this.$adminMenu.prepend(this.$markUnreadBtn.parent())},a.prototype.hideMarkReadBtn=function(t){return t?this.$markReadBtn.parent().detach():this.$adminMenu.prepend(this.$markReadBtn.parent())},a.prototype.hideForwardBtn=function(t){return t?this.$forwardBtn.parent().detach():this.$adminMenu.prepend(this.$forwardBtn.parent())},a.prototype.focusCompose=function(){return this.$composeBtn.focus()},a.prototype._toggleBtn=function(t,e){return e="undefined"==typeof e?!t.prop("disabled"):e,t.prop("disabled",e)},a.prototype.toggleSending=function(t){return this.$sendingMessage.toggle(t)},a}(h)})}).call(this);