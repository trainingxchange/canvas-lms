(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define(["compiled/views/DiscussionTopics/DiscussionsSettingsView","compiled/views/DiscussionTopics/UserSettingsView","i18n!discussion_topics","underscore","jst/announcements/IndexView","compiled/views/PaginatedView","compiled/views/DiscussionTopics/SummaryView","compiled/collections/AnnouncementsCollection"],function(e,n,s,o,r,c,l,h){var u,a;return u=function(c){function u(){return this.handleSortUpdate=t(this.handleSortUpdate,this),this.modelMeetsFilterRequirements=t(this.modelMeetsFilterRequirements,this),this.toggleActionsForSelectedDiscussions=t(this.toggleActionsForSelectedDiscussions,this),this.fetchedLastPage=t(this.fetchedLastPage,this),this.fetchedNextPage=t(this.fetchedNextPage,this),this.addDiscussionTopicToList=t(this.addDiscussionTopicToList,this),this.renderList=t(this.renderList,this),a=u.__super__.constructor.apply(this,arguments)}return i(u,c),u.prototype.template=r,u.prototype.el="#content",u.prototype.events={"change #onlyUnread, #onlyGraded, #searchTerm":"handleFilterChange","input #searchTerm":"handleFilterChange","keyup #searchTerm":"handleFilterChange",sortupdate:"handleSortUpdate","change #lock":"toggleLockingSelectedTopics","click #delete":"destroySelectedTopics","click #edit_discussions_settings":"toggleSettingsView"},u.prototype.initialize=function(){return u.__super__.initialize.apply(this,arguments),this.attachCollection(),this.render()},u.prototype.attachCollection=function(){var t=this;return this.collection.on("remove",function(){return t.collection.length?void 0:t.render()}),this.collection.on("reset",this.render),this.collection.on("add",this.renderList),this.collection.on("fetch:next",this.fetchedNextPage),this.collection.on("fetched:last",this.fetchedLastPage),this.collection.on("change:selected",this.toggleActionsForSelectedDiscussions)},u.prototype.afterRender=function(){return this.$("#discussionsFilter").buttonset(),this.renderList(),this.toggleActionsForSelectedDiscussions(),this},u.prototype.toggleSettingsView=function(){return this.settingsView||(this.settingsView=this.options.permissions.change_settings?new e:new n),this.settingsView.toggle()},u.prototype.renderList=function(){var t,e,i;return t=this.$(".discussionTopicIndexList").empty(),i=!o.any(this.collection.map(this.addDiscussionTopicToList)),this.$(".nothingMatchedFilter").toggle(i&&!this.collection.fetchingNextPage),e=!i&&!this.activeFilters.length&&!this.isShowingAnnouncements()&&this.options.permissions.moderate,e?t.sortable({axis:"y",cancel:"a",containment:t,cursor:"ns-resize",handle:".discussion-drag-handle",tolerance:"pointer"}):t.is(":ui-sortable")?t.sortable("destroy"):void 0},u.prototype.addDiscussionTopicToList=function(t){var e;return this.modelMeetsFilterRequirements(t)?(e=new l({model:t,permissions:this.options.permissions}),this.$(".discussionTopicIndexList").append(e.render().el)):void 0},u.prototype.fetchedNextPage=function(){var t;return t=this.$(".discussionTopicIndexList"),this.collection.length&&!t.length?this.render():this.renderList()},u.prototype.fetchedLastPage=function(){return this.lastPageFetched=!0,this.collection.length?void 0:this.render()},u.prototype.toggleActionsForSelectedDiscussions=function(){var t,e,i,n;return n=this.selectedTopics(),e=n.length>0,t=this.$("#actionsForSelectedDiscussions"),e?(t.removeClass("screenreader-only"),t.find("button,input").prop("disabled",!1),i=o.any(n,function(t){return t.get("locked")}),t.find("#lock").prop("checked",i).button({text:!1,icons:{primary:"ui-icon-locked"}}),t.find("#delete").button({text:!1,icons:{primary:"ui-icon-trash"}}),t.buttonset()):(t.addClass("screenreader-only"),t.find("button,input").prop("disabled",!0))},u.prototype.toggleLockingSelectedTopics=function(){var t;return t=this.$("#lock").is(":checked"),o.invoke(this.selectedTopics(),"updateOneAttribute","locked",t)},u.prototype.destroySelectedTopics=function(){var t,e;return e=this.selectedTopics(),t=this.isShowingAnnouncements()?s.t("confirm_delete_announcement",{one:"Are you sure you want to delete this announcement?",other:"Are you sure you want to delete these %{count} announcements?"},{count:e.length}):s.t("confirm_delete_discussion_topic",{one:"Are you sure you want to delete this discussion topic?",other:"Are you sure you want to delete these %{count} discussion topics?"},{count:e.length}),confirm(t)?(o(e).invoke("destroy"),this.toggleActionsForSelectedDiscussions()):void 0},u.prototype.selectedTopics=function(){return this.collection.filter(function(t){return t.selected})},u.prototype.modelMeetsFilterRequirements=function(t){var e=this;return o.all(this.activeFilters(),function(i,n){return i.call(t,e[n])})},u.prototype.handleSortUpdate=function(t,e){var i,n;return i=e.item.data("id"),n=e.item.next(".discussion-topic").data("id"),this.collection.get(i).positionAfter(n)},u.prototype.activeFilters=function(){var t,e,i,n;i={},n=this.filters;for(e in n)t=n[e],this[e]&&(i[e]=t);return i},u.prototype.handleFilterChange=function(t){var e,i;return e=t.target,i="checkbox"===e.type?e.checked:e.value,this[e.id]!==i?(this[e.id]=i,this.renderList(),this.collection.trigger("aBogusEventToCauseYouToFetchNextPageIfNeeded")):void 0},u.prototype.filters={onlyGraded:function(){return this.get("assignment_id")},onlyUnread:function(){return"unread"===this.get("read_state")||this.get("unread_count")},searchTerm:function(t){var e,i,n,s,r;return n=t.match(/\w+/gi),e="("+o.uniq(n).join("|")+")",i=new RegExp(e,"igm"),(null!=(s=this.get("author"))&&null!=(r=s.display_name)?r.match(i):void 0)||this.get("title").match(i)||this.summary().match(i)}},u.prototype.isShowingAnnouncements=function(){return this.collection.constructor===h},u.prototype.toJSON=function(){var t,e,i;return i=this.collection.url().replace("/api/v1","")+"/new",this.isShowingAnnouncements()&&(i=(i+"?is_announcement=true").replace(this.collection._stringToAppendToURL,"")),e=o.pick(this,o.keys(this.filters)),t=o.pick(this.collection,["atLeastOnePageFetched","length"]),o.extend({new_topic_url:i,options:this.options,showingAnnouncements:this.isShowingAnnouncements(),lastPageFetched:this.lastPageFetched},e,t)},u}(c)})}).call(this);