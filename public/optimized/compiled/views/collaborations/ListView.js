(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,r=function(t,r){function n(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};define(["jquery","underscore","compiled/views/PaginatedView","compiled/collections/UserCollection","compiled/collections/GroupCollection","jst/collaborations/collaborator"],function(e,n,o,i,l,s){var a,c,u,p,h,d;return c=n.each,u=n.extend,p=n.flatten,h=n.reject,a=function(n){function o(){return this.renderCollaborator=t(this.renderCollaborator,this),this.render=t(this.render,this),d=o.__super__.constructor.apply(this,arguments)}return r(o,n),o.prototype.filteredMembers=[],o.prototype.events={"click a":"selectCollaborator"},o.prototype.initialize=function(t){return null==t&&(t={}),this.collection=this.createCollection(t.type),this.paginationScrollContainer=this.$el.parents(".list-wrapper"),this.attachEvents(),o.__super__.initialize.apply(this,arguments)},o.prototype.createCollection=function(t){return null==t&&(t="user"),"user"===t?new i({comparator:function(t){return t.get("sortable_name")}}):new l},o.prototype.attachEvents=function(){var t=this;return this.collection.on("add remove reset",this.render).on("remove",function(e){return t.trigger("collection:remove",e)})},o.prototype.render=function(){var t;return this.updateFilter([]),t=this.collection.map(this.renderCollaborator),this.$el.html(t.join("")),null!=this.currentIndex&&this.hasFocus&&this.updateFocus(),this.hasFocus=!1,o.__super__.render.apply(this,arguments)},o.prototype.renderCollaborator=function(t){var e;return t.get("id")===this.options.currentUser?"":(e=u(t.toJSON(),{name:t.get("sortable_name")||t.get("name"),type:t.modelType}),s(e))},o.prototype.updateFocus=function(){var t;return t=e(this.$el.find("li").get(this.currentIndex)).find("a"),0===t.length&&(t=e(this.$el.find("li").get(this.currentIndex-1)).find("a")),0===t.length&&(t=this.$el.parents(".collaborator-picker").find(".members-list")),t.focus()},o.prototype.selectCollaborator=function(t){var r;return t.preventDefault(),r=e(t.currentTarget).data("id"),this.currentIndex=e(t.currentTarget).parent().index(),this.hasFocus=!0,this.collection.remove(r)},o.prototype.updateFilter=function(t){var e=this;return setTimeout(function(){return e.filteredMembers=p([e.filteredMembers,t]),c(e.filteredMembers,function(t){return e.collection.remove(t,{silent:!0})})},0)},o.prototype.removeFromFilter=function(t){return this.filteredMembers=h(this.filteredMembers,function(e){return e.get("id")===t.get("id")})},o}(o)})}).call(this);