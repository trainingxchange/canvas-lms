(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function s(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return s.prototype=i.prototype,t.prototype=new s,t.__super__=i.prototype,t};define(["i18n!collaborations","jquery","Backbone","compiled/views/collaborations/ListView","compiled/views/collaborations/MemberListView","jst/collaborations/CollaboratorPicker"],function(e,s,r,o,n,l){var c,p,h;return p=r.View,c=function(e){function r(){return this.updateListFilters=t(this.updateListFilters,this),this.deselectCollaborator=t(this.deselectCollaborator,this),h=r.__super__.constructor.apply(this,arguments)}return i(r,e),r.prototype.template=l,r.prototype.events={"change .filters input":"filterList"},r.prototype.fetchOptions={data:{per_page:50}},r.prototype.initialize=function(){return r.__super__.initialize.apply(this,arguments),this.cacheElements(),this.createLists(),this.attachEvents(),this.includeGroups=!window.location.pathname.match(/groups/)},r.prototype.cacheElements=function(){return this.$template=s(this.template({id:this.options.id||"new"})),this.$userList=this.$template.find(".available-users"),this.$groupList=this.$template.find(".available-groups"),this.$memberList=this.$template.find(".members-list-wrapper"),this.$listFilter=this.$template.find(".filters")},r.prototype.attachEvents=function(){return this.groupList.on("collection:remove",this.memberList.collection.add.bind(this.memberList.collection)),this.userList.on("collection:remove",this.memberList.collection.add.bind(this.memberList.collection)),this.memberList.on("collection:remove",this.deselectCollaborator),this.memberList.on("collection:reset",this.updateListFilters)},r.prototype.createLists=function(){var t;return t=ENV.current_user_id&&String(ENV.current_user_id),this.userList=new o({currentUser:t,el:this.$userList,fetchOptions:this.fetchOptions,type:"user"}),this.groupList=new o({el:this.$groupList,fetchOptions:this.fetchOptions,type:"group"}),this.memberList=new n({currentUser:t,el:this.$memberList})},r.prototype.fetchCollaborators=function(){return this.userList.collection.fetch(this.fetchOptions),this.includeGroups&&this.groupList.collection.fetch(this.fetchOptions),this.options.edit?(this.memberList.collection.url="/api/v1/collaborations/"+this.options.id+"/members",this.memberList.currentXHR=this.memberList.collection.fetch(this.fetchOptions)):void 0},r.prototype.render=function(){return this.$el.append(this.$template),this.fetchCollaborators(),this.includeGroups?this.$listFilter.buttonset():this.$listFilter.hide(),this},r.prototype.filterList=function(t){var e;return e=s(t.currentTarget).val(),this.$el.find(".available-lists ul").hide(),this.$el.find("."+e).show()},r.prototype.deselectCollaborator=function(t){var e;return e="user"===t.modelType?this.userList:this.groupList,e.removeFromFilter(t),e.collection.add(t)},r.prototype.updateListFilters=function(t,e){var i;return i="user"===t?this.userList:this.groupList,i.updateFilter(e)},r}(p)})}).call(this);