(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,o=function(e,o){function r(){this.constructor=e}for(var s in o)t.call(o,s)&&(e[s]=o[s]);return r.prototype=o.prototype,e.prototype=new r,e.__super__=o.prototype,e};define(["jquery","underscore","Backbone","jst/groups/manage/group","compiled/views/groups/manage/GroupUsersView","compiled/views/groups/manage/GroupDetailView"],function(t,r,s,i){var n,a,p;return a=s.View,n=function(s){function n(){return this._onDrop=e(this._onDrop,this),p=n.__super__.constructor.apply(this,arguments)}return o(n,s),n.prototype.tagName="li",n.prototype.className="group",n.prototype.attributes=function(){return{"data-id":this.model.id}},n.prototype.template=i,n.optionProperty("expanded"),n.optionProperty("addUnassignedMenu"),n.child("groupUsersView","[data-view=groupUsers]"),n.child("groupDetailView","[data-view=groupDetail]"),n.prototype.events={"click .toggle-group":"toggleDetails","click .add-user":"showAddUser","focus .add-user":"showAddUser","blur .add-user":"hideAddUser"},n.prototype.dropOptions={accept:".group-user",activeClass:"droppable",hoverClass:"droppable-hover",tolerance:"pointer"},n.prototype.attach=function(){return this.expanded=!1,this.users=this.model.users(),this.model.on("destroy",this.remove,this),this.model.on("change:members_count",this.updateFullState,this),this.model.on("change:max_membership",this.updateFullState,this)},n.prototype.afterRender=function(){return this.$el.toggleClass("group-expanded",this.expanded),this.$el.toggleClass("group-collapsed",!this.expanded),this.groupDetailView.$toggleGroup.attr("aria-expanded",""+this.expanded),this.updateFullState()},n.prototype.updateFullState=function(){return this.model.isLocked()?void 0:this.model.isFull()?(this.$el.data("droppable")&&this.$el.droppable("destroy"),this.$el.addClass("slots-full")):(this.$el.data("droppable")||this.$el.droppable(r.extend({},this.dropOptions)).on("drop",this._onDrop),this.$el.removeClass("slots-full"))},n.prototype.toggleDetails=function(e){return e.preventDefault(),this.expanded=!this.expanded,this.expanded&&!this.users.loaded&&this.users.load(this.model.usersCount()?"all":"none"),this.afterRender()},n.prototype.showAddUser=function(e){var o;return e.preventDefault(),e.stopPropagation(),o=t(e.currentTarget),this.addUnassignedMenu.group=this.model,this.addUnassignedMenu.showBy(o,"click"===e.type)},n.prototype.hideAddUser=function(){return this.addUnassignedMenu.hide()},n.prototype.closeMenus=function(){return this.groupDetailView.closeMenu(),this.groupUsersView.closeMenus()},n.prototype._onDrop=function(e,o){var r,s,i=this;return s=o.draggable.data("model"),r=t(e.currentTarget).data("id"),setTimeout(function(){return i.model.collection.category.reassignUser(s,i.model.collection.get(r))})},n}(a)})}).call(this);