(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,r=function(e,r){function o(){this.constructor=e}for(var n in r)t.call(r,n)&&(e[n]=r[n]);return o.prototype=r.prototype,e.prototype=new o,e.__super__=r.prototype,e};define(["i18n!groups","jquery","underscore","Backbone","compiled/views/MessageStudentsDialog","compiled/views/groups/manage/RandomlyAssignMembersView","compiled/views/groups/manage/GroupCreateView","compiled/views/groups/manage/GroupCategoryEditView","compiled/models/Group","jst/groups/manage/groupCategoryDetail"],function(t,o,n,s,i,a,u,l,d,g){var p,c,m;return c=s.View,p=function(n){function s(){return this.deleteCategory=e(this.deleteCategory,this),m=s.__super__.constructor.apply(this,arguments)}return r(s,n),s.prototype.template=g,s.optionProperty("parentView"),s.prototype.events={"click .message-all-unassigned":"messageAllUnassigned","click .edit-category":"editCategory","click .delete-category":"deleteCategory","click .add-group":"addGroup"},s.prototype.els={".randomly-assign-members":"$randomlyAssignMembersLink",".al-trigger":"$groupCategoryActions",".edit-category":"$editGroupCategoryLink",".message-all-unassigned":"$messageAllUnassignedLink",".add-group":"$addGroupButton"},s.prototype.initialize=function(e){return s.__super__.initialize.apply(this,arguments),this.randomlyAssignUsersView=new a({model:e.model})},s.prototype.attach=function(){return this.collection.on("add remove reset",this.render),this.model.on("change",this.render)},s.prototype.afterRender=function(){var e;return this.randomlyAssignUsersView.setTrigger(this.$randomlyAssignMembersLink),null!=(e=this.createView)?e.setTrigger(this.$addGroupButton):void 0},s.prototype.toJSON=function(){var e;return e=s.__super__.toJSON.apply(this,arguments),e.canMessageMembers=this.model.canMessageUnassignedMembers(),e.canAssignMembers=this.model.canAssignUnassignedMembers(),e.locked=this.model.isLocked(),e},s.prototype.deleteCategory=function(e){return e.preventDefault(),confirm(t.t("delete_confirm","Are you sure you want to remove this group set?"))?this.model.destroy({success:function(){return o.flashMessage(t.t("flash.removed","Group set successfully removed."))},failure:function(){return o.flashError(t.t("flash.removeError","Unable to remove the group set. Please try again later."))}}):void this.$groupCategoryActions.focus()},s.prototype.addGroup=function(e){var t,r,o=this;return e.preventDefault(),null==(r=this.createView)&&(this.createView=new u({groupCategory:this.model,trigger:this.$addGroupButton})),t=new d({group_category_id:this.model.id},{newAndEmpty:!0}),t.once("sync",function(){return o.collection.add(t)}),this.createView.model=t,this.createView.open()},s.prototype.editCategory=function(){var e;return null==(e=this.editCategoryView)&&(this.editCategoryView=new l({model:this.model,trigger:this.$editGroupCategoryLink})),this.editCategoryView.open()},s.prototype.messageAllUnassigned=function(e){var r,n,s=this;return e.preventDefault(),r=o.Deferred(),this.parentView.$el.disableWhileLoading(r),r.done(function(){var e,r;return r=s.model.unassignedUsers().map(function(e){return{id:e.get("id"),short_name:e.get("short_name")}}),e=new i({trigger:s.$messageAllUnassignedLink,context:s.model.get("name"),recipientGroups:[{name:t.t("students_who_have_not_joined_a_group","Students who have not joined a group"),recipients:r}]}),e.open()}),n=this.model.unassignedUsers(),n.on("fetched:last",function(){return r.resolve()}),null!=n.urls.next?(n.loadAll=!0,n.fetch({page:"next"})):r.resolve()},s}(c)})}).call(this);