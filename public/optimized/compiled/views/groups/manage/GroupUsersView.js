(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,r=function(e,r){function o(){this.constructor=e}for(var i in r)t.call(r,i)&&(e[i]=r[i]);return o.prototype=r.prototype,e.prototype=new o,e.__super__=r.prototype,e};define(["jquery","underscore","compiled/collections/GroupCollection","compiled/views/PaginatedCollectionView","compiled/views/groups/manage/GroupUserView","compiled/views/groups/manage/EditGroupAssignmentView","jst/groups/manage/groupUsers","jqueryui/draggable","jqueryui/droppable"],function(t,o,i,n,s,u,p){var a,l;return a=function(i){function a(){return this.removeItem=e(this.removeItem,this),this._initDrag=e(this._initDrag,this),this.renderItem=e(this.renderItem,this),l=a.__super__.constructor.apply(this,arguments)}return r(a,i),a.prototype.defaults=o.extend({},n.prototype.defaults,{itemView:s,itemViewOptions:{canAssignToGroup:!1,canEditGroupAssignment:!0}}),a.prototype.dragOptions={appendTo:"body",helper:"clone",opacity:.75,refreshPositions:!0,revert:"invalid",revertDuration:150,start:function(){return t(".assign-to-group-menu").hide()}},a.prototype.initialize=function(){return a.__super__.initialize.apply(this,arguments),this.collection.loadAll?this.detachScroll():void 0},a.prototype.template=p,a.prototype.attach=function(){return this.model.on("change:members_count",this.render),this.model.on("change:leader",this.render),this.collection.on("moved",this.highlightUser)},a.prototype.highlightUser=function(e){return e.itemView.highlight()},a.prototype.closeMenus=function(){var e,t,r,o,i;for(o=this.collection.models,i=[],t=0,r=o.length;r>t;t++)e=o[t],i.push(e.itemView.closeMenu());return i},a.prototype.events={"click .remove-from-group":"removeUserFromGroup","click .remove-as-leader":"removeLeader","click .set-as-leader":"setLeader","click .edit-group-assignment":"editGroupAssignment"},a.prototype.removeUserFromGroup=function(e){var r;return e.preventDefault(),e.stopPropagation(),r=t(e.currentTarget),this.collection.get(r.data("user-id")).save("group",null)},a.prototype.removeLeader=function(e){return e.preventDefault(),e.stopPropagation(),this.model.save({leader:null})},a.prototype.setLeader=function(e){var r;return e.preventDefault(),e.stopPropagation(),r=t(e.currentTarget),this.model.save({leader:{id:r.data("user-id").toString()}})},a.prototype.editGroupAssignment=function(e){var r,o,i,n;return e.preventDefault(),e.stopPropagation(),null==(n=this.editGroupAssignmentView)&&(this.editGroupAssignmentView=new u({group:this.model})),r=t(e.currentTarget),i=this.collection.get(r.data("user-id")),this.editGroupAssignmentView.model=i,o="[data-focus-returns-to='group-"+this.model.id+"-user-"+i.id+"-actions']",this.editGroupAssignmentView.setTrigger(o),this.editGroupAssignmentView.open()},a.prototype.toJSON=function(){return{count:this.model.usersCount(),locked:this.model.isLocked(),ENV:ENV}},a.prototype.renderItem=function(e){var t;return a.__super__.renderItem.apply(this,arguments),(null!=(t=this.model)?t.isLocked():void 0)?void 0:this._initDrag(e.view)},a.prototype._initDrag=function(e){return e.$el.draggable(o.extend({},this.dragOptions)),e.$el.on("dragstart",function(r,o){var i;return o.helper.css("width",e.$el.width()),i=[0,0,t(window).width()-o.helper.outerWidth(!0),t(window).height()-o.helper.outerHeight(!0)],t(r.target).draggable("option","containment",i),t(r.target).data("draggable")._setContainment()})},a.prototype.removeItem=function(e){return e.view.remove()},a}(n)})}).call(this);