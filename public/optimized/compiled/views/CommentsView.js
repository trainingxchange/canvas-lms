(function(){var e={}.hasOwnProperty,t=function(t,r){function n(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};define(["Backbone","underscore","compiled/fn/preventDefault","jst/CommentsView","jst/_avatar"],function(e,r,n,o){var i,u;return i=function(e){function i(){return u=i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.template=o,i.prototype.events={"submit form":"addNewComment","click [data-delete-comment]":"deleteComment"},i.prototype.initialize=function(){return i.__super__.initialize.apply(this,arguments),this.render(),this.model.entries.on("all",this.render)},i.prototype.toJSON=function(){return{entries:this.model.entries.map(function(e){var t,n;return r.extend(e.toJSON(),{author:e.author(),editor:e.editor(),canDelete:(null!=(t=e.author())?t.id:void 0)===(null!=(n=ENV.current_user)?n.id:void 0)})}),currentUser:ENV.current_user}},i.prototype.deleteComment=n(function(e){var t,r;return r=e.target,t=this.$(r).data("deleteComment"),this.model.entries.get(t).destroy()}),i.prototype.addNewComment=n(function(){var e,t;if(t=this.$('[name="message"]').val())return e=this.model.entries.create({message:t.replace(/\n/g,"<br />")}),e.set("user_id",ENV.current_user_id)}),i}(e.View)})}).call(this);