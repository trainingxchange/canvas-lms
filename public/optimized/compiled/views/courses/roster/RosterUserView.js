(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,r=function(e,r){function n(){this.constructor=e}for(var o in r)t.call(r,o)&&(e[o]=r[o]);return n.prototype=r.prototype,e.prototype=new n,e.__super__=r.prototype,e};define(["i18n!roster","jquery","underscore","Backbone","jst/courses/roster/rosterUser","compiled/views/courses/roster/EditSectionsView","compiled/views/courses/roster/InvitationsView","compiled/views/courses/roster/LinkToStudentsView","compiled/str/underscore","str/htmlEscape","compiled/jquery.kylemenu"],function(t,n,o,s,i,l,u,a){var c,m,p,h,d;return m=null,h=null,p=null,c=function(s){function c(){return this.blur=e(this.blur,this),this.focus=e(this.focus,this),this.handleMenuEvent=e(this.handleMenuEvent,this),d=c.__super__.constructor.apply(this,arguments)}return r(c,s),c.prototype.tagName="tr",c.prototype.className="rosterUser al-hover-container",c.prototype.template=i,c.prototype.events={"click .admin-links [data-event]":"handleMenuEvent","focus *":"focus","blur *":"blur"},c.prototype.attach=function(){return this.model.on("change",this.render,this)},c.prototype.initialize=function(e){var t,r,n,o,s,i;for(c.__super__.initialize.apply(this,arguments),this.model.currentRole=null!=(o=this.model.get("enrollments")[0])?o.role:void 0,this.$el.attr("id","user_"+e.model.get("id")),s=this.model.get("enrollments"),i=[],r=0,n=s.length;n>r;r++)t=s[r],i.push(this.$el.addClass(t.role));return i},c.prototype.toJSON=function(){var e;return e=c.__super__.toJSON.apply(this,arguments),this.permissionsJSON(e),this.observerJSON(e),e},c.prototype.permissionsJSON=function(e){var t=this;return e.url=""+ENV.COURSE_ROOT_URL+"/users/"+this.model.get("id"),e.isObserver=this.model.hasEnrollmentType("ObserverEnrollment"),e.isPending=this.model.pending(this.model.currentRole),e.canEditSections=!o.isEmpty(this.model.sectionEditableEnrollments()),e.canLinkStudents=e.isObserver&&!ENV.course.concluded,e.canViewLoginIdColumn=ENV.permissions.manage_admin_users||ENV.permissions.manage_students,e.canViewLoginId=e.canManage=o.any(["TeacherEnrollment","DesignerEnrollment","TaEnrollment"],function(e){return t.model.hasEnrollmentType(e)})?ENV.permissions.manage_admin_users:ENV.permissions.manage_students},c.prototype.observerJSON=function(e){var r,n,s,i,l,u,a,c,m,p;if(e.isObserver){if(i=o.filter(e.enrollments,function(e){return"ObserverEnrollment"===e.type}),e.enrollments=o.reject(e.enrollments,function(e){return"ObserverEnrollment"===e.type}),e.sections=o.map(e.enrollments,function(e){return ENV.CONTEXTS.sections[e.course_section_id]}),u={},1!==i.length||i[0].observed_user)for(a=0,c=i.length;c>a;a++)r=i[a],r.observed_user&&(l=r.observed_user,u[m=l.id]||(u[m]=l));else u[""]={name:t.t("nobody","nobody")};p=[];for(n in u)l=u[n],s={role:t.t("observing_user","Observing: %{user_name}",{user_name:l.name})},p.push(e.enrollments.push(s));return p}},c.prototype.resendInvitation=function(){return p||(p=new u),p.model=this.model,p.render().show()},c.prototype.editSections=function(){return m||(m=new l),m.model=this.model,m.render().show()},c.prototype.linkToStudents=function(){return h||(h=new a),h.model=this.model,h.render().show()},c.prototype.removeFromCourse=function(){var e,r,s,i=this;if(confirm(t.t("delete_confirm","Are you sure you want to remove this user?")))return this.$el.hide(),s=function(){return n.flashMessage(t.t("flash.removed","User successfully removed."))},r=function(){return i.$el.show(),n.flashError(t.t("flash.removeError","Unable to remove the user. Please try again later."))},e=o.map(this.model.allEnrollmentsByRole(this.model.currentRole),function(e){return n.ajaxJSON(""+ENV.COURSE_ROOT_URL+"/unenroll/"+e.id,"DELETE")}),n.when.apply(n,e).then(s,r)},c.prototype.handleMenuEvent=function(e){var t;return this.blur(),e.preventDefault(),t=n(e.currentTarget).data("event"),this[t].call(this,e)},c.prototype.focus=function(){return this.$el.addClass("al-hover-container-active table-hover-row")},c.prototype.blur=function(){return this.$el.removeClass("al-hover-container-active table-hover-row")},c}(s.View)})}).call(this);