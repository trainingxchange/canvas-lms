(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function s(){this.constructor=e}for(var n in i)t.call(i,n)&&(e[n]=i[n]);return s.prototype=i.prototype,e.prototype=new s,e.__super__=i.prototype,e},s=[].slice;define(["INST","i18n!assignment","compiled/views/ValidatedFormView","underscore","jquery","wikiSidebar","jst/assignments/EditView","compiled/userSettings","compiled/models/TurnitinSettings","compiled/views/assignments/TurnitinSettingsDialog","compiled/fn/preventDefault","compiled/views/calendar/MissingDateDialogView","compiled/views/assignments/AssignmentGroupSelector","compiled/views/assignments/GroupCategorySelector","compiled/jquery/toggleAccessibly","compiled/tinymce","tinymce.editor_box","jqueryui/dialog","jquery.toJSON","compiled/jquery.rails_flash_notifications"],function(t,n,o,r,a,l,d,u,p,c,_,g,h,m){var y,v;return y=function(_){function y(){return this._validatePercentagePoints=e(this._validatePercentagePoints,this),this._validatePointsPossible=e(this._validatePointsPossible,this),this._validateAllowedExtensions=e(this._validateAllowedExtensions,this),this._validateSubmissionTypes=e(this._validateSubmissionTypes,this),this._validateTitle=e(this._validateTitle,this),this.validateBeforeSave=e(this.validateBeforeSave,this),this._filterAllowedExtensions=e(this._filterAllowedExtensions,this),this._inferSubmissionTypes=e(this._inferSubmissionTypes,this),this.submit=e(this.submit,this),this.getFormData=e(this.getFormData,this),this._initializeWikiSidebar=e(this._initializeWikiSidebar,this),this._attachEditorToDescription=e(this._attachEditorToDescription,this),this.toJSON=e(this.toJSON,this),this.afterRender=e(this.afterRender,this),this.handleSubmissionTypeChange=e(this.handleSubmissionTypeChange,this),this.handleGradingTypeChange=e(this.handleGradingTypeChange,this),this.handleRestrictFileUploadsChange=e(this.handleRestrictFileUploadsChange,this),this.toggleAdvancedTurnitinSettings=e(this.toggleAdvancedTurnitinSettings,this),this.toggleRestrictFileUploads=e(this.toggleRestrictFileUploads,this),this.showExternalToolsDialog=e(this.showExternalToolsDialog,this),this.showTurnitinDialog=e(this.showTurnitinDialog,this),this.cacheAssignmentSettings=e(this.cacheAssignmentSettings,this),this.setDefaultsIfNew=e(this.setDefaultsIfNew,this),this.settingsToCache=e(this.settingsToCache,this),this.handleCancel=e(this.handleCancel,this),v=y.__super__.constructor.apply(this,arguments)}var f,b,S,w,T,E,D,x,N,A,V,$,C,F,O,R,k,P;return i(y,_),y.prototype.template=d,y.prototype.dontRenableAfterSaveSuccess=!0,w="#assignment_group_selector",T='[name="description"]',k='[name="submission_type"]',C="#assignment_online_submission_types",$='[name="name"]',S="#assignment_online_upload",O="#assignment_restrict_file_extensions",R="#restrict_file_extensions_container",b="#allowed_extensions_container",P="#assignment_turnitin_enabled",f="#advanced_turnitin_settings_link",A="#grading_type_selector",N="#graded_assignment_fields",x="#assignment_external_tool_settings",V="#group_category_selector",F="#assignment_peer_reviews_fields",D="#assignment_external_tool_tag_attributes_url",E="#assignment_external_tool_tag_attributes_new_tab",y.prototype.els=r.extend({},y.prototype.els,function(){var e;return e={},e[""+w]="$assignmentGroupSelector",e[""+T]="$description",e[""+k]="$submissionType",e[""+C]="$onlineSubmissionTypes",e[""+$]="$name",e[""+S]="$allowFileUploads",e[""+O]="$restrictFileUploads",e[""+R]="$restrictFileUploadsOptions",e[""+b]="$allowedExtensions",e[""+P]="$turnitinEnabled",e[""+f]="$advancedTurnitinSettings",e[""+A]="$gradingTypeSelector",e[""+N]="$gradedAssignmentFields",e[""+x]="$externalToolSettings",e[""+V]="$groupCategorySelector",e[""+F]="$peerReviewsFields",e[""+D]="$externalToolsUrl",e[""+E]="$externalToolsNewTab",e}()),y.prototype.events=r.extend({},y.prototype.events,function(){var e;return e={},e["click .cancel_button"]="handleCancel",e["change "+k]="handleSubmissionTypeChange",e["change "+O]="handleRestrictFileUploadsChange",e["click "+f]="showTurnitinDialog",e["change "+P]="toggleAdvancedTurnitinSettings",e["change "+S]="toggleRestrictFileUploads",e["click "+D]="showExternalToolsDialog",e}()),y.child("assignmentGroupSelector",""+w),y.child("gradingTypeSelector",""+A),y.child("groupCategorySelector",""+V),y.child("peerReviewsSelector",""+F),y.prototype.initialize=function(e){return y.__super__.initialize.apply(this,arguments),this.assignment=this.model,this.setDefaultsIfNew(),this.dueDateOverrideView=e.views["js-assignment-overrides"],this.model.on("sync",function(){return window.location=this.get("html_url")}),this.gradingTypeSelector.on("change:gradingType",this.handleGradingTypeChange)},y.prototype.handleCancel=function(e){return e.preventDefault(),null!=ENV.CANCEL_TO?window.location=ENV.CANCEL_TO:void 0},y.prototype.settingsToCache=function(){return["assignment_group_id","grading_type","submission_type","submission_types","points_possible","allowed_extensions","peer_reviews","peer_review_count","automatic_peer_reviews","group_category_id","grade_group_students_individually","turnitin_enabled"]},y.prototype.setDefaultsIfNew=function(){var e=this;return this.assignment.isNew()?u.contextGet("new_assignment_settings")?r.each(this.settingsToCache(),function(t){var i,s;return i=u.contextGet("new_assignment_settings")[t],("1"===i||"0"===i)&&(i=parseInt(i)),!i||e.assignment.get(t)&&0!==(null!=(s=e.assignment.get(t))?s.length:void 0)?void 0:e.assignment.set(t,i)}):(this.assignment.set("submission_type","online"),this.assignment.set("submission_types",["online"])):void 0},y.prototype.cacheAssignmentSettings=function(){var e;return e=r.pick.apply(r,[this.getFormData()].concat(s.call(this.settingsToCache()))),u.contextSet("new_assignment_settings",e)},y.prototype.showTurnitinDialog=function(e){var t,i=this;return e.preventDefault(),t=new c({model:this.assignment.get("turnitin_settings")}),t.render().on("settings:change",function(e){return i.assignment.set("turnitin_settings",new p(e)),t.off(),t.remove()})},y.prototype.showExternalToolsDialog=function(){var e=this;return t.selectContentDialog({dialog_title:n.t("select_external_tool_dialog_title","Configure External Tool"),select_button_text:n.t("buttons.select_url","Select"),no_name_input:!0,submit:function(t){return e.$externalToolsUrl.val(t["item[url]"]),e.$externalToolsNewTab.prop("checked","1"===t["item[new_tab]"])}})},y.prototype.toggleRestrictFileUploads=function(){return this.$restrictFileUploadsOptions.toggleAccessibly(this.$allowFileUploads.prop("checked"))},y.prototype.toggleAdvancedTurnitinSettings=function(e){return e.preventDefault(),this.$advancedTurnitinSettings.toggleAccessibly(this.$turnitinEnabled.prop("checked"))},y.prototype.handleRestrictFileUploadsChange=function(){return this.$allowedExtensions.toggleAccessibly(this.$restrictFileUploads.prop("checked"))},y.prototype.handleGradingTypeChange=function(e){return this.$gradedAssignmentFields.toggleAccessibly("not_graded"!==e),this.handleSubmissionTypeChange(null)},y.prototype.handleSubmissionTypeChange=function(){var e;return e=this.$submissionType.val(),this.$onlineSubmissionTypes.toggleAccessibly("online"===e),this.$externalToolSettings.toggleAccessibly("external_tool"===e),this.$groupCategorySelector.toggleAccessibly("external_tool"!==e),this.$peerReviewsFields.toggleAccessibly("external_tool"!==e)},y.prototype.afterRender=function(){return this._attachEditorToDescription(),a(this._initializeWikiSidebar),this},y.prototype.toJSON=function(){var e;return e=this.assignment.toView(),r.extend(e,{kalturaEnabled:("undefined"!=typeof ENV&&null!==ENV?ENV.KALTURA_ENABLED:void 0)||!1,postToSISEnabled:("undefined"!=typeof ENV&&null!==ENV?ENV.POST_TO_SIS:void 0)||!1,isLargeRoster:("undefined"!=typeof ENV&&null!==ENV?ENV.IS_LARGE_ROSTER:void 0)||!1,differentiatedAssignmnetsEnabled:("undefined"!=typeof ENV&&null!==ENV?ENV.DIFFERENTIATED_ASSIGNMENTS_ENABLED:void 0)||!1,submissionTypesFrozen:r.include(e.frozenAttributes,"submission_types")})},y.prototype._attachEditorToDescription=function(){var e=this;return this.$description.editorBox(),a(".rte_switch_views_link").click(function(t){return t.preventDefault(),e.$description.editorBox("toggle"),a(t.currentTarget).siblings(".rte_switch_views_link").andSelf().toggle()})},y.prototype._initializeWikiSidebar=function(){return l.inited||(l.init(),a.scrollSidebar()),l.attachToEditor(this.$description).show()},y.prototype.getFormData=function(){var e,t;return e=y.__super__.getFormData.apply(this,arguments),e=this._inferSubmissionTypes(e),e=this._filterAllowedExtensions(e),("undefined"!=typeof ENV&&null!==ENV?ENV.IS_LARGE_ROSTER:void 0)||(e=this.groupCategorySelector.filterFormData(e)),e.post_to_sis||(e.post_to_sis=!1),this.dueDateOverrideView.updateOverrides(),t=this.dueDateOverrideView.getDefaultDueDate(),e.lock_at=(null!=t?t.get("lock_at"):void 0)||null,e.unlock_at=(null!=t?t.get("unlock_at"):void 0)||null,e.due_at=(null!=t?t.get("due_at"):void 0)||null,("undefined"!=typeof ENV&&null!==ENV?ENV.DIFFERENTIATED_ASSIGNMENTS_ENABLED:void 0)&&(e.only_visible_to_overrides=this.dueDateOverrideView.containsSectionsWithoutOverrides()),e.assignment_overrides=this.dueDateOverrideView.getOverrides(),e},y.prototype.submit=function(e){var t,i,s=this;return e.preventDefault(),e.stopPropagation(),this.cacheAssignmentSettings(),this.dueDateOverrideView.updateOverrides(),this.dueDateOverrideView.containsSectionsWithoutOverrides()?(i=this.dueDateOverrideView.sectionsWithoutOverrides(),t=new g({validationFn:function(){return i},labelFn:function(e){return e.get("name")},success:function(){return o.prototype.submit.call(s)}}),t.cancel=function(){return t.$dialog.dialog("close").remove()},t.render()):y.__super__.submit.apply(this,arguments)},y.prototype._inferSubmissionTypes=function(e){var t;return"not_graded"===e.grading_type?e.submission_types=["not_graded"]:"online"===e.submission_type?(t=r.select(r.keys(e.online_submission_types),function(t){return"1"===e.online_submission_types[t]}),e.submission_types=t):e.submission_types=[e.submission_type],delete e.online_submission_type,delete e.online_submission_types,e},y.prototype._filterAllowedExtensions=function(e){var t;return t=e.restrict_file_extensions,delete e.restrict_file_extensions,e.allowed_extensions="1"===t?r.select(e.allowed_extensions.split(","),function(e){return a.trim(e.toString()).length>0}):null,e},y.prototype.fieldSelectors=r.extend(h.prototype.fieldSelectors,m.prototype.fieldSelectors),y.prototype.showErrors=function(e){return delete e.assignmentOverrides,y.__super__.showErrors.call(this,e)},y.prototype.validateBeforeSave=function(e,t){var i;return t=this._validateTitle(e,t),t=this._validateSubmissionTypes(e,t),t=this._validateAllowedExtensions(e,t),t=this.assignmentGroupSelector.validateBeforeSave(e,t),("undefined"!=typeof ENV&&null!==ENV?ENV.IS_LARGE_ROSTER:void 0)||(t=this.groupCategorySelector.validateBeforeSave(e,t)),t=this._validatePointsPossible(e,t),t=this._validatePercentagePoints(e,t),i={assignment_overrides:this.dueDateOverrideView.getAllDates(e)},t=this.dueDateOverrideView.validateBeforeSave(i,t)},y.prototype._validateTitle=function(e,t){var i;return i=r.contains(this.model.frozenAttributes(),"title"),i||e.name&&0!==a.trim(e.name.toString()).length||(t.name=[{message:n.t("name_is_required","Name is required!")}]),t},y.prototype._validateSubmissionTypes=function(e,t){return"online"===e.submission_type&&0===e.submission_types.length&&(t["online_submission_types[online_text_entry]"]=[{message:n.t("at_least_one_submission_type","Please choose at least one submission type")}]),t},y.prototype._validateAllowedExtensions=function(e,t){return e.allowed_extensions&&0===e.allowed_extensions.length&&(t.allowed_extensions=[{message:n.t("at_least_one_file_type","Please specify at least one allowed file type")}]),t},y.prototype._validatePointsPossible=function(e,t){var i;return i=r.contains(this.model.frozenAttributes(),"points_possible"),!i&&e.points_possible&&isNaN(parseFloat(e.points_possible))&&(t.points_possible=[{message:n.t("points_possible_number","Points possible must be a number")}]),t},y.prototype._validatePercentagePoints=function(e,t){return"percent"!==e.grading_type||"0"!==e.points_possible&&!isNaN(parseFloat(e.points_possible))||(t.points_possible=[{message:n.t("percentage_points_possible","Points possible must be more than 0 for percentage grading")}]),t},y}(o)})}).call(this);