(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var s in n)t.call(n,s)&&(e[s]=n[s]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};define(["i18n!assignments","compiled/views/KeyboardNavDialog","jst/KeyboardNavDialog","jquery","underscore","Backbone","jst/assignments/IndexView","jst/assignments/NoAssignmentsSearch","compiled/views/assignments/AssignmentKeyBindingsMixin"],function(t,i,s,r,o,u,a,c,h){var l,p;return l=function(t){function l(){return this.filterKeyBindings=e(this.filterKeyBindings,this),this.focusOnAssignments=e(this.focusOnAssignments,this),this.filterResults=e(this.filterResults,this),p=l.__super__.constructor.apply(this,arguments)}return n(l,t),l.mixin(h),l.prototype.template=a,l.prototype.el="#content",l.child("assignmentGroupsView","[data-view=assignmentGroups]"),l.child("createGroupView","[data-view=createGroup]"),l.child("assignmentSettingsView","[data-view=assignmentSettings]"),l.child("showByView","[data-view=showBy]"),l.prototype.events={"keyup #search_term":"search"},l.prototype.els={"#addGroup":"$addGroupButton","#assignmentSettingsCog":"$assignmentSettingsButton"},l.prototype.initialize=function(){return l.__super__.initialize.apply(this,arguments),this.collection.once("reset",this.enableSearch,this),this.collection.on("cancelSearch",this.clearSearch,this)},l.prototype.afterRender=function(){return this.createGroupView&&(this.createGroupView.hide(),this.createGroupView.setTrigger(this.$addGroupButton)),this.assignmentSettingsView&&(this.assignmentSettingsView.hide(),this.assignmentSettingsView.setTrigger(this.$assignmentSettingsButton)),this.userIsStudent()&&this.filterKeyBindings(),this.ensureContentStyle(),this.kbDialog=(new i).render(s({keyBindings:this.keyBindings})),window.onkeydown=this.focusOnAssignments},l.prototype.enableSearch=function(){return this.$("#search_term").prop("disabled",!1)},l.prototype.clearSearch=function(){return this.$("#search_term").val(""),this.filterResults()},l.prototype.search=o.debounce(function(){return this.filterResults()},200),l.prototype.filterResults=function(){var e,t,n,i;if(n=r("#search_term").val(),""===n){if(this.collection.each(function(e){return e.groupView.endSearch()}),null!=this.noAssignments)return this.noAssignments.remove(),this.noAssignments=null}else if(t=new RegExp(this.cleanSearchTerm(n),"ig"),e=!1,this.collection.each(function(n){return n.groupView.search(t)?e=!0:void 0}),e){if(null!=this.noAssignments)return this.noAssignments.remove(),this.noAssignments=null}else if(!this.noAssignments)return this.noAssignments=new u.View({template:c,tagName:"li",className:"item-group-condensed"}),i=this.assignmentGroupsView.$el.children(".collectionViewItems"),i.append(this.noAssignments.render().el)},l.prototype.cleanSearchTerm=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},l.prototype.focusOnAssignments=function(e){return 74!==e.keyCode||r(e.target).is("input")?void 0:r(".assignment_group").filter(":visible").first().attr("tabindex",-1).focus()},l.prototype.userIsStudent=function(){return o.include(ENV.current_user_roles,"student")},l.prototype.ensureContentStyle=function(){return-1===window.location.href.indexOf("assignments")?r("#content").css("padding","0em"):void 0},l.prototype.filterKeyBindings=function(){return this.keyBindings=this.keyBindings.filter(function(e){return!o.contains([69,68,65],e.keyCode)})},l}(u.View)})}).call(this);