(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function o(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return o.prototype=i.prototype,e.prototype=new o,e.__super__=i.prototype,e};define(["i18n!quizzes","jquery","compiled/views/DialogFormView","jst/messageStudentsDialog","jst/EmptyDialogFormWrapper","compiled/models/Conversation","jst/_messageStudentsWhoRecipientList","underscore","compiled/jquery/serializeForm"],function(t,o,r,s,n,p,a,c){var u,l;return u=function(u){function m(){return this.updateListOfRecipients=e(this.updateListOfRecipients,this),this.getFormData=e(this.getFormData,this),this._findRecipientGroupByName=e(this._findRecipientGroupByName,this),this.validateBeforeSave=e(this.validateBeforeSave,this),this.toJSON=e(this.toJSON,this),l=m.__super__.constructor.apply(this,arguments)}return i(m,u),m.optionProperty("recipientGroups"),m.optionProperty("context"),m.prototype.template=s,m.prototype.wrapperTemplate=n,m.prototype.className="validated-form-view form-dialog",m.prototype.defaults={height:500,width:500},m.prototype.els={"[name=recipientGroupName]":"$recipientGroupName","#message-recipients":"$messageRecipients","[name=body]":"$messageBody"},m.prototype.events=c.extend({},r.prototype.events,{"change [name=recipientGroupName]":"updateListOfRecipients","click .dialog_closer":"close",dialogclose:"close"}),m.prototype.initialize=function(){return m.__super__.initialize.apply(this,arguments),this.options.title=this.context?t.t("message_students_for_context","Message students for %{context}",{context:this.context}):t.t("message_students","Message students"),this.recipients=this.recipientGroups[0].recipients,this.model||(this.model=new p)},m.prototype.toJSON=function(){var e,t,i,o,r;for(e={},r=["title","recipients","recipientGroups"],i=0,o=r.length;o>i;i++)t=r[i],e[t]=this[t];return e},m.prototype.validateBeforeSave=function(e,t){var i;return i=this.model.validate(e),i&&(i.body&&(t.body=i.body),i.recipients&&(t.recipientGroupName=i.recipients)),t},m.prototype._findRecipientGroupByName=function(e){return c.detect(this.recipientGroups,function(t){return t.name===e})},m.prototype.getFormData=function(){var e,t,i,o;return o=this.$el.toJSON(),t=o.recipientGroupName,e=o.body,i=this._findRecipientGroupByName(t).recipients,{body:e,recipients:c.pluck(i,"id")}},m.prototype.updateListOfRecipients=function(){var e,t;return e=this.$recipientGroupName.val(),t=this._findRecipientGroupByName(e).recipients,this.$messageRecipients.html(a({recipients:t}))},m.prototype.onSaveSuccess=function(){return this.close(),o.flashMessage(t.t("notices.message_sent","Message Sent!"))},m.prototype.close=function(){return m.__super__.close.apply(this,arguments),this.hideErrors(),this.remove()},m}(r)})}).call(this);