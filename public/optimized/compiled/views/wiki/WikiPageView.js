(function(){var e={}.hasOwnProperty,t=function(t,i){function o(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return o.prototype=i.prototype,t.prototype=new o,t.__super__=i.prototype,t};define(["jquery","timezone","underscore","Backbone","compiled/str/splitAssetString","jst/wiki/WikiPage","compiled/views/StickyHeaderMixin","compiled/views/wiki/WikiPageDeleteDialog","compiled/views/wiki/WikiPageReloadView","compiled/views/PublishButtonView","i18n!pages"],function(e,i,o,r,n,s,a,p,h,_,u){var l,c;return l=function(r){function n(){return c=n.__super__.constructor.apply(this,arguments)}return t(n,r),n.mixin(a),n.prototype.template=s,n.prototype.els={".publish-button":"$publishButton",".header-bar-outer-container":"$headerBarOuterContainer",".page-changed-alert":"$pageChangedAlert"},n.prototype.events={"click .delete_page":"deleteWikiPage"},n.optionProperty("modules_path"),n.optionProperty("wiki_pages_path"),n.optionProperty("wiki_page_edit_path"),n.optionProperty("wiki_page_history_path"),n.optionProperty("WIKI_RIGHTS"),n.optionProperty("PAGE_RIGHTS"),n.optionProperty("course_id"),n.optionProperty("course_home"),n.optionProperty("course_title"),n.prototype.initialize=function(){var e=this;return this.model.on("change",function(){return e.render()}),n.__super__.initialize.apply(this,arguments),this.WIKI_RIGHTS||(this.WIKI_RIGHTS={}),this.PAGE_RIGHTS||(this.PAGE_RIGHTS={})},n.prototype.render=function(){var t,i,o;return null!=(t=this.publishButtonView)&&t.$el.detach(),null!=(i=this.$sequenceFooter)&&i.detach(),n.__super__.render.apply(this,arguments),this.publishButtonView||(this.publishButtonView=new _({model:this.model}),this.model.view=this),this.publishButtonView.$el.appendTo(this.$publishButton),this.publishButtonView.render(),this.$sequenceFooter||this.course_home||!this.course_id?null!=(o=this.$sequenceFooter)&&o.msfAnimation(!1):(this.$sequenceFooter||(this.$sequenceFooter=e("<div></div>").hide()),this.$sequenceFooter.moduleSequenceFooter({courseID:this.course_id,assetType:"Page",assetID:this.model.get("url"),location:location})),this.$sequenceFooter?this.$sequenceFooter.appendTo(this.$el):void 0},n.prototype.afterRender=function(){var t=this;return n.__super__.afterRender.apply(this,arguments),this.reloadView=new h({el:this.$pageChangedAlert,model:this.model,reloadMessage:u.t("reload_viewing_page","This page has changed since you started viewing it. *Reload*",{wrapper:'<a class="reload" href="#">$1</a>'})}),this.reloadView.on("changed",function(){return t.$headerBarOuterContainer.addClass("page-changed")}),this.reloadView.on("reload",function(){return t.render()}),this.reloadView.pollForChanges(),e.publish("userContent/change")},n.prototype.deleteWikiPage=function(e){var t;return null!=e&&e.preventDefault(),this.model.get("deletable")?(t=new p({model:this.model,wiki_pages_path:this.wiki_pages_path}),t.open()):void 0},n.prototype.toJSON=function(){var t,r;return t=n.__super__.toJSON.apply(this,arguments),t.modules_path=this.modules_path,t.wiki_pages_path=this.wiki_pages_path,t.wiki_page_edit_path=this.wiki_page_edit_path,t.wiki_page_history_path=this.wiki_page_history_path,t.course_home=this.course_home,t.course_title=this.course_title,t.CAN={VIEW_PAGES:!!this.WIKI_RIGHTS.read,PUBLISH:!!this.WIKI_RIGHTS.manage&&"courses"===t.contextName,VIEW_UNPUBLISHED:!!this.WIKI_RIGHTS.manage||!!this.WIKI_RIGHTS.view_unpublished_items,UPDATE_CONTENT:!!this.PAGE_RIGHTS.update||!!this.PAGE_RIGHTS.update_content,DELETE:!!this.PAGE_RIGHTS["delete"]&&!this.course_home,READ_REVISIONS:!!this.PAGE_RIGHTS.read_revisions},t.CAN.ACCESS_GEAR_MENU=t.CAN.DELETE||t.CAN.READ_REVISIONS,t.CAN.VIEW_TOOLBAR=t.CAN.VIEW_PAGES||t.CAN.PUBLISH||t.CAN.UPDATE_CONTENT||t.CAN.ACCESS_GEAR_MENU,t.lock_info&&(t.lock_info=o.clone(t.lock_info)),(null!=(r=t.lock_info)?r.unlock_at:void 0)&&(t.lock_info.unlock_at=i.parse(t.lock_info.unlock_at)<new Date?null:e.datetimeString(t.lock_info.unlock_at)),t},n}(r.View)})}).call(this);