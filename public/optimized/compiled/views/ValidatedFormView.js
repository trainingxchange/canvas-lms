(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,r=function(t,r){function n(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t},n=[].slice;define(["Backbone","compiled/views/ValidatedMixin","jquery","underscore","compiled/fn/preventDefault","i18n!errors","jquery.toJSON","jquery.disableWhileLoading","jquery.instructure_forms"],function(e,o,i,a,s,u){var c,l;return c=function(e){function s(){return this.checkUnload=t(this.checkUnload,this),this.watchUnload=t(this.watchUnload,this),this.onSaveFail=t(this.onSaveFail,this),this.onSaveSuccess=t(this.onSaveSuccess,this),l=s.__super__.constructor.apply(this,arguments)}return r(s,e),s.mixin(o),s.prototype.tagName="form",s.prototype.className="validated-form-view",s.prototype.events={submit:"submit"},s.prototype.saveOpts={wait:!0},s.prototype.submit=function(t){var e,r,n,o;return null!=t&&t.preventDefault(),this.hideErrors(),e=this.getFormData(),n=this.validateBeforeSave(e,{}),0===a.keys(n).length?(r=new i.Deferred,o=this.saveFormData(e),o.then(this.onSaveSuccess,this.onSaveFail),o.fail(function(){return r.reject()}),this.dontRenableAfterSaveSuccess||o.done(function(){return r.resolve()}),this.$el.disableWhileLoading(r),this.trigger("submit"),o):(this.showErrors(n),null)},s.prototype.getFormData=function(){return this.$el.toJSON()},s.prototype.saveFormData=function(t){var e,r;return null==t&&(t=null),e=this.model,t||(t=this.getFormData()),r=this.saveOpts,e.save(t,r)},s.prototype.validate=function(t){var e,r;return null==t&&(t={}),t||(t={}),e=t.data||this.getFormData(),r=this.validateFormData(e,{}),this.hideErrors(),this.showErrors(r),0===r.length},s.prototype.validateFormData=function(){return{}},s.prototype.validateBeforeSave=function(t){return this.validateFormData(t)},s.prototype.hideErrors=function(){return this.$el.hideErrors()},s.prototype.onSaveSuccess=function(){return this.trigger.apply(this,["success"].concat(n.call(arguments)))},s.prototype.onSaveFail=function(t){var e;return e=this.parseErrorResponse(t),e||(e={}),this.showErrors(e),this.trigger.apply(this,["fail",e].concat(n.call(arguments)))},s.prototype.parseErrorResponse=function(t){var e;if(422===t.status)return{authenticity_token:"invalid"};try{return i.parseJSON(t.responseText).errors}catch(r){return e=r,{}}},s.prototype.translations={required:u.t("required","Required"),blank:u.t("blank","Required"),unsaved:u.t("unsaved_changes","You have unsaved changes.")},s.prototype.fieldSelectors=null,s.prototype.findField=function(t){var e,r,n;return r=(null!=(n=this.fieldSelectors)?n[t]:void 0)||"[name='"+t+"']",e=this.$(r),e.data("rich_text")&&(e=e.next(".mceEditor").find(".mceIframeContainer")),e.length>1&&(e=e.not("[type=hidden]")),e},s.prototype.castJSON=function(t){var e,r=this;return a.isObject(t)?null!=t.toJSON?t.toJSON():(e=a.clone(t),a.each(e,function(t,n){return e[n]=r.castJSON(t)}),e):t},s.prototype.original=null,s.prototype.watchUnload=function(){return this.original=this.castJSON(this.getFormData()),this.unwatchUnload(),i(window).on("beforeunload",this.checkUnload)},s.prototype.unwatchUnload=function(){return i(window).off("beforeunload",this.checkUnload)},s.prototype.checkUnload=function(){var t;return t=this.castJSON(this.getFormData()),a.isEqual(this.original,t)?void 0:this.translations.unsaved},s}(e.View)})}).call(this);