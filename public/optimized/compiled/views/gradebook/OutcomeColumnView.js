(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,r=function(t,r){function n(){this.constructor=t}for(var o in r)e.call(r,o)&&(t[o]=r[o]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};define(["i18n!gradebook2","underscore","Backbone","compiled/util/Popover","vendor/d3.v3","jst/gradebook2/outcome_popover"],function(e,n,o,i,a,s){var u,p,c;return p=o.View,u=function(e){function o(){return this.mouseleave=t(this.mouseleave,this),this.mouseenter=t(this.mouseenter,this),c=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.popover_template=s,o.optionProperty("totalsFn"),o.prototype.inside=!1,o.prototype.TIMEOUT_LENGTH=50,o.prototype.events={mouseenter:"mouseenter",mouseleave:"mouseleave"},o.prototype.createPopover=function(t){var e;return this.totalsFn(),this.pickColors(),e=new i(t,this.popover_template(this.attributes),{verticalSide:"bottom"}),e.el.on("mouseenter",this.mouseenter),e.el.on("mouseleave",this.mouseleave),this.renderChart(),e.show(t),e},o.prototype.mouseenter=function(t){return this.popover||(this.popover=this.createPopover(t)),this.inside=!0},o.prototype.mouseleave=function(){var t=this;return this.inside=!1,setTimeout(function(){return!t.inside&&t.popover?(t.popover.hide(),delete t.popover):void 0},this.TIMEOUT_LENGTH)},o.prototype.pickColors=function(){var t,e,r,o,i;return e=this.attributes.ratings,r=e.length-1,o=this.attributes.mastery_points,i=e.indexOf(n.find(e,function(t){return t.points===o})),t=a.scale.linear().domain([0,i,(i+r)/2,r]).range(["#416929","#8bab58","#e0d670","#dd5c5c"]),n.each(e,function(e,r){return e.color=t(r)})},o.prototype.renderChart=function(){return this.data=n.filter(this.attributes.ratings,function(t){return t.percent}),this.r=50,this.arc=a.svg.arc().outerRadius(this.r),this.arcs=this.renderArcs(),this.renderArcFills(),this.renderLabels(),this.renderLabelLines()},o.prototype.renderArcs=function(){var t,e,r,n,o;return o=160,e=150,n=a.select(".outcome-details .chart-image").append("svg:svg").data([this.data]).attr("width",o).attr("height",e).append("svg:g").attr("transform","translate("+o/2+", "+e/2+")"),r=a.layout.pie().value(function(t){return t.percent}),t=n.selectAll("g.slice").data(r).enter().append("svg:g").attr("class","slice")},o.prototype.renderArcFills=function(){var t,e,r,n,o=this;return e=10,r=a.interpolate(e,this.r),t=this.arc,n=function(e){return function(n){return t.outerRadius(r(n))(e)}},this.arc.outerRadius(e),this.arcs.append("svg:path").attr("fill",function(t,e){return o.data[e].color}).attr("d",this.arc).transition().duration(400).attrTween("d",n),this.arc.outerRadius(this.r)},o.prototype.renderLabels=function(){var t=this;return this.arcs.append("svg:text").attr("fill","#4F5F6E").attr("transform",function(e){var r;return r=t.getCentroid(e),r=n.map(r,function(t){return 2.3*t}),"translate("+r+")"}).attr("text-anchor",function(e){var r,n,o;return o=t.getAngleInfo(e),r=o.angle,n=o.distanceToPi,n<Math.PI/6?"middle":r>Math.PI?"end":"start"}).attr("dominant-baseline",function(e){var r,n,o,i;return i=t.getAngleInfo(e,o=!0),r=i.angle,n=i.distanceToPi,n<Math.PI/6?"middle":r>Math.PI?"hanging":"auto"}).text(function(e,r){return t.data[r].percent+"%"})},o.prototype.getAngleInfo=function(t,e){var r,n;return r=(t.endAngle+t.startAngle)/2,e&&(r=(r+Math.PI/2)%(2*Math.PI)),n=Math.abs((r+Math.PI/2)%Math.PI-Math.PI/2),{angle:r,distanceToPi:n}},o.prototype.renderLabelLines=function(){var t=this;return this.arcs.append("svg:path").attr("stroke","#000").attr("d",function(e){var r,o,i;return r=t.getCentroid(e),o=n.map(r,function(t){return 1.4*t}),i=n.map(r,function(t){return 2.2*t}),"M"+o[0]+" "+o[1]+" L"+i[0]+" "+i[1]})},o.prototype.getCentroid=function(t){return t.innerRadius=0,t.outerRadius=this.r,this.arc.centroid(t)},o}(p)})}).call(this);