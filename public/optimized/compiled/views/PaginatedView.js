(function(){var t={}.hasOwnProperty,i=function(i,n){function e(){this.constructor=i}for(var o in n)t.call(n,o)&&(i[o]=n[o]);return e.prototype=n.prototype,i.prototype=new e,i.__super__=n.prototype,i};define(["underscore","jquery","Backbone","jst/PaginatedView"],function(t,n,e,o){var r,a;return r=function(e){function r(){return a=r.__super__.constructor.apply(this,arguments)}return i(r,e),r.prototype.paginationLoaderTemplate=o,r.prototype.paginationScrollContainer=window,r.prototype.distanceTillFetchNextPage=100,r.prototype.initialize=function(t){var i;return i=r.__super__.initialize.call(this,t),this.fetchOptions=t.fetchOptions,this.startPaginationListener(),this.bindPaginationEvents(),i},r.prototype.render=function(){var t;return t=r.__super__.render.apply(this,arguments),this.collection.fetchingNextPage&&this.showPaginationLoader(),t},r.prototype.showPaginationLoader=function(){var t;return null==(t=this.$paginationLoader)&&(this.$paginationLoader=n(this.paginationLoaderTemplate())),this.placePaginationLoader()},r.prototype.placePaginationLoader=function(){var t;return null!=(t=this.$paginationLoader)?t.insertAfter(this.el):void 0},r.prototype.hidePaginationLoader=function(){var t;return null!=(t=this.$paginationLoader)?t.remove():void 0},r.prototype.distanceToBottom=function(){var t,i;return t=n(this.paginationScrollContainer),i=t[0]===window?n(document).height():t[0].scrollHeight,i-t.scrollTop()-t.height()},r.prototype.startPaginationListener=function(){return n(this.paginationScrollContainer).on("scroll.pagination"+this.cid+", resize.pagination"+this.cid,n.proxy(this.fetchNextPageIfNeeded,this)),this.fetchNextPageIfNeeded()},r.prototype.stopPaginationListener=function(){return n(this.paginationScrollContainer).off(".pagination"+this.cid)},r.prototype.fetchNextPageIfNeeded=function(){var i=this;return setTimeout(function(){return i.collection.fetchingNextPage?void 0:i.collection.urls&&i.collection.urls.next?n(i.paginationScrollContainer).is(":visible")&&i.distanceToBottom()<i.distanceTillFetchNextPage?i.collection.fetch(t.extend({page:"next"},i.fetchOptions)):void 0:void(i.collection.length&&i.stopPaginationListener())},0)},r.prototype.bindPaginationEvents=function(){return this.collection.on("beforeFetch:next",this.showPaginationLoader,this),this.collection.on("fetch:next",this.hidePaginationLoader,this),this.collection.on("all",this.fetchNextPageIfNeeded,this)},r}(e.View)})}).call(this);