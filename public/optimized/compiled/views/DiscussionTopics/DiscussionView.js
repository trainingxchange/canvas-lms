(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function o(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return o.prototype=i.prototype,e.prototype=new o,e.__super__=i.prototype,e};define(["i18n!discussions","jquery","underscore","Backbone","jst/DiscussionTopics/discussion","compiled/views/PublishIconView","compiled/views/ToggleableSubscriptionIconView","compiled/views/MoveDialogView"],function(t,o,s,n,r,l,u,d){var c,p,h;return p=n.View,c=function(n){function c(){return this.renderPublishChange=e(this.renderPublishChange,this),this.hide=e(this.hide,this),this.togglePinned=e(this.togglePinned,this),this.previousDiscussionInGroup=e(this.previousDiscussionInGroup,this),this.goToPrevItem=e(this.goToPrevItem,this),this.onDelete=e(this.onDelete,this),this.toggleLocked=e(this.toggleLocked,this),h=c.__super__.constructor.apply(this,arguments)}return i(c,n),c.prototype.template=r,c.prototype.tagName="li",c.prototype.className="discussion",c.prototype.messages={confirm:t.t("confirm_delete_discussion_topic","Are you sure you want to delete this discussion topic?"),"delete":t.t("delete","Delete"),user_subscribed:t.t("subscribed_hint","You are subscribed to this topic. Click to unsubscribe."),user_unsubscribed:t.t("unsubscribed_hint","You are not subscribed to this topic. Click to subscribe.")},c.prototype.events={"click .icon-lock":"toggleLocked","click .icon-pin":"togglePinned","click .icon-trash":"onDelete",click:"onClick"},c.prototype.defaults={pinnable:!1},c.prototype.els={".screenreader-only":"$title",".discussion-row":"$row",".move_item":"$moveItemButton",".discussion-actions .al-trigger":"$gearButton"},c.optionProperty("lockable"),c.optionProperty("pinnable"),ENV.permissions.publish&&c.child("publishIcon","[data-view=publishIcon]"),c.child("toggleableSubscriptionIcon","[data-view=toggleableSubscriptionIcon]"),c.prototype.initialize=function(e){return this.attachModel(),ENV.permissions.publish&&(e.publishIcon=new l({model:this.model})),e.toggleableSubscriptionIcon=new u({model:this.model}),this.moveItemView=new d({model:this.model,nested:!0,closeTarget:this.$el.find("a[id=manage_link]"),saveURL:function(){return this.model.collection.reorderURL()}}),c.__super__.initialize.apply(this,arguments)},c.prototype.render=function(){return c.__super__.render.apply(this,arguments),this.$el.attr("data-id",this.model.get("id")),this.moveItemView.setTrigger(this.$moveItemButton),this},c.prototype.toggleLocked=function(e){var t,i;return e.preventDefault(),t=!this.model.get("locked"),i=t?!1:this.model.get("pinned"),this.model.updateBucket({locked:t,pinned:i}),this.render(),this.$gearButton.focus()},c.prototype.onDelete=function(e){return e.preventDefault(),confirm(this.messages.confirm)?(this.goToPrevItem(),this["delete"]()):this.$el.find("a[id=manage_link]").focus()},c.prototype["delete"]=function(){return this.model.destroy(),this.$el.remove()},c.prototype.goToPrevItem=function(){return null!=this.previousDiscussionInGroup()?o("#"+this.previousDiscussionInGroup().id+"_discussion_content").attr("tabindex",-1).focus():this.model.get("pinned")?o(".pinned&.discussion-list").attr("tabindex",-1).focus():this.model.get("locked")?o(".locked&.discussion-list").attr("tabindex",-1).focus():o(".open&.discussion-list").attr("tabindex",-1).focus()},c.prototype.previousDiscussionInGroup=function(){var e;return e=this.model.collection.models.indexOf(this.model),this.model.collection.models[e-1]},c.prototype.togglePinned=function(e){return e.preventDefault(),this.model.updateBucket({pinned:!this.model.get("pinned")})},c.prototype.onClick=function(e){return this.model.get("preventClick")||s.contains(["A","I"],e.target.nodeName)?void 0:window.location=this.model.get("html_url")},c.prototype.hide=function(){return this.$el.toggle(!this.model.get("hidden"))},c.prototype.toJSON=function(){var e;return e=s.extend(this.model.toJSON(),this.options),this.model.get("locked")&&!s.intersection(ENV.current_user_roles,["teacher","ta","admin"]).length&&(e.permissions["delete"]=!1),e.display_last_reply_at=t.l("#date.formats.medium",e.last_reply_at),e.ENV=ENV,e},c.prototype.renderPublishChange=function(){var e;return null!=(e=this.publishIcon)&&e.render(),ENV.permissions.publish?this.model.get("published")?(this.$row.removeClass("discussion-unpublished"),this.$row.addClass("discussion-published")):(this.$row.removeClass("discussion-published"),this.$row.addClass("discussion-unpublished")):void 0},c.prototype.attachModel=function(){return this.model.on("change:hidden",this.hide),this.model.on("change:published",this.renderPublishChange)},c}(p)})}).call(this);