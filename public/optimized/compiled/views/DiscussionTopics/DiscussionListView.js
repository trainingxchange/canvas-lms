(function(){var t=function(t,o){return function(){return t.apply(o,arguments)}},o={}.hasOwnProperty,e=function(t,e){function i(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};define(["jquery","underscore","compiled/views/CollectionView","jst/DiscussionTopics/discussionList","compiled/views/DiscussionTopics/DiscussionView","jqueryui/draggable","jqueryui/sortable"],function(o,i,n,r,s){var p,a;return p=function(n){function p(){return this._onDrop=t(this._onDrop,this),this._updateSort=t(this._updateSort,this),this._onFetchedLast=t(this._onFetchedLast,this),this._toggleNoContentMessage=t(this._toggleNoContentMessage,this),this.renderItem=t(this.renderItem,this),a=p.__super__.constructor.apply(this,arguments)}return e(p,n),p.prototype.template=r,p.prototype.itemView=s,p.prototype.defaults={showSpinner:!0,showMessage:!1,sortable:!1},p.optionProperty("showSpinner"),p.optionProperty("showMessage"),p.optionProperty("title"),p.optionProperty("listId"),p.optionProperty("sortable"),p.optionProperty("draggable"),p.optionProperty("destination"),p.prototype.spinnerOptions={color:"#333",length:5,radius:6,width:2},p.prototype.sortOptions={tolerance:"pointer"},p.prototype.dragOptions={helper:"clone",opacity:.75,revert:"invalid",revertDuration:0,zIndex:100},p.prototype.dropOptions={activeClass:"droppable",hoverClass:"droppable-hover",tolerance:"pointer"},p.prototype.events={"click .al-trigger":"onAdminClick"},p.prototype.render=function(){return p.__super__.render.apply(this,arguments),this._cacheElements(),this._toggleNoContentMessage(),this.options.sortable&&this._initSort(),this.$el.data("view")||this.$el.data("view",this),this.options.showSpinner?this._startLoader():this._stopLoader(),this},p.prototype.renderItem=function(t){return p.__super__.renderItem.apply(this,arguments),this.options.draggable?this._initDrag(t.view):void 0},p.prototype.isEmpty=function(){return this.collection.isEmpty()||this.collection.all(function(t){return t.get("hidden")})},p.prototype.toJSON=function(){return i.extend({},ENV,this.options)},p.prototype.attachCollection=function(){return this.collection.on("change:hidden",this._toggleNoContentMessage),this.collection.on("fetched:last",this._onFetchedLast),p.__super__.attachCollection.apply(this,arguments)},p.prototype.onAdminClick=function(t){return t.preventDefault()},p.prototype._startLoader=function(){var t;return t=new Spinner(this.spinnerOptions),t.spin(this.$loader.show()[0])},p.prototype._stopLoader=function(){return this.$loader.empty().hide()},p.prototype._cacheElements=function(){return this.$loader=this.$el.find(".loader"),this.$noContent=this.$el.find(".no-content")},p.prototype._toggleNoContentMessage=function(){return this.options.showMessage?this.$noContent.toggle(this.isEmpty()):void 0},p.prototype._onFetchedLast=function(){return this.options.showSpinner=!1,this.options.showMessage=!0,this._stopLoader(),this._toggleNoContentMessage(),this.collection.reset(this.collection.models)},p.prototype._initSort=function(){return ENV.permissions.moderate?(this.$list.sortable(i.extend({},this.sortOptions)),this.$list.on("sortupdate",this._updateSort),o(this.options.destination).droppable(i.extend({},this.dropOptions)).on("drop",this._onDrop)):void 0},p.prototype._updateSort=function(t,o){var e,i;return e=this.collection.get(o.item.data("id")),(null!=e?e.get("pinned"):void 0)?(i=o.item.index(),this.collection.remove(e),this.collection.add(e,{at:i}),this.collection.reorder(),e.set("preventClick",!0),setTimeout(function(){return e.set("preventClick",!1)},0)):void 0},p.prototype._initDrag=function(t){if(!this.options.destination)throw new Error("must have destination");if(ENV.permissions.moderate)return t.$el.draggable(i.extend({},this.dragOptions)),o(this.options.destination).droppable(i.extend({},this.dropOptions)).on("drop",this._onDrop)},p.prototype._onDrop=function(t,e){var i,n,r,s,p,a;return(r=this.collection.get(e.draggable.data("id")))?(a=[o(t.currentTarget).data("view"),this],s=a[0],i=a[1],p=!!s.options.pinned,n=!!s.options.locked,r.updateBucket({pinned:p,locked:n})):void 0},p}(n)})}).call(this);