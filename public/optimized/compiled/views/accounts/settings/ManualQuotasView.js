(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,o=function(t,o){function i(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return i.prototype=o.prototype,t.prototype=new i,t.__super__=o.prototype,t};define(["jquery","i18n!accounts","compiled/models/Course","compiled/models/Group","compiled/views/ValidatedFormView","str/htmlEscape","jst/accounts/settings/ManualQuotas","compiled/jquery.rails_flash_notifications"],function(e,i,r,s,n,a,u){var p,l;return p=function(n){function p(){return this.findSuccess=t(this.findSuccess,this),this.findError=t(this.findError,this),l=p.__super__.constructor.apply(this,arguments)}return o(p,n),p.prototype.template=u,p.INTEGER_REGEX=/^[+-]?\d+$/,p.prototype.tag="form",p.prototype.id="manual-quotas",p.prototype.className="form-horizontal",p.prototype.els={"#manual_quotas_type":"$type","#manual_quotas_id":"$id","#manual_quotas_quota":"$quota","#manual_quotas_result":"$result","#manual_quotas_link":"$link"},p.prototype.fields=["type","id","quota"],p.prototype.integerFields=["id","quota"],p.prototype.initialize=function(){return this.events||(this.events=[]),this.events["input #manual_quotas_id"]="validate",this.events["input #manual_quotas_quota"]="validate",this.events["click #manual_quotas_find_button"]="findItem",this.on("success",this.submitSuccess),this.on("fail",this.submitFail),p.__super__.initialize.apply(this,arguments)},p.prototype.afterRender=function(){var t=this;return this.$id.keypress(function(o){return o.keyCode===e.ui.keyCode.ENTER?t.findItem():void 0}),this.$result.hide()},p.prototype.submitSuccess=function(){return e.flashMessage(i.t("quota_updated","Quota updated"))},p.prototype.submitFail=function(){return e.flashError(i.t("quota_not_updated","Quota was not updated"))},p.prototype.getFormData=function(){var t,e,o,i,r;for(t={},r=this.fields,o=0,i=r.length;i>o;o++)e=r[o],t[e]=this["$"+e].val();return t},p.prototype.saveFormData=function(){return this.model.save({storage_quota_mb:this.$quota.val()},this.saveOpts)},p.prototype.validateFormData=function(t){var e,o,r,s,n;for(e={},n=this.integerFields,r=0,s=n.length;s>r;r++)o=n[r],""===t[o]||t[o].match(this.constructor.INTEGER_REGEX)||(e[o]=[{type:"integer_required",message:i.t("integer_required","An integer value is required")}]);return e},p.prototype.validateBeforeSave=function(){return{}},p.prototype.hideErrors=function(){var t;return t=this.$("div.control-group.error"),t.removeClass("error"),t.find(".help-inline").remove()},p.prototype.showErrors=function(t){var o,i,r,s,n,u,p,l,d;for(l=this.integerFields,d=[],u=0,p=l.length;p>u;u++)r=l[u],o=this["$"+r].closest("div.control-group"),n=t[r],o.toggleClass("error",null!=n),n?(i=e('<span class="help-inline"></span>'),i.html(function(){var t,e,o;for(o=[],t=0,e=n.length;e>t;t++)s=n[t].message,o.push(a(s));return o}().join("<br/>")),d.push(o.find(".controls").append(i))):d.push(void 0);return d},p.prototype.findItem=function(){var t,o,n;return this.hideErrors(),t=this.getFormData(),this.model=null,"course"===t.type?(this.model=new r({id:t.id}),o="/courses",n=i.t("course_type","course")):"group"===t.type&&(this.model=new s({id:t.id}),o="/groups",n=i.t("group_type","group")),this.model?(this.model.urlRoot="/api/v1"+o,this.model.path=o,this.model.type=n,this.disablingDfd=new e.Deferred,this.$result.hide(),this.$el.disableWhileLoading(this.disablingDfd),this.model.fetch({error:this.findError,success:this.findSuccess})):void 0},p.prototype.findError=function(t,e){var o;return this.disablingDfd.reject(),this.hideErrors(),o=401===e.status?{id:[{type:"not_authorized",message:i.t("find_not_authorized","You are not authorized to access that %{type}",{type:t.type})}]}:{id:[{type:"not_found",message:i.t("find_not_found","Could not find a %{type} with that ID",{type:t.type})}]},this.showErrors(o)},p.prototype.findSuccess=function(){return this.$link.html(this.model.get("name")),this.$link.attr("href",this.model.path+"/"+this.model.get("id")),this.$quota.val(this.model.get("storage_quota_mb")),this.$result.show(),this.disablingDfd.resolve()},p}(n)})}).call(this);