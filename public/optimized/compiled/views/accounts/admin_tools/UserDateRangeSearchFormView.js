(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,r=function(t,r){function i(){this.constructor=t}for(var s in r)e.call(r,s)&&(t[s]=r[s]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t};define(["Backbone","jquery","i18n!user_date_range_search","jst/accounts/admin_tools/userDateRangeSearchForm","compiled/views/ValidatedMixin","jquery.ajaxJSON","jquery.instructure_date_and_time"],function(e,i,s,n,o){var a,l;return a=function(a){function c(){return this.selectUser=t(this.selectUser,this),this.fetchUsers=t(this.fetchUsers,this),l=c.__super__.constructor.apply(this,arguments)}return r(c,a),c.mixin(o),c.child("inputFilterView","[data-view=inputFilter]"),c.child("usersView","[data-view=users]"),c.prototype.tagName="form",c.prototype.template=n,c.prototype.events={submit:"submit"},c.prototype.els={".userIdField":"$userIdField",".dateStartSearchField":"$dateStartSearchField",".dateEndSearchField":"$dateEndSearchField",".search-controls":"$searchControls"},c.optionProperty("formName"),c.prototype.toJSON=function(){return this.options},c.prototype.initialize=function(t){return this.model=new e.Model,c.__super__.initialize.call(this,t)},c.prototype.afterRender=function(){return this.$dateStartSearchField.datetime_field(),this.$dateEndSearchField.datetime_field(),this.$searchControls.hide()},c.prototype.attach=function(){return this.inputFilterView.collection.on("setParam deleteParam",this.fetchUsers),this.usersView.collection.on("selectedModelChange",this.selectUser)},c.prototype.fetchUsers=function(){var t;return this.selectUser(null),null!=(t=this.lastRequest)&&t.abort(),this.lastRequest=this.inputFilterView.collection.fetch()},c.prototype.selectUser=function(t){return this.usersView.$el.find("tr").each(function(){return i(this).removeClass("selected")}),t?(this.model.set(t.attributes),this.$userIdField.val(t.get("id")),this.$searchControls.show()):(this.$userIdField.val(""),this.$searchControls.hide())},c.prototype.validityCheck=function(){var t,e,r;return e=this.$el.toJSON(),r=!0,t={},e.user_id||(r=!1,t.user_id=[{type:"required",message:s.t("cant_be_blank","Canvas User ID can't be blank")}]),e.start_time&&e.end_time&&e.start_time>e.end_time&&(r=!1,t.end_time=[{type:"invalid",message:s.t("cant_come_before_from","'To Date' can't come before 'From Date'")}]),this.showErrors(t),r},c.prototype.submit=function(t){return t.preventDefault(),this.validityCheck()?this.updateCollection():void 0},c.prototype.updateCollection=function(){var t;return t=this.$el.toJSON(),delete t.search_term,t.start_time||(t.start_time=""),t.end_time||(t.end_time=""),this.collection.setParams(t)},c}(e.View)})}).call(this);