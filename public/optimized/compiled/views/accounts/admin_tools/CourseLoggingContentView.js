(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,o=function(e,o){function i(){this.constructor=e}for(var s in o)t.call(o,s)&&(e[s]=o[s]);return i.prototype=o.prototype,e.prototype=new i,e.__super__=o.prototype,e};define(["Backbone","jquery","compiled/views/PaginatedCollectionView","compiled/views/accounts/admin_tools/DateRangeSearchView","compiled/views/accounts/admin_tools/AutocompleteView","compiled/views/ValidatedMixin","compiled/views/accounts/admin_tools/CourseLoggingItemView","compiled/collections/CourseLoggingCollection","compiled/collections/CourseCollection","jst/accounts/admin_tools/courseLoggingContent","jst/accounts/admin_tools/courseLoggingResults","jst/accounts/admin_tools/courseLoggingDetails","jqueryui/dialog"],function(t,i,s,r,n,l,c,a,u,d,h,p){var m;return m=function(u){function m(o){this.options=o,this.onFail=e(this.onFail,this),this.fetch=e(this.fetch,this),this.collection=new a,m.__super__.constructor.apply(this,arguments),this.dateRangeSearch=new r({name:"courseLogging"}),this.courseSearch=new n({collection:new t.Collection(null,{resourceName:"courses"}),labelProperty:i.proxy(this.autoCompleteItemLabel,this),fieldName:"course_id",placeholder:"Course",sourceParameters:{"state[]":"all"}}),this.resultsView=new s({template:h,itemView:c,collection:this.collection})}return o(m,u),m.mixin(l),m.child("resultsView","#courseLoggingSearchResults"),m.child("dateRangeSearch","#courseDateRangeSearch"),m.child("courseSearch","#courseCourseSearch"),m.prototype.els={"#courseLoggingForm":"$form"},m.prototype.template=d,m.prototype.detailsTemplate=p,m.prototype.events={"submit #courseLoggingForm":"onSubmit","click #courseLoggingSearchResults .courseLoggingDetails > a":"showDetails"},m.prototype.onSubmit=function(e){var t;return e.preventDefault(),t=this.$form.toJSON(),this.validate(t)?this.updateCollection(t):void 0},m.prototype.showDetails=function(e){var t,o,s,r,n;return e.preventDefault(),t=i(e.target),s=t.data("id"),r=this.collection.get(s),null==r?void console.warn("Could not find model for event "+s+"."):(n=r.get("event_type"),null==n?void console.warn("Could not find type for event "+s+"."):(this.dialog=i('<div class="use-css-transitions-for-show-hide" style="padding:0;"/>'),this.dialog.html(this.detailsTemplate(r.present())),o={title:"Event Details",width:600,resizable:!0},this.dialog.dialog(o)))},m.prototype.updateCollection=function(e){var t;return e||(e=this.$form.toJSON()),t={id:null,type:null,start_time:"",end_time:""},e.start_time&&(t.start_time=e.start_time),e.end_time&&(t.end_time=e.end_time),e.course_id&&(t.id=e.course_id),this.collection.setParams(t)},m.prototype.validate=function(e){var t;return e||(e=this.$form.toJSON()),delete e.course_submit,t=this.dateRangeSearch.validate(e)||{},e.course_id||(e.course_id=this.$el.find("#course_id-autocompleteField").val()),e.course_id||(t.course_submit=[{type:"required",message:"A valid Course is required to search events."}]),this.showErrors(t),i.isEmptyObject(t)},m.prototype.attach=function(){return this.collection.on("setParams",this.fetch)},m.prototype.fetch=function(){return this.collection.fetch().fail(this.onFail)},m.prototype.onFail=function(e){var t;return this.collection.reset(),this.resultsView.detachScroll(),this.resultsView.$el.find(".paginatedLoadingIndicator").fadeOut(),null==(null!=e?e.status:void 0)||404!==e.status||(t={},t.course_submit=[{type:"required",message:"A course with that ID could not be found for this account."}],i.isEmptyObject(t))?void 0:this.showErrors(t)},m.prototype.autoCompleteItemLabel=function(e){var t,o;return o=e.get("name"),t=e.get("course_code"),""+e.id+" - "+o+" - "+t},m}(t.View)})}).call(this);