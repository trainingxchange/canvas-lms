(function(){var t=function(t,o){return function(){return t.apply(o,arguments)}},o={}.hasOwnProperty,i=function(t,i){function e(){this.constructor=t}for(var n in i)o.call(i,n)&&(t[n]=i[n]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t};define(["jquery","underscore","compiled/views/CollectionView","jst/paginatedCollection"],function(o,e,n,r){var l,c;return l=function(l){function s(){return this.showLoadingIndicator=t(this.showLoadingIndicator,this),this.hideLoadingIndicator=t(this.hideLoadingIndicator,this),this.checkScroll=t(this.checkScroll,this),this.detachScroll=t(this.detachScroll,this),this.attachScroll=t(this.attachScroll,this),c=s.__super__.constructor.apply(this,arguments)}return i(s,l),s.prototype.defaults={buffer:500,scrollContainer:window},s.prototype.els=e.extend({},n.prototype.els,{".paginatedLoadingIndicator":"$loadingIndicator"}),s.optionProperty("scrollableElement"),s.optionProperty("scrollContainer"),s.optionProperty("autoFetch"),s.prototype.template=r,s.prototype.initialize=function(){return s.__super__.initialize.apply(this,arguments),this.initScrollContainer()},s.prototype.attachCollection=function(){var t=this;return s.__super__.attachCollection.apply(this,arguments),this.listenTo(this.collection,"reset",this.attachScroll),this.listenTo(this.collection,"fetched:last",this.detachScroll),this.listenTo(this.collection,"beforeFetch",this.showLoadingIndicator),this.autoFetch?this.listenTo(this.collection,"fetch",function(){return setTimeout(t.checkScroll)}):this.listenTo(this.collection,"fetch",this.hideLoadingIndicator)},s.prototype.initScrollContainer=function(){return this.$scrollableElement=this.scrollableElement?o(this.scrollableElement):this.$el,this.scrollContainer=o(this.scrollContainer),this.heightContainer=this.scrollContainer[0]===window?o(document.body):this.scrollContainer},s.prototype.attachScroll=function(){var t,o;return o="scroll.pagination:"+this.cid,t="resize.pagination:"+this.cid,this.scrollContainer.on(o,this.checkScroll),this.scrollContainer.on(t,this.checkScroll)},s.prototype.detachScroll=function(){return this.scrollContainer.off(".pagination:"+this.cid)},s.prototype.checkScroll=function(){var t,o;if(!this.collection.fetchingPage&&!this.collection.fetchingNextPage&&this.$el.length)return o=this.$scrollableElement.position().top+this.$scrollableElement.height()-this.heightContainer.position().top,t=o-this.scrollContainer.scrollTop()-this.scrollContainer.height(),t<this.options.buffer&&this.collection.canFetch("next")?this.collection.fetch({page:"next"}):this.hideLoadingIndicator()},s.prototype.remove=function(){return this.detachScroll(),s.__super__.remove.apply(this,arguments)},s.prototype.afterRender=function(){return s.__super__.afterRender.apply(this,arguments),this.collection.fetchingPage?void 0:this.hideLoadingIndicator()},s.prototype.hideLoadingIndicator=function(){var t;return null!=(t=this.$loadingIndicator)?t.hide():void 0},s.prototype.showLoadingIndicator=function(){var t;return null!=(t=this.$loadingIndicator)?t.show():void 0},s}(n)})}).call(this);