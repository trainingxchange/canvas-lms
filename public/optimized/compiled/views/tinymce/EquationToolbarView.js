(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,a=function(t,a){function r(){this.constructor=t}for(var n in a)e.call(a,n)&&(t[n]=a[n]);return r.prototype=a.prototype,t.prototype=new r,t.__super__=a.prototype,t};define(["i18n!editor","jquery","Backbone","jst/tinymce/EquationToolbarView","mathquill"],function(e,r,n,i){var l,o;return l=function(e){function n(){return this.addMathJaxEvents=t(this.addMathJaxEvents,this),o=n.__super__.constructor.apply(this,arguments)}return a(n,e),n.prototype.template=i,n.prototype.els={"#mathjax-view .mathquill-toolbar":"$toolbar","#mathjax-editor":"$matheditor"},n.prototype.render=function(){var t;return this.cacheEls(),this.$toolbar.append(this.template()),t=r("#mathjax-view .mathquill-tab-bar li a"),t.click(function(e){return e.preventDefault(),r("#mathjax-view .mathquill-tab-bar li").removeClass("mathquill-tab-selected"),t.attr("aria-selected","false").attr("tabindex","-1"),r("#mathjax-view .mathquill-tab-pane").removeClass("mathquill-tab-pane-selected"),r(this).parent().addClass("mathquill-tab-selected"),r(this).attr("aria-selected","true").attr("tabindex",0).focus(),r(this.href.replace(/.*#/,"#")).addClass("mathquill-tab-pane-selected")}).keydown(function(e){var a,n;switch(e.keyCode){case 37:a="l";break;case 39:a="r";break;default:return!0}return e.preventDefault(),n=t.index(this),n===t.length-1&&"r"===a&&(n=-1),"r"===a?n++:n--,r(t.get(n)).focus().click()}),r("#mathjax-view .mathquill-tab-bar li:first-child").addClass("mathquill-tab-selected"),r.getScript("//cdn.mathjax.org/mathjax/2.1-latest/MathJax.js?config=TeX-AMS_HTML.js",this.addMathJaxEvents)},n.prototype.addMathJaxEvents=function(){var t;return t=function(){var t,e;return t=MathJax.Hub.getAllJax("mathjax-preview")[0],t?(e=r("#mathjax-editor").val(),MathJax.Hub.Queue(["Text",t,e])):void 0},r("#mathjax-view a.mathquill-rendered-math").mousedown(function(t){return t.stopPropagation()}).click(function(e){var a,n,i,l,o;return e.preventDefault(),l=this.title+" ",a=document.getElementById("mathjax-editor"),document.selection?(i=document.selection.createRange(),i.text=l):a.selectionStart||"0"===a.selectionStart?(n=a.selectionStart,e=a.selectionEnd,o=a.value,a.value=o.substring(0,n)+l+o.substring(e,o.length)):a.value+=l,r(a).focus(),t()}),this.renderPreview=t,this.$matheditor.keyup(t),this.$matheditor.bind("paste",t)},n}(n.View)})}).call(this);