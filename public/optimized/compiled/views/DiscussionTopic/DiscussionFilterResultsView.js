(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,r=function(t,r){function n(){this.constructor=t}for(var i in r)e.call(r,i)&&(t[i]=r[i]);return n.prototype=r.prototype,t.prototype=new n,t.__super__=r.prototype,t};define(["jst/discussions/noResults","jquery","underscore","compiled/views/DiscussionTopic/FilterEntryView","compiled/views/DiscussionTopic/EntryCollectionView","compiled/collections/EntryCollection","compiled/regexp/rEscape"],function(e,n,i,o,s,l,a){var u,d;return u=function(u){function c(){return this.queryFilter=t(this.queryFilter,this),this.unreadFilter=t(this.unreadFilter,this),this.renderOrTeardownResults=t(this.renderOrTeardownResults,this),this.render=t(this.render,this),this.clearModel=t(this.clearModel,this),this.add=t(this.add,this),this.resetCollection=t(this.resetCollection,this),d=c.__super__.constructor.apply(this,arguments)}return r(c,u),c.prototype.defaults=i.extend({},s.prototype.defaults,{descendants:0,displayShowMore:!0,threaded:!0}),c.prototype.initialize=function(){return c.__super__.initialize.apply(this,arguments),this.allData=this.options.allData},c.prototype.attach=function(){return this.model.on("change",this.renderOrTeardownResults)},c.prototype.setAllReadState=function(t){return null!=this.collection?this.collection.fullCollection.each(function(e){return e.set("read_state",t)}):void 0},c.prototype.resetCollection=function(t){var e,r=this;return e=new l(t,{perPage:10}),this.collection=e.getPageAsCollection(0),this.collection.on("add",this.add),this.render(),this.collection.on("change:read_state",function(t,e){var i;return r.trigger("readStateChanged",t.id,e),i=n("#entry-"+t.id),i.length&&(t=i.data("view").model)?t.set("read_state",e):void 0})},c.prototype.add=function(t){var e,r=this;return e=new o({model:t}),e.render(),e.on("click",function(){return r.clearModel(),setTimeout(function(){return r.trigger("clickEntry",e.model)},1)}),this.list.append(e.el)},c.prototype.toggleRead=function(t){return t.preventDefault(),"read"===this.model.get("read_state")?this.model.markAsUnread():this.model.markAsRead()},c.prototype.clearModel=function(){return this.model.reset()},c.prototype.render=function(){return null!=this.collection&&c.__super__.render.apply(this,arguments),this.trigger("render"),this.$el.removeClass("hidden")},c.prototype.renderOrTeardownResults=function(){var t,e,r,n,i,o,s;if(this.model.hasFilter()){i=function(){var e,r;e=this.allData.flattened,r=[];for(n in e)t=e[n],r.push(t);return r}.call(this),s=this.model.toJSON();for(e in s)o=s[e],r=this[""+e+"Filter"],r&&(i=r(o,i));return i.length?this.resetCollection(i):this.renderNoResults()}return this.model.hasFilter()?void 0:(this.$el.addClass("hidden"),this.trigger("hide"))},c.prototype.renderNoResults=function(){return this.render(),this.$el.html(e)},c.prototype.unreadFilter=function(t,e){return t?(t=i.filter(e,function(t){return"unread"===t.read_state}),t.sort(function(t,e){return Date.parse(t.created_at)-Date.parse(e.created_at)})):e},c.prototype.queryFilter=function(t,e){var r,n;return r=function(){var e,r,i,o;for(i=(null!=t?t:"").trim().split(/\s+/g),o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(new RegExp(a(n),"i"));return o}(),r.length?i.filter(e,function(t){var e,n,i,o;for(e=""+t.message+"\n"+t.author.display_name+" ",i=0,o=r.length;o>i;i++)if(n=r[i],!n.test(e))return!1;return!0}):e},c}(s)})}).call(this);