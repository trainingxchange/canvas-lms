(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};define(["jquery","underscore","compiled/views/DialogBaseView","compiled/util/deparam","jst/conferences/editConferenceForm","jst/conferences/userSettingOptions"],function(t,r,o,s,i,c){var a,u;return a=function(o){function a(){return this.onClose=e(this.onClose,this),this.update=e(this.update,this),u=a.__super__.constructor.apply(this,arguments)}return n(a,o),a.prototype.template=i,a.prototype.dialogOptions=function(){return{width:"auto",close:this.onClose}},a.prototype.events={"click .all_users_checkbox":"toggleAllUsers","change #web_conference_long_running":"changeLongRunning","change #web_conference_conference_type":"renderConferenceFormUserSettings"},a.prototype.render=function(){var e=this;return a.__super__.render.apply(this,arguments),this.delegateEvents(),this.toggleAllUsers(),this.markInvitedUsers(),this.renderConferenceFormUserSettings(),this.$("form").formSubmit({object_name:"web_conference",beforeSubmit:function(n){return n=s(t.param(n)).web_conference,e.model.set(n),e.model.trigger("startSync")},success:function(t){return e.model.set(t),e.model.trigger("sync")},error:function(){return e.show(e.model),alert("Save failed.")}})},a.prototype.show=function(e){return this.model=e,this.render(),a.__super__.show.apply(this,arguments)},a.prototype.update=function(){return this.$("form").submit(),this.close()},a.prototype.onClose=function(){return window.router.navigate("")},a.prototype.toJSON=function(){var e,t,n,r,o;return e=a.__super__.toJSON.apply(this,arguments),r=!this.model.isNew(),n=!r,t=n,this.updateConferenceUserSettingDetailsForConference(e),e.http_method=n?"POST":"PUT",e.restore_duration=null===e.duration?ENV.default_conference.duration:e.duration,o={settings:{is_editing:r,is_adding:n,disable_duration_changes:(e.long_running||r)&&e.started_at,auth_token:ENV.AUTHENTICITY_TOKEN},conferenceData:e,users:ENV.users,conferenceTypes:ENV.conference_type_details.map(function(t){return{name:t.name,type:t.type,selected:e.conference_type===t.type}}),inviteAll:t}},a.prototype.updateConferenceUserSettingDetailsForConference=function(e){return r.each(ENV.conference_type_details,function(t){return r.each(t.settings,function(t){var n;switch(n=e.user_settings[t.field],void 0===n&&(n=t["default"]),t.type){case"boolean":t.isBoolean=!0,t.checked=n;break;case"text":t.isText=!0,t.value=n;break;case"date_picker":t.isDatePicker=!0,t.value=n?tz.format(n,"%b %-d, %Y %l:%M%P"):n;break;case"select":t.isSelect=!0}})})},a.prototype.renderConferenceFormUserSettings=function(){var e,n,o,s,i;return e=this.toJSON(),s=t("#web_conference_conference_type").val(),o=r.select(ENV.conference_type_details,function(e){return e.type===s}),o.length>0&&(o=o[0]),n=[],i=[],void 0!==o.settings&&t.each(o.settings,function(e,t){return"members"===t.location?n.push(t):i.push(t)}),this.$(".web_conference_user_settings").html(c({settings:i,conference:e,conference_started:!!e.started_at})),this.$(".web_conference_member_user_settings").html(c({settings:n,conference:e,conference_started:!!e.started_at})),this.$(".date_entry").each(function(){return this.disabled?void 0:t(this).datetime_field({alwaysShowTime:!0})})},a.prototype.toggleAllUsers=function(){return this.$(".all_users_checkbox").is(":checked")?t("#members_list").hide():t("#members_list").slideDown()},a.prototype.markInvitedUsers=function(){return r.each(this.model.get("user_ids"),function(e){return this.$("#members_list .member.user_"+e).find(":checkbox").attr("checked",!0)})},a.prototype.changeLongRunning=function(e){return t(e.currentTarget).is(":checked")?t("#web_conference_duration").prop("disabled",!0).val(""):t("#web_conference_duration").prop("disabled",!1).val(t("#web_conference_duration").data("restore-value"))},a}(o)})}).call(this);