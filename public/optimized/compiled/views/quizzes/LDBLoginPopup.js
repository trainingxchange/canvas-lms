(function(){var t={}.hasOwnProperty,n=function(n,o){function e(){this.constructor=n}for(var i in o)t.call(o,i)&&(n[i]=o[i]);return e.prototype=o.prototype,n.prototype=new e,n.__super__=o.prototype,n};define(["underscore","Backbone","jquery","jst/quizzes/LDBLoginPopup","jquery.toJSON"],function(t,o,e,i){var r,u,c;return u=function(t){return t?(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),!1):void 0},r=function(o){function r(){return c=r.__super__.constructor.apply(this,arguments)}return n(r,o),r.prototype.initialize=function(n){var o,i,r,c,s,a,l,p,f,d,h,y,m,g=this;return y=void 0,d=void 0,o=e(this),i=void 0,t.extend(this.options,n),m=t.map(this.options.window,function(n,o){return[o,t.isBoolean(n)?n?"yes":"no":n].join("=")}).join(","),this.on=t.bind(o.on,o),this.one=t.bind(o.one,o),this.off=t.bind(o.off,o),c=function(){var t;if(y)try{y.document}catch(n){if(t=n,/Permission/.test(t.message))return!0}return!1},f=function(){return h(),y=null,o.triggerHandler("close"),null},r=function(t){var n;if(c())return f(),!0;try{y.document.focus()}catch(o){n=o,e(y.document).focus()}return u(t)},s=function(){return i.appendTo(document.body)},h=function(){return i.detach()},a=function(t){var n,i,r;return i=u(t),r=e(t.target).closest("form").toJSON(),n=g.authenticate(r),n.then(function(t){return o.triggerHandler("login_success"),y.close(),f(),t}),n.fail(function(t){return o.triggerHandler("login_failure",t),t}),i},p=function(){var n,i;n=e(y.document),i=e(y.document.head),t(d).each(function(t){i.append('<link rel="stylesheet" href="'+t+'" />')}),n.find(".hide").removeClass("hide"),n.find(".btn-primary").on("click",a),o.triggerHandler("open",y.document)},this.exec=function(){return c()&&f(),y?(r(),y):(s(),y=window.open("about:blank","_blank",m,!1),y.document.write(g.template({})),y.onbeforeunload=f,y.onload=p,y.document.close(),y)},d=t(document.styleSheets).chain().map(function(t){return t.href}).compact().value(),i=e("<div />").on("click",r).css({"z-index":1e3,position:"fixed",left:0,right:0,top:0,bottom:0}),this.options.sticky?(l=void 0,this.on("login_failure.sticky",function(){return l=!0}),this.on("login_success.sticky",function(){return l=!1}),this.on("close.sticky",function(){return l?setTimeout(this.exec,1):void 0})):void 0},r.prototype.url="/login?nonldap=true",r.prototype.template=i,r.prototype.options={sticky:!0,window:{location:!1,menubar:!1,status:!1,toolbar:!1,fullscreen:!1,width:480,height:480}},r.prototype.authenticate=function(t){return e.ajax({type:"POST",url:this.url,data:JSON.stringify(t),global:!1,headers:{"Content-Type":"application/json",Accept:"application/json"}})},r}(o.View)})}).call(this);