(function(){var e=[].indexOf||function(e){for(var i=0,t=this.length;t>i;i++)if(i in this&&this[i]===e)return i;return-1};define(["i18n!help_dialog","jst/helpDialog","jquery","underscore","INST","str/htmlEscape","compiled/fn/preventDefault","jquery.instructure_misc_helpers","jqueryui/dialog","jquery.disableWhileLoading"],function(i,t,r,n,o,a,l){var s;return s={defaultTitle:i.t("Help","Help"),showEmail:function(){return!ENV.current_user_id},initDialog:function(){var i=this;return this.$dialog=r('<div style="padding:0; overflow: visible;" />').dialog({resizable:!1,width:400,title:this.defaultTitle,close:function(){return i.switchTo("#help-dialog-options")}}),this.$dialog.dialog("widget").delegate('a[href="#teacher_feedback"],                                          a[href="#create_ticket"],                                          a[href="#help-dialog-options"]',"click",l(function(e){var t;return t=e.currentTarget,i.switchTo(r(t).attr("href"))})),this.helpLinksDfd=r.getJSON("/help_links").done(function(o){var a;return o=r.grep(o,function(i){return n.detect(i.available_to,function(i){return"user"===i||ENV.current_user_roles&&e.call(ENV.current_user_roles,i)>=0})}),a={showEmail:i.showEmail(),helpLinks:o,url:window.location,contextAssetString:ENV.context_asset_string,userRoles:ENV.current_user_roles},i.$dialog.html(t(a)),i.initTicketForm(),r(i).trigger("ready")}),this.$dialog.disableWhileLoading(this.helpLinksDfd),this.dialogInited=!0},initTicketForm:function(){var e,i=this;return e=this.$dialog.find("#create_ticket").formSubmit({disableWhileLoading:!0,required:function(){var e;return e=["error[subject]","error[comments]","error[user_perceived_severity]"],i.showEmail()&&e.push("error[email]"),e},success:function(){return i.$dialog.dialog("close"),e.find(":input").val("")}})},switchTo:function(e){var t,n,o,a,l=this;return a="#teacher_feedback, #create_ticket",this.$dialog.find(a).hide(),n=this.$dialog.find(e),t=n.show().outerHeight(),this.$dialog.animate({left:a.match(e)?-400:0,height:t},{step:function(){return l.$dialog.dialog("option","position","center")},duration:100,complete:function(){return n.find(":input").not(":disabled").first().focus()}}),o=(o=this.$dialog.find("a[href='"+e+"'] .text").text())?r("          <a class='ui-dialog-header-backlink' href='#help-dialog-options'>            "+i.t("Back","Back")+"          </a>          <span>"+o+"</span>        "):this.defaultTitle,this.$dialog.dialog("option","title",o)},open:function(){return s.dialogInited||s.initDialog(),s.$dialog.dialog("open"),s.initTeacherFeedback()},initTeacherFeedback:function(){var i,t,n,o=this;return n=ENV.current_user_roles&&e.call(ENV.current_user_roles,"student")>=0,!this.teacherFeedbackInited&&n?(this.teacherFeedbackInited=!0,t=r.getJSON("/api/v1/courses.json"),i=null,this.helpLinksDfd.done(function(){return i=o.$dialog.find("#teacher_feedback").disableWhileLoading(t).formSubmit({disableWhileLoading:!0,required:["recipients[]","body"],success:function(){return o.$dialog.dialog("close")}})}),r.when(t,this.helpLinksDfd).done(function(e){var t,n;return t=e[0],n=r.map(t,function(e){return"<option value='course_"+e.id+"_admins' "+(ENV.context_id===e.id?"selected":"")+">              "+a(e.name)+"            </option>"}),i.find('[name="recipients[]"]').html(n.join(""))})):void 0},initTriggers:function(){return r(".help_dialog_trigger").click(l(this.open))}}})}).call(this);