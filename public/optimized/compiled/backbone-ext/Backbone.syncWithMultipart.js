(function(){define(["vendor/backbone","underscore","jquery"],function(e,t,n){return e.syncWithoutMultipart=e.sync,e.syncWithMultipart=function(e,r,o){var i,u,a,c,d,l,p,m;return l=t.uniqueId("file_upload_iframe_"),u=n("<iframe id='"+l+"' name='"+l+"' ></iframe>").hide(),c=new n.Deferred,d={create:"POST",update:"PUT","delete":"DELETE",read:"GET"}[e],p=function(e,r,o){var i;return i=t.map(e,function(e,i){var u,a;return r&&(i=""+r+"["+(o?"":i)+"]"),t.isElement(e)?(a=n(e),a.after(a.clone(!0)),e):t.isEmpty(e)||!t.isArray(e)&&"object"!=typeof e?(""+i).match(/^_/)||null==e||"object"==typeof e||"function"==typeof e?void 0:(u=n("<input/>",{name:i,value:e}),u[0]):p(e,i,t.isArray(e))}),t.flatten(i)},i=n("<form enctype='multipart/form-data' target='"+l+"' action='"+(null!=(m=o.url)?m:r.url())+"' method='POST'>\n</form>").hide(),o.proxyAttachment&&i.prepend("<input type='hidden' name='_method' value='"+d+"' />\n<input type='hidden' name='authenticity_token' value='"+ENV.AUTHENTICITY_TOKEN+"' />"),t.each(p(r.toJSON()),function(e){return e?"file"===e.name?i.append(e):i.prepend(e):void 0}),n(document.body).prepend(u,i),a=function(){var e,t,r,a,d;return e=null!=(r=u[0].contentDocument||(null!=(a=u[0].contentWindow)?a.document:void 0))?r.body:void 0,(t=n.parseJSON(n(e).text()))?(t=null!=(d=t.objects)?d:t,"error"===e.className?("function"==typeof o.error&&o.error(t),c.reject(t)):("function"==typeof o.success&&o.success(t),c.resolve(t)),u.remove(),i.remove()):void 0},u[0].onreadystatechange=function(){return"complete"===this.readyState?a():void 0},u[0].onload=a,i[0].submit(),c},e.sync=function(t,n,r){return(null!=r?r.multipart:void 0)?e.syncWithMultipart.apply(this,arguments):e.syncWithoutMultipart.apply(this,arguments)}})}).call(this);