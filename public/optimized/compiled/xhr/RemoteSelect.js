(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].slice;define(["jquery","underscore","compiled/class/cache","vendor/spin","jst/util/select/optgroups","jst/util/select/options"],function(s,n,i,r,o,p){var h;return h=function(){function h(e,r){this.el=e,this.options=r,this.stopSpinner=t(this.stopSpinner,this),this.startSpinner=t(this.startSpinner,this),this.currentKey=t(this.currentKey,this),this.onResponse=t(this.onResponse,this),this.options=n.extend({},this.defaultOptions,this.options),this.options.cache&&s.extend(!0,this,i),this.body=s("body"),this.options.placeholder=this.el.html(),this.options.start===!0&&this.makeRequest()}return h.prototype.defaultOptions={cache:!0,formatter:function(t){return t},requestParams:{},start:!0,url:window.location.href},h.prototype.spinnerOptions={lines:10,length:3,radius:3,speed:1,trail:60,width:2},h.prototype.makeRequest=function(t){var e,i=this;return null==t&&(t={}),t=n.extend({},this.options.requestParams,t),this.el.prop("disabled",!0),this.options.cache&&(e=this.cache.get([this.options.url,t]))?this.onResponse(e):(this.startSpinner(),this.currentRequest=s.getJSON(this.options.url,t,this.onResponse),n.tap(this.currentRequest,function(e){return e.url=i.options.url,e.params=t,e.error(i.stopSpinner)}))},h.prototype.onResponse=function(t){var e,s;return e=this.options.formatter(t),s=this.getTemplate(e),this.shouldCache(this.currentKey())&&this.cache.set(this.currentKey(),t),this.el.empty().append(this.options.placeholder).append(s(e)),this.stopSpinner(),this.el.prop("disabled",!1)},h.prototype.currentKey=function(){return[this.options.url,this.currentRequest.params]},h.prototype.shouldCache=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.options.cache&&!this.cache.get(t)},h.prototype.getTemplate=function(t){return n.isArray(t)?p:o},h.prototype.startSpinner=function(){return this.spinner=s(new r(this.spinnerOptions).spin().el),this.spinner.css(this.toTheRightOf(this.el)),this.body.append(this.spinner)},h.prototype.stopSpinner=function(){return this.spinner.remove()},h.prototype.toTheRightOf=function(t){return this.spinnerCss||(this.spinnerCss={left:t.offset().left+t.width()+10,position:"absolute",top:t.offset().top+t.height()/2,zIndex:9999})},h}()})}).call(this);